<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025 æ›¼è°·è–èª•è·¨å¹´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Zen+Kaku+Gothic+New:wght@400;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'jp-bg': '#F9F8F4',
                        'jp-card': '#FFFFFF',
                        'jp-text': '#4A4A4A',
                        'jp-accent': '#C6A568', // é‡‘è‰²ä¸»èª¿
                        'jp-blue': '#6B8EAD',
                        'jp-green': '#8DA399',
                        'jp-red': '#D67D7D',
                    },
                    fontFamily: {
                        sans: ['"Zen Kaku Gothic New"', '"Noto Sans TC"', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 20px rgba(0, 0, 0, 0.03)',
                        'float': '0 10px 30px rgba(0, 0, 0, 0.08)',
                        'gold': '0 4px 15px rgba(198, 165, 104, 0.15)',
                    }
                }
            }
        }
    </script>
    <style>
        body { 
            background-color: #F0F0F0;
            font-family: 'Zen Kaku Gothic New', sans-serif;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        .app-container {
            background-color: #F9F8F4;
            max-width: 430px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding-bottom: 100px;
            overflow-x: hidden;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .glass-nav {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0,0,0,0.05);
        }
        
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* æ¨™ç±¤æ¨£å¼ */
        .tag-pill { font-size: 10px; padding: 2px 8px; border-radius: 99px; font-weight: bold; margin-right: 4px; }
        .tag-eat { background: #FFF5F5; color: #E53E3E; border: 1px solid #FED7D7; }
        .tag-buy { background: #EBF8FF; color: #3182CE; border: 1px solid #BEE3F8; }
        .tag-photo { background: #F0FFF4; color: #38A169; border: 1px solid #C6F6D5; }

        /* è¨˜å¸³é é¢ç‰¹å®šæ¨£å¼ (åƒè€ƒæˆªåœ–2) */
        .cat-btn { transition: all 0.2s; border: 1px solid #eee; }
        .cat-btn.active { border: 1px solid #C6A568; background-color: #FFFCF5; color: #C6A568; }
        
        .payer-btn { transition: all 0.2s; }
        .payer-btn.active { background-color: #FFF9E6; border: 1px solid #F6E05E; color: #B7791F; font-weight: bold; }
    </style>
</head>
<body>

<div class="app-container">
    
    <header class="sticky top-0 z-50 bg-[#F9F8F4]/95 backdrop-blur-sm px-5 py-4 flex justify-between items-end border-b border-gray-100">
        <div>
            <p class="text-[10px] text-gray-400 tracking-widest mb-1">DEC 23 - DEC 28</p>
            <h1 class="text-xl font-bold text-jp-text tracking-wide">BANGKOK <span class="text-jp-accent">.</span></h1>
        </div>
        <div class="text-center">
             <span class="block text-[10px] text-gray-400">æ›¼è°·</span>
             <span class="text-sm font-medium" id="header-weather">Loading...</span>
        </div>
    </header>

    <div id="tab-home" class="section active px-5 py-4">
        
        <h2 class="text-lg font-bold text-jp-text mb-3">Dashboard</h2>
        
        <div class="grid grid-cols-2 gap-3 mb-3">
            <div class="bg-white p-4 rounded-2xl shadow-soft flex flex-col justify-between h-28 relative overflow-hidden">
                <div>
                    <p class="text-xs text-gray-400">åŒ¯ç‡ (TWD/THB)</p>
                    <p class="text-2xl font-bold text-jp-text mt-1">0.92</p>
                </div>
                <p class="text-[10px] text-green-600">å…ç¨…é¡æç¤º: 2000B</p>
            </div>
            <div class="bg-white p-4 rounded-2xl shadow-soft flex flex-col justify-between h-28 relative overflow-hidden">
                <div class="absolute right-0 top-0 w-16 h-16 bg-jp-accent/10 rounded-bl-full -mr-2 -mt-2"></div>
                <div>
                    <p class="text-xs text-gray-400">å…¬è²»éŒ¢åŒ…</p>
                    <p class="text-xl font-bold text-jp-text mt-1" id="dash-fund">à¸¿ 0</p>
                </div>
                <p class="text-[10px] text-gray-400">å‰©é¤˜é ç®—</p>
            </div>
        </div>

        <div class="bg-white rounded-2xl p-4 shadow-soft mb-6 flex items-center justify-between">
            <div class="flex-1">
                <p class="text-xs text-gray-400 mb-1">æ±‚ç”Ÿæ³°èª</p>
                <div class="flex gap-2">
                    <input type="text" id="thai-input" placeholder="è¼¸å…¥ä¸­æ–‡ (ä¾‹: ä¸è¦é¦™èœ)" class="w-full bg-transparent border-none p-0 text-sm font-bold text-jp-text focus:outline-none placeholder-gray-300">
                </div>
                <p class="text-[10px] text-jp-accent mt-1" id="thai-output">Mai Sai Pak Chi</p>
            </div>
            <button onclick="translateThai()" class="w-10 h-10 bg-gray-50 rounded-full flex items-center justify-center text-gray-400 hover:bg-gray-100 hover:text-jp-accent transition">
                <i class="fas fa-volume-up"></i>
            </button>
        </div>

        <h3 class="text-sm font-bold text-gray-400 mb-3 ml-1 uppercase tracking-wider">Quick Access</h3>
        <div class="grid grid-cols-2 gap-3 mb-20">
            <button onclick="switchTab('tab-checklist')" class="bg-white p-4 rounded-xl shadow-soft text-left flex flex-col justify-between h-24 group hover:shadow-gold transition">
                <i class="fas fa-tasks text-jp-accent text-xl group-hover:scale-110 transition"></i>
                <div>
                    <span class="text-sm font-bold block text-jp-text">è¡Œææ¸…å–®</span>
                    <span class="text-xs text-gray-400" id="home-check-progress">å®Œæˆåº¦ 0%</span>
                </div>
            </button>
            <button onclick="switchTab('tab-account')" class="bg-white p-4 rounded-xl shadow-soft text-left flex flex-col justify-between h-24 group hover:shadow-gold transition">
                <div class="flex justify-between">
                    <i class="fas fa-calculator text-jp-red text-xl group-hover:scale-110 transition"></i>
                    <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                </div>
                <div>
                    <span class="text-sm font-bold block text-jp-text">æ™ºæ…§è¨˜å¸³</span>
                    <span class="text-xs text-gray-400">é»æ“Šæ–°å¢</span>
                </div>
            </button>
        </div>
    </div>

    <div id="tab-itinerary" class="section pb-24">
        <div class="sticky top-[72px] z-40 bg-[#F9F8F4] px-5 py-2 mb-2">
            <div class="flex overflow-x-auto hide-scrollbar gap-3 pb-2" id="day-tabs">
                </div>
        </div>

        <div id="itinerary-content" class="px-5 space-y-4 min-h-[50vh]">
            </div>

        <div class="fixed bottom-20 left-5 right-5 z-30">
            <div class="bg-gray-800/90 backdrop-blur text-white rounded-xl p-3 flex items-center justify-between shadow-lg transform transition-all hover:scale-[1.02]">
                <div class="flex items-center gap-3">
                    <div class="bg-white/20 w-10 h-10 rounded-full flex items-center justify-center">
                        <i class="fas fa-tshirt text-white"></i>
                    </div>
                    <div>
                        <p class="text-[10px] text-gray-300">ä»Šæ—¥å¤©æ°£ & ç©¿æ­</p>
                        <p class="text-xs font-bold" id="outfit-text">è¼‰å…¥ä¸­...</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm font-bold" id="daily-weather-temp">--Â°C</p>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-account" class="section px-4 py-4 pb-24">
        <h2 class="text-xl font-bold text-center mb-6 text-jp-text">æ–°å¢è¨˜å¸³</h2>
        
        <div class="bg-white rounded-2xl shadow-gold p-5 border border-gray-50">
            
            <div class="mb-5">
                <p class="text-xs text-gray-400 mb-2 ml-1">åˆ†é¡</p>
                <div class="flex justify-between gap-2 overflow-x-auto hide-scrollbar py-1" id="category-container">
                    </div>
            </div>

            <div class="flex items-end gap-3 mb-6 border-b border-gray-100 pb-2">
                <div class="bg-gray-50 rounded-lg p-1 flex">
                    <button onclick="setCurrency('JPY')" id="curr-jpy" class="px-3 py-1 text-xs rounded font-bold text-gray-400">JPY</button>
                    <button onclick="setCurrency('THB')" id="curr-thb" class="px-3 py-1 text-xs rounded font-bold bg-white shadow-sm text-jp-text">THB</button>
                </div>
                <input type="number" id="amount-input" placeholder="0" class="flex-1 text-right text-4xl font-bold text-jp-text bg-transparent outline-none placeholder-gray-200">
            </div>

            <div class="mb-5">
                <div class="flex justify-between items-center mb-2">
                     <p class="text-xs text-gray-400 ml-1">ä»˜æ¬¾äºº</p>
                     <div class="flex items-center gap-1">
                        <span class="text-[10px] text-jp-accent font-bold">å…¬è²»åŒ…æ¨¡å¼</span>
                        <i class="fas fa-toggle-on text-jp-accent text-lg"></i>
                     </div>
                </div>
                <div class="flex gap-2" id="payer-container">
                    </div>
            </div>

            <div class="bg-gray-50 rounded-xl p-1 grid grid-cols-2 gap-1 mb-5">
                <button onclick="setSplit('shared')" class="py-2 rounded-lg text-xs font-bold bg-white shadow-sm text-jp-text split-btn active" id="split-shared">å…±åŒåˆ†æ”¤</button>
                <button onclick="setSplit('deposit')" class="py-2 rounded-lg text-xs text-gray-400 split-btn" id="split-deposit">å…¬è²»å…¥é‡‘</button>
            </div>

            <div class="bg-[#FFF9E6] rounded-lg p-3 flex items-center gap-3 mb-5">
                <i class="fas fa-calculator text-jp-accent"></i>
                <span class="text-xs text-jp-text font-bold" id="calc-preview">è¨˜å¸³å¾Œè‡ªå‹•è¨ˆç®—...</span>
            </div>

            <div class="flex gap-3">
                 <button class="w-12 h-12 rounded-full border border-gray-200 flex items-center justify-center text-gray-400 hover:text-jp-accent hover:border-jp-accent transition">
                    <i class="fas fa-camera"></i>
                 </button>
                 <div class="flex-1">
                     <button onclick="submitTransaction()" class="w-full h-12 bg-gray-800 text-white rounded-xl font-bold shadow-lg hover:bg-gray-700 active:scale-95 transition">
                        æ–°å¢ç´€éŒ„
                     </button>
                 </div>
            </div>
        </div>

        <div class="mt-6 px-1">
            <div class="flex justify-between items-center mb-2">
                <h3 class="text-sm font-bold text-gray-500">è¿‘æœŸç´€éŒ„</h3>
                <span class="text-xs text-jp-accent font-bold" id="fund-balance-acc">é¤˜é¡: à¸¿0</span>
            </div>
            <div id="transaction-history" class="space-y-2"></div>
        </div>
    </div>
    
    <div id="tab-checklist" class="section px-5 py-4 pb-24">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">è¡Œææ¸…å–®</h2>
            <button onclick="addChecklistItem()" class="w-8 h-8 rounded-full bg-jp-accent text-white flex items-center justify-center shadow-md active:scale-90">
                <i class="fas fa-plus text-xs"></i>
            </button>
        </div>
        <div id="checklist-container"></div>
    </div>

    <div id="tab-tools" class="section px-5 py-4 pb-24">
        <h2 class="text-xl font-bold mb-4">æ—…éŠæŒ‡å—</h2>
        
        <div class="bg-white rounded-xl shadow-soft p-4 mb-4 border-l-4 border-jp-blue relative overflow-hidden">
            <div class="absolute right-0 top-0 text-[100px] text-gray-50 opacity-10 rotate-12"><i class="fas fa-plane"></i></div>
            <h3 class="text-sm font-bold text-jp-blue mb-2"><i class="fas fa-plane mr-2"></i>èˆªç­è³‡è¨Š</h3>
            <div class="flex justify-between items-center mb-2">
                <div class="text-center">
                    <p class="text-2xl font-bold text-jp-text">KHH</p>
                    <p class="text-[10px] text-gray-400">18:00</p>
                </div>
                <div class="flex-1 text-center px-2">
                    <p class="text-[10px] text-gray-400">FD235</p>
                    <div class="h-[1px] bg-gray-300 w-full relative">
                        <i class="fas fa-plane absolute top-[-7px] left-1/2 -translate-x-1/2 text-gray-300 text-xs"></i>
                    </div>
                </div>
                <div class="text-center">
                    <p class="text-2xl font-bold text-jp-text">DMK</p>
                    <p class="text-[10px] text-gray-400">21:30</p>
                </div>
            </div>
            <p class="text-xs text-center text-gray-500 bg-gray-50 rounded py-1">äºèˆª (AirAsia)</p>
        </div>

        <div class="bg-white rounded-xl shadow-soft p-4 mb-4 border-l-4 border-jp-accent">
            <h3 class="text-sm font-bold text-jp-accent mb-2"><i class="fas fa-bed mr-2"></i>ä½å®¿è³‡è¨Š</h3>
            <div class="mb-3 pb-3 border-b border-gray-100">
                <span class="text-[10px] bg-gray-100 text-gray-500 px-2 py-0.5 rounded mb-1 inline-block">12/23-25</span>
                <p class="font-bold text-sm text-jp-text">B2 å”äººè¡—è€€è¯åŠ›å°Šå°šé£¯åº—</p>
                <div class="flex gap-2 mt-2">
                    <button class="text-[10px] bg-blue-50 text-blue-500 px-2 py-1 rounded" onclick="window.open('https://maps.google.com/?q=B2 China Town Yaowarat Premier Hotel')"><i class="fas fa-map-marker-alt mr-1"></i>å°èˆª</button>
                    <button class="text-[10px] bg-green-50 text-green-500 px-2 py-1 rounded"><i class="fas fa-phone mr-1"></i>æ’¥æ‰“</button>
                </div>
            </div>
            <div>
                <span class="text-[10px] bg-gray-100 text-gray-500 px-2 py-0.5 rounded mb-1 inline-block">12/25-27</span>
                <p class="font-bold text-sm text-jp-text">æ›¼è°·èŒ‰è‰èŠ±59è™Ÿé£¯åº—</p>
                <p class="text-[10px] text-gray-400">é€šç¾… BTS é™„è¿‘</p>
            </div>
        </div>

        <div class="bg-red-50 rounded-xl p-4 border border-red-100">
            <h3 class="text-sm font-bold text-red-500 mb-2"><i class="fas fa-exclamation-triangle mr-2"></i>ç·Šæ€¥è¯çµ¡</h3>
            <div class="grid grid-cols-2 gap-2">
                <div class="bg-white p-2 rounded text-center">
                    <p class="text-[10px] text-gray-400">è§€å…‰è­¦å¯Ÿ</p>
                    <p class="text-lg font-bold text-red-500">1155</p>
                </div>
                <div class="bg-white p-2 rounded text-center">
                    <p class="text-[10px] text-gray-400">æ•‘è­·è»Š</p>
                    <p class="text-lg font-bold text-red-500">1669</p>
                </div>
            </div>
        </div>
        
        <div class="mt-8 text-center">
            <button onclick="exportData()" class="text-xs text-gray-400 underline p-2">å‚™ä»½è³‡æ–™</button>
            <button onclick="hardReset()" class="text-xs text-red-300 underline p-2">é‡ç½®æ‰€æœ‰</button>
        </div>
    </div>

    <nav class="fixed bottom-6 left-5 right-5 h-16 glass-nav rounded-2xl flex justify-around items-center shadow-float z-50">
        <button onclick="switchTab('tab-home')" class="nav-btn active flex flex-col items-center gap-1 text-jp-accent" data-target="tab-home">
            <i class="fas fa-th-large text-lg"></i>
            <span class="text-[10px]">å„€è¡¨æ¿</span>
        </button>
        <button onclick="switchTab('tab-itinerary')" class="nav-btn flex flex-col items-center gap-1 text-gray-300" data-target="tab-itinerary">
            <i class="fas fa-map-marked-alt text-lg"></i>
            <span class="text-[10px]">è¡Œç¨‹</span>
        </button>
        <div class="relative -top-6">
            <button onclick="switchTab('tab-account')" class="w-14 h-14 bg-jp-text rounded-full shadow-lg flex items-center justify-center text-white text-xl transform hover:scale-105 transition active:scale-95 border-2 border-[#F9F8F4]">
                <i class="fas fa-plus"></i>
            </button>
        </div>
        <button onclick="switchTab('tab-checklist')" class="nav-btn flex flex-col items-center gap-1 text-gray-300" data-target="tab-checklist">
            <i class="fas fa-check-circle text-lg"></i>
            <span class="text-[10px]">æ¸…å–®</span>
        </button>
        <button onclick="switchTab('tab-tools')" class="nav-btn flex flex-col items-center gap-1 text-gray-300" data-target="tab-tools">
            <i class="fas fa-book text-lg"></i>
            <span class="text-[10px]">æŒ‡å—</span>
        </button>
    </nav>

</div>

<script>
    // --- DATA & STATE ---
    const ITINERARY_DATA = [
        {
            day: 1, date: "12/23 (äºŒ)", location: "å»Šæ›¼ -> å”äººè¡—", weather: "28Â°C ğŸŒ™", outfit: "è¼•é¬†èˆ’é© (æ­æ©Ÿ/å®µå¤œ)",
            spots: [
                { type: 'flight', name: "æŠµé”æ›¼è°·", time: "21:30", desc: "FD235 æŠµé”å»Šæ›¼æ©Ÿå ´", icon: "fa-plane", color: "text-blue-500" },
                { type: 'transport', name: "åŒ…è»Šæ¥æ©Ÿ", time: "22:00", desc: "å‰å¾€ B2 é£¯åº—", icon: "fa-car", color: "text-gray-500", parking: false },
                { type: 'food', name: "å”äººè¡—å®µå¤œ", time: "Late", desc: "å¿…åƒ T&K æµ·é®®æˆ–è·¯é‚Šæ”¤", icon: "fa-utensils", color: "text-orange-500", tags: ["å¿…åƒ", "æ‹ç…§"], nav: "Yaowarat Road" }
            ]
        },
        {
            day: 2, date: "12/24 (ä¸‰)", location: "èˆŠåŸå€", weather: "32Â°C â˜€ï¸", outfit: "é˜²æ›¬ã€å¥½èµ°çš„é‹ã€æœ‰è¢–ä¸Šè¡£(å¯ºå»Ÿ)",
            spots: [
                { type: 'spot', name: "é„­ç‹å»Ÿ (Wat Arun)", time: "10:00", desc: "å¿…æ‹ç™½è‰²ä½›å¡”ï¼Œå»ºè­°ç§Ÿæ³°æœ", icon: "fa-gopuram", color: "text-yellow-600", tags: ["å¿…æ‹", "ç†±é–€"], nav: "Wat Arun", photoTip: "ç«™åœ¨å°è§’ç·šç”¨å»£è§’æ‹ï¼Œé¿é–‹äººæ½®" },
                { type: 'food', name: "ç‹æœ—å¸‚å ´", time: "12:30", desc: "åœ¨åœ°å¹³åƒ¹ç¾é£Ÿ", icon: "fa-utensils", color: "text-orange-500", tags: ["ä¾¿å®œ"], nav: "Wang Lang Market" },
                { type: 'spot', name: "River City éƒµè¼ª", time: "19:00", desc: "æ˜­æŠ«è€¶æ²³æ™šé¤", icon: "fa-ship", color: "text-blue-600", tags: ["é ç´„è™Ÿ: 8821"], nav: "River City Bangkok" }
            ]
        },
        {
            day: 3, date: "12/25 (å››)", location: "é€šç¾… / è³¼ç‰©", weather: "30Â°C â˜ï¸", outfit: "æ™‚å°šéƒ½æœƒé¢¨ (ç™¾è²¨å…¬å¸/å’–å•¡å»³)",
            spots: [
                { type: 'food', name: "ç›Šç”Ÿç”«è¨˜", time: "09:00", desc: "è€æ´¾æ³°å¼æ—©é¤", icon: "fa-coffee", color: "text-brown-500", nav: "Ek Teng Phu Ki" },
                { type: 'spot', name: "åµ©è¶Šè·¯", time: "10:30", desc: "æ–‡é’å’–å•¡è¡—", icon: "fa-camera", color: "text-pink-500", tags: ["ç¶²ç¾"], photoTip: "å··å¼„å…‰å½±ç¾ï¼Œæ‰¾è€å»ºç¯‰ç‰†é¢" },
                { type: 'shop', name: "Iconsiam", time: "15:00", desc: "å®¤å…§æ°´ä¸Šå¸‚å ´", icon: "fa-shopping-bag", color: "text-purple-500", tags: ["å¿…è²·", "åœè»Š"], nav: "Iconsiam", parking: true }
            ]
        },
        {
            day: 4, date: "12/26 (äº”)", location: "è¿‘éƒŠä¸€æ—¥éŠ", weather: "33Â°C â˜€ï¸", outfit: "è¼•ä¾¿é€æ°£ã€å¸½å­",
            spots: [
                { type: 'transport', name: "åŒ…è»Šå‡ºç™¼", time: "08:00", desc: "é£¯åº—å¤§å»³é›†åˆ", icon: "fa-car", color: "text-green-600", gas: true },
                { type: 'spot', name: "ç¾åŠŸéµé“å¸‚å ´", time: "10:00", desc: "çœ‹ç«è»Šç¶“éå¸‚é›†", icon: "fa-train", color: "text-red-500", tags: ["å¿…æ‹"], nav: "Maeklong Railway Market" },
                { type: 'spot', name: "ä¸¹å«©èæ°´ä¸Šå¸‚å ´", time: "12:00", desc: "æ­æ‰‹æ–èˆ¹é«”é©—", icon: "fa-water", color: "text-blue-400", nav: "Damnoen Saduak" }
            ]
        }
    ];

    let appState = {
        currency: 'THB',
        currentSplit: 'shared',
        fundBalance: 12500, // Initial Mock
        users: ['å°æœ±', 'ç°¡å“¥', 'å…¬è²»åŒ…'], 
        transactions: [], 
        checklist: [
            { title: 'è­‰ä»¶', items: [{name: 'è­·ç…§', checked: true}, {name: 'é›»å­ç°½', checked: false}] },
            { title: '3C', items: [{name: 'ç¶²å¡', checked: false}, {name: 'è½‰æ¥é ­', checked: false}] }
        ],
        currentDayIndex: 0
    };

    // --- INIT ---
    document.addEventListener('DOMContentLoaded', () => {
        loadState();
        fetchWeather();
        renderCategories();
        renderPayers();
        renderDayTabs();
        renderItineraryContent();
        updateFundDisplay();
        renderChecklist();
    });

    // --- DASHBOARD LOGIC ---
    async function fetchWeather() {
        // Mocking real-time weather
        document.getElementById('header-weather').innerHTML = `28Â°C <i class="fas fa-sun text-yellow-400"></i>`;
        document.getElementById('daily-weather-temp').innerText = "28Â°C";
    }

    function translateThai() {
        const text = document.getElementById('thai-input').value;
        if (!text) return alert("è«‹è¼¸å…¥æ–‡å­—");
        document.getElementById('thai-output').innerText = "æ­£åœ¨ç¿»è­¯: " + text + "...";
        setTimeout(() => {
             const url = `https://translate.google.com/?sl=zh-TW&tl=th&text=${encodeURIComponent(text)}&op=translate`;
             window.open(url, '_blank');
        }, 500);
    }

    // --- ITINERARY LOGIC ---
    function renderDayTabs() {
        const container = document.getElementById('day-tabs');
        container.innerHTML = ITINERARY_DATA.map((d, idx) => `
            <button onclick="setDay(${idx})" class="flex-shrink-0 px-4 py-2 rounded-xl transition border ${idx === appState.currentDayIndex ? 'bg-jp-text text-white border-jp-text shadow-md' : 'bg-white text-gray-400 border-gray-100'}">
                <span class="block text-xs font-bold">Day ${d.day}</span>
                <span class="text-[10px] whitespace-nowrap">${d.date.split(' ')[0]}</span>
            </button>
        `).join('');
    }

    function setDay(idx) {
        appState.currentDayIndex = idx;
        renderDayTabs();
        renderItineraryContent();
    }

    function renderItineraryContent() {
        const dayData = ITINERARY_DATA[appState.currentDayIndex];
        const container = document.getElementById('itinerary-content');
        
        // Update Outfit footer
        document.getElementById('outfit-text').innerText = dayData.outfit;
        document.getElementById('daily-weather-temp').innerText = dayData.weather.split(' ')[0];

        // Render Cards
        container.innerHTML = dayData.spots.map(spot => {
            const tagsHtml = spot.tags ? spot.tags.map(t => {
                let cls = 'bg-gray-100 text-gray-500';
                if(t.includes('åƒ')) cls = 'tag-eat';
                if(t.includes('è²·')) cls = 'tag-buy';
                if(t.includes('æ‹')) cls = 'tag-photo';
                return `<span class="tag-pill ${cls}">${t}</span>`;
            }).join('') : '';

            const navBtn = spot.nav ? `
                <a href="https://www.google.com/maps/search/?api=1&query=${spot.nav}" target="_blank" class="w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-blue-500 hover:bg-blue-100">
                    <i class="fas fa-location-arrow text-sm"></i>
                </a>` : '';

            const parkingInfo = spot.parking ? `<span class="text-[10px] text-gray-400 ml-2"><i class="fas fa-parking text-blue-400"></i> æœ‰åœè»Šå ´</span>` : '';
            const gasInfo = spot.gas ? `<span class="text-[10px] text-gray-400 ml-2"><i class="fas fa-gas-pump text-red-400"></i> åŠ æ²¹</span>` : '';

            const photoSection = spot.photoTip ? `
                <div class="mt-2 bg-yellow-50 p-2 rounded border border-yellow-100 flex gap-2 items-start">
                    <i class="fas fa-lightbulb text-yellow-500 text-xs mt-1"></i>
                    <div>
                        <p class="text-[10px] font-bold text-yellow-700">æ‹ç…§å°æŠ€å·§</p>
                        <p class="text-[10px] text-gray-600">${spot.photoTip}</p>
                    </div>
                </div>
            ` : '';

            return `
                <div class="bg-white rounded-2xl p-4 shadow-soft relative overflow-hidden">
                    <div class="flex items-start gap-3">
                        <div class="flex flex-col items-center min-w-[40px]">
                            <span class="text-xs font-bold text-gray-400">${spot.time}</span>
                            <div class="h-full w-[1px] bg-gray-100 my-1"></div>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start mb-1">
                                <h3 class="font-bold text-jp-text text-lg leading-tight">${spot.name}</h3>
                                ${navBtn}
                            </div>
                            <div class="flex items-center gap-1 mb-2">
                                <i class="fas ${spot.icon} ${spot.color} text-xs"></i>
                                <span class="text-xs text-gray-500">${spot.desc}</span>
                                ${parkingInfo} ${gasInfo}
                            </div>
                            <div class="flex flex-wrap gap-1 mb-2">
                                ${tagsHtml}
                            </div>
                            ${photoSection}
                            <div class="mt-2 pt-2 border-t border-gray-50 flex justify-between items-center">
                                <button class="text-[10px] text-gray-400 flex items-center gap-1" onclick="alert('é–‹å•Ÿç›¸æ©Ÿ(æ¨¡æ“¬)')">
                                    <i class="fas fa-camera"></i> ä¸Šå‚³ç…§ç‰‡
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
    }

    // --- ACCOUNTING LOGIC ---
    function renderCategories() {
        const cats = [
            {icon: 'fa-utensils', name: 'é¤é£²'}, {icon: 'fa-car', name: 'äº¤é€š'},
            {icon: 'fa-shopping-bag', name: 'è³¼ç‰©'}, {icon: 'fa-ticket-alt', name: 'é–€ç¥¨'}
        ];
        document.getElementById('category-container').innerHTML = cats.map((c, idx) => `
            <button onclick="selectCat(this)" class="cat-btn ${idx===0?'active':''} flex-shrink-0 w-16 h-16 rounded-xl flex flex-col items-center justify-center bg-white">
                <i class="fas ${c.icon} text-lg mb-1"></i>
                <span class="text-xs">${c.name}</span>
            </button>
        `).join('');
    }

    function selectCat(btn) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    function renderPayers() {
        const users = ['å°æœ±', 'ç°¡å“¥', 'å…¬è²»åŒ…'];
        document.getElementById('payer-container').innerHTML = users.map((u, idx) => `
            <button onclick="selectPayer(this)" class="payer-btn ${idx===0?'active':''} px-4 py-2 bg-gray-50 text-gray-400 rounded-lg text-sm border border-transparent">${u}</button>
        `).join('');
    }

    function selectPayer(btn) {
        document.querySelectorAll('.payer-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    function setSplit(type) {
        document.querySelectorAll('.split-btn').forEach(b => {
            b.classList.remove('active', 'bg-white', 'shadow-sm', 'text-jp-text');
            b.classList.add('text-gray-400');
        });
        const btn = document.getElementById(`split-${type}`);
        btn.classList.add('active', 'bg-white', 'shadow-sm', 'text-jp-text');
        btn.classList.remove('text-gray-400');
        appState.currentSplit = type;
        
        // Mock Calc Preview
        const txt = type === 'deposit' ? 'å…¬è²»å¢åŠ ' : 'å¾å…¬è²»æ‰£é™¤ (æˆ–å„ä»˜å„)';
        document.getElementById('calc-preview').innerText = txt;
    }

    function submitTransaction() {
        const amt = document.getElementById('amount-input').value;
        if(!amt) return alert("è«‹è¼¸å…¥é‡‘é¡");
        
        // Simple logic for demo
        if(appState.currentSplit === 'deposit') {
            appState.fundBalance += parseFloat(amt);
        } else {
            // Assume expense from fund for now
            appState.fundBalance -= parseFloat(amt);
        }
        updateFundDisplay();
        document.getElementById('amount-input').value = '';
        
        // Add History Mock
        const historyDiv = document.getElementById('transaction-history');
        const newItem = document.createElement('div');
        newItem.className = "bg-white p-3 rounded-xl shadow-sm flex justify-between items-center border border-gray-50";
        newItem.innerHTML = `
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 text-xs">å…¬</div>
                <div><p class="text-sm font-bold text-jp-text">æ–°å¢æ¶ˆè²»</p></div>
            </div>
            <span class="font-bold ${appState.currentSplit === 'deposit' ? 'text-green-500' : 'text-jp-text'}">
                ${appState.currentSplit === 'deposit' ? '+' : '-'} ${amt}
            </span>
        `;
        historyDiv.prepend(newItem);
    }

    function updateFundDisplay() {
        const val = `à¸¿ ${appState.fundBalance.toLocaleString()}`;
        document.getElementById('dash-fund').innerText = val;
        document.getElementById('fund-balance-acc').innerText = "é¤˜é¡: " + val;
        saveState();
    }

    // --- CHECKLIST ---
    function renderChecklist() {
        const container = document.getElementById('checklist-container');
        container.innerHTML = appState.checklist.map((grp, gIdx) => `
            <div class="bg-white rounded-xl p-4 shadow-soft mb-3">
                <p class="font-bold text-sm mb-2">${grp.title}</p>
                <div class="space-y-2">
                    ${grp.items.map((it, iIdx) => `
                        <label class="flex items-center gap-2 text-sm text-gray-600">
                            <input type="checkbox" ${it.checked?'checked':''} class="accent-jp-accent" onchange="toggleCheck(${gIdx}, ${iIdx})">
                            <span class="${it.checked?'line-through text-gray-300':''}">${it.name}</span>
                        </label>
                    `).join('')}
                </div>
            </div>
        `).join('');
        
        // Calc progress
        let total = 0, checked = 0;
        appState.checklist.forEach(g => g.items.forEach(i => { total++; if(i.checked) checked++; }));
        document.getElementById('home-check-progress').innerText = `å®Œæˆåº¦ ${Math.round((checked/total)*100)}%`;
    }

    function toggleCheck(gIdx, iIdx) {
        appState.checklist[gIdx].items[iIdx].checked = !appState.checklist[gIdx].items[iIdx].checked;
        renderChecklist();
    }

    // --- SYSTEM ---
    function switchTab(tabId) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.classList.remove('text-jp-accent');
            btn.classList.add('text-gray-300');
            if(btn.dataset.target === tabId) {
                btn.classList.remove('text-gray-300');
                btn.classList.add('text-jp-accent');
            }
        });
    }

    function saveState() {
        localStorage.setItem('bangkok_2025_data', JSON.stringify(appState));
    }
    function loadState() {
        const data = localStorage.getItem('bangkok_2025_data');
        if(data) appState = JSON.parse(data);
    }
    function hardReset() {
        if(confirm('ç¢ºå®šé‡ç½®ï¼Ÿ')) { localStorage.removeItem('bangkok_2025_data'); location.reload(); }
    }
    function exportData() {
        alert("è³‡æ–™å·²è¤‡è£½ (æ¨¡æ“¬): " + JSON.stringify(appState).substring(0, 20) + "...");
    }
</script>

</body>
</html>
