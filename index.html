<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025 æ›¼è°·è–èª•è·¨å¹´ - æ³°å»¢äº†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Zen+Kaku+Gothic+New:wght@400;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'jp-bg': '#F9F8F4',
                        'jp-text': '#4A4A4A',
                        'jp-accent': '#C6A568', // é‡‘è‰²
                        'jp-blue': '#6B8EAD',
                        'jp-green': '#8DA399',
                        'jp-red': '#D67D7D',
                    },
                    fontFamily: {
                        sans: ['"Zen Kaku Gothic New"', '"Noto Sans TC"', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 20px rgba(0, 0, 0, 0.03)',
                        'gold': '0 4px 15px rgba(198, 165, 104, 0.15)',
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #F0F0F0; font-family: 'Zen Kaku Gothic New', sans-serif; -webkit-tap-highlight-color: transparent; user-select: none; }
        .app-container { background-color: #F9F8F4; max-width: 430px; margin: 0 auto; min-height: 100vh; padding-bottom: 100px; overflow-x: hidden; position: relative; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Timeline */
        .timeline-item { position: relative; padding-left: 24px; padding-bottom: 24px; border-left: 2px solid #E5E7EB; }
        .timeline-item:last-child { border-left: 2px solid transparent; }
        .timeline-dot { position: absolute; left: -7px; top: 0; width: 12px; height: 12px; border-radius: 50%; background: #C6A568; border: 2px solid #F9F8F4; }
        .timeline-time { font-size: 11px; font-weight: bold; color: #6B8EAD; margin-bottom: 4px; display: block; }

        /* Accounting Buttons */
        .cat-btn.active { border: 1px solid #C6A568; background-color: #FFFCF5; color: #C6A568; }
        .payer-btn.active { background-color: #FFF9E6; border: 1px solid #C6A568; color: #C6A568; font-weight: bold; }
        .split-btn.active { background-color: #4A4A4A; color: white; }

        /* Navbar Active State */
        .nav-btn.active { color: #C6A568; }
        .nav-btn.active i { transform: scale(1.1); transition: 0.2s; }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; display: none; align-items: center; justify-content: center; }
        .modal-overlay.open { display: flex; }
    </style>
</head>
<body>

<div class="app-container">
    
    <header class="sticky top-0 z-50 bg-[#F9F8F4]/95 backdrop-blur-sm px-5 py-4 flex justify-between items-end border-b border-gray-100">
        <div>
            <p class="text-[10px] text-gray-400 tracking-widest mb-1">DEC 23 - DEC 27</p>
            <h1 class="text-xl font-bold text-jp-text tracking-wide leading-tight">2025 æ›¼è°·è–èª•è·¨å¹´<br><span class="text-jp-accent text-lg">- æ³°å»¢äº† -</span></h1>
        </div>
        <div class="text-center">
             <span class="block text-[10px] text-gray-400">æ›¼è°·</span>
             <span class="text-sm font-medium" id="header-weather">Loading...</span>
        </div>
    </header>

    <div id="tab-home" class="section active px-5 py-4">
        
        <div class="bg-white rounded-2xl p-4 shadow-soft mb-6">
            <h3 class="text-sm font-bold text-jp-text mb-2">æ±‚ç”Ÿæ³°èªç¿»è­¯</h3>
            <div class="flex gap-2">
                <input type="text" id="thai-input" placeholder="è¼¸å…¥ä¸­æ–‡ (ä¾‹: ä¸è¦é¦™èœ)" class="flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-jp-accent">
                <button onclick="translateThai()" class="w-10 h-10 bg-jp-green/10 rounded-lg flex items-center justify-center text-jp-green active:scale-95 transition">
                    <i class="fas fa-volume-up"></i>
                </button>
            </div>
            <p class="text-[10px] text-gray-400 mt-2 text-right">é»æ“Šå–‡å­é–‹å•Ÿ Google ç¿»è­¯ç™¼éŸ³</p>
        </div>

        <h3 class="text-sm font-bold text-gray-400 mb-3 ml-1 uppercase tracking-wider">Quick Access</h3>
        <div class="grid grid-cols-2 gap-3 mb-20">
            <button onclick="switchTab('tab-itinerary')" class="bg-white p-4 rounded-xl shadow-soft text-left flex flex-col justify-between h-24 relative overflow-hidden group active:scale-95 transition">
                <div class="absolute top-0 right-0 w-12 h-12 bg-jp-blue/10 rounded-full -mr-4 -mt-4"></div>
                <i class="fas fa-map-marked-alt text-jp-blue text-xl relative z-10"></i>
                <div>
                    <span class="text-sm font-bold block text-jp-text">è¡Œç¨‹è¦åŠƒ</span>
                    <span class="text-xs text-gray-400 font-sans" id="current-date-display">Dec 23</span>
                </div>
            </button>

            <button onclick="switchTab('tab-account')" class="bg-white p-4 rounded-xl shadow-soft text-left flex flex-col justify-between h-24 border border-jp-accent/20 active:scale-95 transition">
                <div class="flex justify-between">
                    <i class="fas fa-calculator text-jp-red text-xl"></i>
                    <span class="text-[10px] bg-gray-100 px-1 rounded text-gray-500" id="dash-fund">å…¬è²»: $0</span>
                </div>
                <div>
                    <span class="text-sm font-bold block text-jp-text">æ™ºæ…§è¨˜å¸³</span>
                    <span class="text-xs text-gray-400">é»æ“Šè¨˜å¸³</span>
                </div>
            </button>

             <button onclick="switchTab('tab-checklist')" class="bg-white p-4 rounded-xl shadow-soft text-left flex flex-col justify-between h-24 active:scale-95 transition">
                <i class="fas fa-tasks text-jp-accent text-xl"></i>
                <div>
                    <span class="text-sm font-bold block text-jp-text">è¡Œææ¸…å–®</span>
                    <span class="text-xs text-gray-400" id="home-check-progress">å®Œæˆåº¦ 0%</span>
                </div>
            </button>
        </div>
    </div>

    <div id="tab-itinerary" class="section pb-24">
        <div class="sticky top-[72px] z-40 bg-[#F9F8F4] px-5 py-2 mb-2 shadow-sm">
            <div class="flex overflow-x-auto hide-scrollbar gap-3 pb-2" id="day-tabs">
                </div>
        </div>

        <div id="itinerary-content" class="px-5 space-y-4 min-h-[50vh]">
            </div>

        <div class="px-5 mt-8 mb-4">
             <h3 class="text-sm font-bold text-gray-400 mb-2 uppercase">ä½å®¿è³‡è¨Š</h3>
             <div class="bg-white rounded-xl p-3 shadow-sm border-l-4 border-jp-blue mb-2">
                 <p class="text-xs font-bold text-jp-blue">12/23 - 12/25 (å”äººè¡—)</p>
                 <p class="text-sm font-bold text-jp-text">B2 å”äººè¡—è€€è¯åŠ›å°Šå°šé£¯åº—</p>
                 <a href="https://maps.app.goo.gl/example" target="_blank" class="text-[10px] text-gray-400 underline"><i class="fas fa-map-marker-alt"></i> æŸ¥çœ‹åœ°åœ–</a>
             </div>
             <div class="bg-white rounded-xl p-3 shadow-sm border-l-4 border-jp-accent">
                 <p class="text-xs font-bold text-jp-accent">12/25 - 12/27 (é€šç¾…)</p>
                 <p class="text-sm font-bold text-jp-text">æ›¼è°·èŒ‰è‰èŠ±59è™Ÿé£¯åº—</p>
                 <a href="https://maps.app.goo.gl/example" target="_blank" class="text-[10px] text-gray-400 underline"><i class="fas fa-map-marker-alt"></i> æŸ¥çœ‹åœ°åœ–</a>
             </div>
        </div>
    </div>

    <div id="tab-guide" class="section px-5 py-4 pb-24">
        <h2 class="text-xl font-bold mb-4">æ·±åº¦å°è¦½</h2>
        
        <div class="bg-white rounded-2xl overflow-hidden shadow-soft mb-6">
            <div class="h-32 bg-gray-200 relative">
                 <iframe width="100%" height="100%" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://www.openstreetmap.org/export/embed.html?bbox=100.490%2C13.740%2C100.500%2C13.750&amp;layer=mapnik" style="pointer-events: none;"></iframe>
                 <div class="absolute bottom-0 left-0 bg-black/50 text-white text-xs px-2 py-1">é„­ç‹å»Ÿå‘¨é‚Š</div>
            </div>
            <div class="p-4">
                <h3 class="text-lg font-bold text-jp-text mb-2">é„­ç‹å»Ÿ (Wat Arun)</h3>
                <p class="text-sm text-gray-600 leading-relaxed mb-2">
                    åˆç¨±é»æ˜å¯ºã€‚å®ƒæ˜¯æ³°åœ‹å¢ƒå…§è¦æ¨¡æœ€å¤§çš„å¤§ä¹˜èˆåˆ©å¼å¡”ï¼Œå¤–è§€æ½”ç™½èŠåš´ï¼Œé‘²åµŒäº†ç„¡æ•¸å½©è‰²é™¶ç“·ç‰‡ï¼Œåœ¨é™½å…‰ä¸‹é–ƒè€€ã€‚
                </p>
                <div class="bg-jp-bg p-2 rounded text-xs text-gray-500">
                    <span class="font-bold text-jp-accent">ğŸ’¡ å†·çŸ¥è­˜ï¼š</span> é„­ç‹å»Ÿæ˜¯ç´€å¿µæ³°åœ‹ç¬¬41ä»£å›ç‹ã€æ°‘æ—è‹±é›„ã€Œé„­æ˜­ã€çš„å¯ºå»Ÿã€‚
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl p-4 shadow-soft">
            <h3 class="text-lg font-bold text-jp-text mb-2">çŸ³é¾è»è·¯ (Charoen Krung)</h3>
            <p class="text-sm text-gray-600 leading-relaxed">
                æ›¼è°·ç¬¬ä¸€æ¢è¥¿å¼é¦¬è·¯ã€‚é€™è£¡æ–°èˆŠäº¤èï¼Œæœ‰è¨±å¤šè€å­—è™Ÿç¾é£Ÿï¼ˆå¦‚è±¬è…³é£¯ã€ä»å’Œåœ’ï¼‰ï¼Œä¹Ÿæœ‰æ–°å‰µçš„æ–‡é’å’–å•¡å»³ã€‚
            </p>
            <div class="mt-2 flex gap-2">
                <span class="text-[10px] bg-red-50 text-red-500 px-2 py-1 rounded">å¿…åƒè±¬è…³é£¯</span>
                <span class="text-[10px] bg-blue-50 text-blue-500 px-2 py-1 rounded">32Bar çˆµå£«æ¨‚</span>
            </div>
        </div>
    </div>

    <div id="tab-account" class="section px-4 py-4 pb-24">
        
        <a href="https://docs.google.com/spreadsheets" target="_blank" class="block bg-green-50 border border-green-200 rounded-xl p-3 mb-4 flex items-center justify-between shadow-sm active:scale-95 transition">
             <div class="flex items-center gap-3">
                 <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white"><i class="fas fa-file-excel"></i></div>
                 <div>
                     <h4 class="text-sm font-bold text-jp-text">Google Sheet åŒæ­¥è¡¨</h4>
                     <p class="text-[10px] text-gray-500">å¤šäººå³æ™‚è¨˜å¸³å»ºè­°ç”¨æ­¤ (é»æ“Šé–‹å•Ÿ)</p>
                 </div>
             </div>
             <i class="fas fa-external-link-alt text-gray-400 text-xs"></i>
        </a>

        <div class="bg-white rounded-2xl shadow-gold p-5 border border-gray-50 relative">
            <div class="absolute top-4 right-4 text-right">
                <p class="text-[10px] text-gray-400">å…¬è²»åŒ…é¤˜é¡ (THB)</p>
                <p class="text-xl font-bold text-jp-accent" id="acc-fund-display">à¸¿ 0</p>
            </div>

            <h2 class="text-lg font-bold text-jp-text mb-4">æ–°å¢è¨˜å¸³</h2>

            <div class="flex justify-between gap-2 overflow-x-auto hide-scrollbar mb-4" id="cat-container"></div>

            <div class="flex items-end gap-3 mb-4 border-b border-gray-100 pb-2">
                <div class="flex bg-gray-50 rounded-lg p-1">
                    <button onclick="setCurrency('TWD')" id="cur-twd" class="px-3 py-1 text-xs rounded text-gray-400 font-bold">TWD</button>
                    <button onclick="setCurrency('THB')" id="cur-thb" class="px-3 py-1 text-xs rounded bg-white shadow-sm text-jp-text font-bold">THB</button>
                </div>
                <input type="number" id="amt-input" placeholder="0" class="flex-1 text-right text-3xl font-bold text-jp-text bg-transparent outline-none">
            </div>

            <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
                    <p class="text-xs text-gray-400">ä»˜æ¬¾äºº</p>
                    <button onclick="editUsers()" class="text-[10px] text-blue-400 underline">ç·¨è¼¯åå–®</button>
                </div>
                <div class="flex flex-wrap gap-2" id="payer-container"></div>
            </div>

            <div class="mb-4">
                <p class="text-xs text-gray-400 mb-2">åˆ†æ”¤æ¨¡å¼</p>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="setSplit('shared')" id="split-shared" class="split-btn active py-2 rounded-lg text-xs border border-gray-200">å…±åŒåˆ†æ”¤ (æ‰£å…¬è²»/è¨˜å¸³)</button>
                    <button onclick="setSplit('deposit')" id="split-deposit" class="split-btn py-2 rounded-lg text-xs border border-gray-200 text-gray-400">å…¬è²»å…¥é‡‘ (å­˜éŒ¢)</button>
                    <button onclick="setSplit('own')" id="split-own" class="split-btn py-2 rounded-lg text-xs border border-gray-200 text-gray-400">å€‹äººè‡ªä»˜</button>
                    <button onclick="setSplit('advance')" id="split-advance" class="split-btn py-2 rounded-lg text-xs border border-gray-200 text-gray-400">å¹«äººä»£å¢Š</button>
                </div>
            </div>

            <div class="flex gap-2 mb-4">
                <button class="w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center text-gray-400"><i class="fas fa-camera"></i></button>
                <input type="text" id="note-input" placeholder="å‚™è¨» (å¦‚: 7-11)" class="flex-1 bg-gray-50 rounded-lg px-3 text-sm outline-none">
            </div>

            <button onclick="submitTx()" class="w-full bg-jp-text text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition">æ–°å¢ç´€éŒ„</button>
        </div>

        <div class="mt-6">
            <div class="flex justify-between items-center mb-2 px-1">
                <h3 class="text-sm font-bold text-gray-500">è¿‘æœŸç´€éŒ„</h3>
                <button onclick="clearTx()" class="text-xs text-red-300">æ¸…ç©º</button>
            </div>
            <div id="tx-history" class="space-y-2 pb-10"></div>
        </div>
    </div>
    
    <div id="tab-checklist" class="section px-5 py-4 pb-24">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">è¡Œææ¸…å–®</h2>
            <div class="flex gap-2">
                <button onclick="addChecklistCategory()" class="w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center"><i class="fas fa-folder-plus text-xs"></i></button>
                <button onclick="addChecklistItem()" class="w-8 h-8 rounded-full bg-jp-accent text-white flex items-center justify-center shadow-md"><i class="fas fa-plus text-xs"></i></button>
            </div>
        </div>
        <div id="checklist-container"></div>
    </div>

    <div id="tab-settings" class="section px-5 py-4 pb-24">
        <h2 class="text-xl font-bold mb-6">è³‡æ–™åŒæ­¥ & è¨­å®š</h2>
        
        <div class="bg-white rounded-2xl shadow-soft p-5 mb-6 border border-jp-blue/20">
            <h3 class="font-bold text-jp-blue mb-2"><i class="fas fa-sync-alt mr-2"></i>è³‡æ–™åŒæ­¥ (ç„¡ä¼ºæœå™¨ç‰ˆ)</h3>
            <p class="text-xs text-gray-500 mb-4 leading-relaxed">
                å› ç‚ºæœ¬ç¶²é æ²’æœ‰å¾Œç«¯è³‡æ–™åº«ï¼Œè‹¥è¦èˆ‡æœ‹å‹åŒæ­¥è³‡æ–™ï¼š<br>
                1. é»æ“Šã€ŒåŒ¯å‡ºã€è¤‡è£½ä»£ç¢¼ã€‚<br>
                2. å‚³ Line çµ¦æœ‹å‹ã€‚<br>
                3. æœ‹å‹è¤‡è£½ä»£ç¢¼ï¼Œé»æ“Šã€ŒåŒ¯å…¥ã€ã€‚
            </p>
            <div class="flex gap-3">
                <button onclick="exportData()" class="flex-1 bg-jp-blue text-white py-3 rounded-lg text-sm shadow hover:opacity-90">
                    <i class="fas fa-copy mr-1"></i> åŒ¯å‡ºè³‡æ–™
                </button>
                <button onclick="openImportModal()" class="flex-1 bg-gray-600 text-white py-3 rounded-lg text-sm shadow hover:opacity-90">
                    <i class="fas fa-paste mr-1"></i> åŒ¯å…¥è³‡æ–™
                </button>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-soft p-5">
            <h3 class="font-bold text-jp-text mb-3">ç·Šæ€¥è¯çµ¡é›»è©±</h3>
            <div class="space-y-2">
                <div class="flex justify-between text-sm border-b border-gray-50 pb-2"><span>è§€å…‰è­¦å¯Ÿ</span><span class="font-bold text-red-500">1155</span></div>
                <div class="flex justify-between text-sm border-b border-gray-50 pb-2"><span>æ•‘è­·è»Š</span><span class="font-bold text-red-500">1669</span></div>
                <div class="flex justify-between text-sm"><span>é§æ³°ä»£è¡¨è™•</span><span class="font-bold text-blue-500">+66-81-666-4006</span></div>
            </div>
        </div>
        
        <div class="mt-8 text-center">
             <button onclick="hardReset()" class="text-xs text-red-400 underline p-2">é‡ç½®æ‰€æœ‰ App è³‡æ–™ (æ…ç”¨)</button>
        </div>
    </div>

    <nav class="fixed bottom-6 left-5 right-5 h-16 bg-white/95 backdrop-blur rounded-2xl flex justify-around items-center shadow-gold z-50 border border-gray-100">
        <button onclick="switchTab('tab-home')" class="nav-btn active flex flex-col items-center gap-1 text-gray-400" data-target="tab-home">
            <i class="fas fa-home text-lg"></i><span class="text-[10px]">é¦–é </span>
        </button>
        <button onclick="switchTab('tab-itinerary')" class="nav-btn flex flex-col items-center gap-1 text-gray-400" data-target="tab-itinerary">
            <i class="fas fa-map-marked-alt text-lg"></i><span class="text-[10px]">è¡Œç¨‹</span>
        </button>
        <div class="relative -top-6">
            <button onclick="switchTab('tab-account')" class="w-14 h-14 bg-jp-text rounded-full shadow-lg flex items-center justify-center text-white text-xl transform hover:scale-105 transition active:scale-95 border-4 border-[#F9F8F4]">
                <i class="fas fa-plus"></i>
            </button>
        </div>
        <button onclick="switchTab('tab-checklist')" class="nav-btn flex flex-col items-center gap-1 text-gray-400" data-target="tab-checklist">
            <i class="fas fa-check-circle text-lg"></i><span class="text-[10px]">æ¸…å–®</span>
        </button>
        <button onclick="switchTab('tab-settings')" class="nav-btn flex flex-col items-center gap-1 text-gray-400" data-target="tab-settings">
            <i class="fas fa-cog text-lg"></i><span class="text-[10px]">æˆ‘çš„</span>
        </button>
    </nav>

    <div id="import-modal" class="modal-overlay">
        <div class="bg-white w-4/5 rounded-2xl p-5 shadow-2xl">
            <h3 class="font-bold text-lg mb-2">è²¼ä¸Šè³‡æ–™ä»£ç¢¼</h3>
            <textarea id="import-area" class="w-full h-32 bg-gray-50 border border-gray-200 rounded-lg p-2 text-xs mb-4" placeholder="è«‹åœ¨æ­¤è²¼ä¸Šæœ‹å‹å‚³ä¾†çš„ä»£ç¢¼..."></textarea>
            <div class="flex gap-2">
                <button onclick="closeModal('import-modal')" class="flex-1 py-2 rounded-lg border border-gray-200 text-sm">å–æ¶ˆ</button>
                <button onclick="confirmImport()" class="flex-1 py-2 rounded-lg bg-jp-text text-white text-sm">ç¢ºå®šåŒ¯å…¥</button>
            </div>
        </div>
    </div>
    
    <div id="advance-modal" class="modal-overlay">
        <div class="bg-white w-4/5 rounded-2xl p-5 shadow-2xl">
            <h3 class="font-bold text-lg mb-2">å¹«èª°ä»£å¢Š?</h3>
            <div id="advance-list" class="space-y-2 mb-4"></div>
            <div class="flex gap-2">
                <button onclick="closeModal('advance-modal')" class="flex-1 py-2 rounded-lg border border-gray-200 text-sm">å–æ¶ˆ</button>
                <button onclick="confirmAdvance()" class="flex-1 py-2 rounded-lg bg-jp-text text-white text-sm">ç¢ºå®š</button>
            </div>
        </div>
    </div>

</div>

<script>
    // --- DATA & STATE ---
    const ITINERARY_DATA = [
        {
            day: 1, date: "12/23 (äºŒ)", desc: "æŠµé”æ›¼è°·", 
            spots: [
                { time: "18:00", name: "é«˜é›„æ©Ÿå ´å‡ºç™¼", desc: "æ³°åœ‹äºèˆª FD235 âœˆï¸", icon: "fa-plane", color: "text-blue-500" },
                { time: "21:30", name: "æŠµé”å»Šæ›¼æ©Ÿå ´", desc: "é è¨ˆå‡ºé—œé ˜è¡Œæ", icon: "fa-plane-arrival", color: "text-blue-500" },
                { time: "22:30", name: "æ©Ÿå ´åŒ…è»Šæ¥æ©Ÿ", desc: "å‰å¾€ B2 é£¯åº— (è»Šç¨‹ç´„30åˆ†)", icon: "fa-car", color: "text-green-600", highlight: true },
                { time: "Late", name: "å”äººè¡—å®µå¤œ", desc: "Check-in å¾Œè¦“é£Ÿ", icon: "fa-utensils", color: "text-orange-500", link: "https://www.google.com/search?q=æ›¼è°·å”äººè¡—ç¾é£Ÿ" }
            ]
        },
        {
            day: 2, date: "12/24 (ä¸‰)", desc: "èˆŠåŸå¤è¹Ÿå·¡ç¦®", 
            spots: [
                { time: "Day", name: "çŸ³é¾è»è·¯", desc: "æ–‡é’æ•£ç­– / ç¾é£Ÿ", icon: "fa-walking", color: "text-gray-500", link: "https://www.google.com/maps/search/Charoen+Krung+Road" },
                { time: "10:00", name: "è‡¥ä½›å¯º & é„­ç‹å»Ÿ", desc: "å¿…æ‹å¤è¹Ÿ", icon: "fa-gopuram", color: "text-yellow-600", link: "https://www.google.com/maps/search/Wat+Arun" },
                { time: "12:00", name: "ç‹æœ—å¸‚å ´", desc: "åœ¨åœ°å¸‚é›†åˆé¤", icon: "fa-store", color: "text-orange-500", link: "https://www.google.com/maps/search/Wang+Lang+Market" },
                { time: "19:00", name: "River City éƒµè¼ª", desc: "æ˜­æŠ«è€¶æ²³æ™šé¤", icon: "fa-ship", color: "text-blue-600" }
            ]
        },
        {
            day: 3, date: "12/25 (å››)", desc: "é€šç¾…æ™‚å°šæ¼«éŠ", 
            spots: [
                { time: "09:00", name: "ç›Šç”Ÿç”«è¨˜ / å®‰æ¨‚åœ’", desc: "æ³°å¼å‚³çµ±æ—©é¤", icon: "fa-coffee", color: "text-brown-500" },
                { time: "10:30", name: "åµ©è¶Šè·¯", desc: "ç¶²ç¾å’–å•¡è¡—", icon: "fa-camera", color: "text-pink-500" },
                { time: "12:00", name: "æ›é£¯åº—", desc: "å‰å¾€ Jasmine 59 Hotel (é€šç¾…)", icon: "fa-suitcase", color: "text-jp-blue" },
                { time: "PM", name: "é€›ç™¾è²¨å…¬å¸", desc: "Iconsiam / Central World", icon: "fa-shopping-bag", color: "text-purple-500" }
            ]
        },
        {
            day: 4, date: "12/26 (äº”)", desc: "æ°´ä¸Šå¸‚å ´ä¸€æ—¥éŠ", 
            spots: [
                { time: "08:00", name: "åŒ…è»Šå‡ºç™¼", desc: "é£¯åº—å¤§å»³é›†åˆ (æº–æ™‚!)", icon: "fa-car", color: "text-red-500", highlight: true },
                { time: "10:00", name: "ç¾åŠŸéµé“å¸‚å ´", desc: "çœ‹ç«è»Šé€²ç«™", icon: "fa-train", color: "text-orange-500" },
                { time: "12:00", name: "ä¸¹å«©èæ°´ä¸Šå¸‚å ´", desc: "æ‰‹æ–èˆ¹é«”é©—", icon: "fa-water", color: "text-blue-400" },
                { time: "14:00", name: "æ¨¹ä¸­å»Ÿ", desc: "éˆé©—å¤å»Ÿ", icon: "fa-vihara", color: "text-yellow-600" },
                { time: "16:00", name: "è¿”å›æ›¼è°·", desc: "å›é£¯åº—æˆ–æŒ‰æ‘©", icon: "fa-home", color: "text-gray-500" }
            ]
        }
    ];

    let state = {
        users: ['å°æœ±', 'ç°¡å“¥', 'å…¬è²»åŒ…', 'åœ˜å“¡A', 'åœ˜å“¡B', 'åœ˜å“¡C'],
        fundBalance: 0,
        currency: 'THB',
        transactions: [],
        currentDay: 0,
        checklist: [
            { title: "è­‰ä»¶æ–‡ä»¶", items: [{name: "è­·ç…§", checked: true}, {name: "é›»å­æ©Ÿç¥¨", checked: false}, {name: "é£¯åº—æ†‘è­‰", checked: false}] },
            { title: "é›»å­ç”¨å“", items: [{name: "ç¶²å¡/é‡", checked: false}, {name: "è¡Œå‹•é›»æº", checked: false}, {name: "è½‰æ¥é ­", checked: false}] }
        ],
        tempAdvanceUsers: [] // temporary logic
    };

    // --- INIT ---
    document.addEventListener('DOMContentLoaded', () => {
        loadData();
        updateDate();
        fetchWeather();
        renderDayTabs();
        renderItinerary();
        renderAccCats();
        renderPayers();
        updateFundDisplay();
        renderHistory();
        renderChecklist();
    });

    // --- HOME ---
    function updateDate() {
        document.getElementById('current-date-display').innerText = new Date().toLocaleDateString('en-US', {month:'short', day:'numeric'});
    }
    async function fetchWeather() {
        try {
            const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=13.75&longitude=100.50&current_weather=true');
            const data = await res.json();
            document.getElementById('header-weather').innerHTML = `${Math.round(data.current_weather.temperature)}Â°C <i class="fas fa-sun text-yellow-400"></i>`;
        } catch { document.getElementById('header-weather').innerText = "28Â°C"; }
    }
    function translateThai() {
        const txt = document.getElementById('thai-input').value;
        if(txt) window.open(`https://translate.google.com/?sl=zh-TW&tl=th&text=${encodeURIComponent(txt)}&op=translate`, '_blank');
    }

    // --- ITINERARY ---
    function renderDayTabs() {
        const c = document.getElementById('day-tabs');
        c.innerHTML = ITINERARY_DATA.map((d, i) => `
            <button onclick="setDay(${i})" class="flex-shrink-0 px-4 py-2 rounded-xl border ${state.currentDay===i ? 'bg-jp-text text-white border-jp-text shadow-md' : 'bg-white text-gray-400 border-gray-100'}">
                <span class="block text-xs font-bold">Day ${d.day}</span>
                <span class="text-[10px] whitespace-nowrap">${d.date.split(' ')[0]}</span>
            </button>
        `).join('');
    }
    function setDay(i) { state.currentDay = i; renderDayTabs(); renderItinerary(); }
    
    function renderItinerary() {
        const d = ITINERARY_DATA[state.currentDay];
        const c = document.getElementById('itinerary-content');
        c.innerHTML = d.spots.map(s => `
            <div class="timeline-item">
                <div class="timeline-dot" style="${s.highlight ? 'background:#ef4444; border-color:#fee2e2;' : ''}"></div>
                <span class="timeline-time ${s.highlight ? 'text-red-500' : ''}">${s.time}</span>
                <div class="bg-white p-3 rounded-xl shadow-sm border border-gray-50">
                    <div class="flex justify-between items-start">
                        <p class="text-sm font-bold text-jp-text"><i class="fas ${s.icon} ${s.color} mr-1"></i> ${s.name}</p>
                        ${s.link ? `<a href="${s.link}" target="_blank" class="text-xs text-blue-400"><i class="fas fa-external-link-alt"></i></a>` : ''}
                    </div>
                    <p class="text-xs text-gray-500 mt-1">${s.desc}</p>
                </div>
            </div>
        `).join('');
    }

    // --- ACCOUNTING ---
    let acc = { cat: 'é¤é£²', payer: 'å…¬è²»åŒ…', split: 'shared', cur: 'THB' };

    function renderAccCats() {
        const cats = [{n:'é¤é£²',i:'fa-utensils'}, {n:'äº¤é€š',i:'fa-car'}, {n:'è³¼ç‰©',i:'fa-shopping-bag'}, {n:'ä½å®¿',i:'fa-bed'}, {n:'å…¶ä»–',i:'fa-ellipsis-h'}];
        document.getElementById('cat-container').innerHTML = cats.map((c, i) => `
            <button onclick="setCat('${c.n}', this)" class="cat-btn ${i===0?'active':''} flex-shrink-0 w-16 h-16 rounded-xl flex flex-col items-center justify-center bg-white border border-gray-100">
                <i class="fas ${c.i} text-lg mb-1"></i><span class="text-xs">${c.n}</span>
            </button>
        `).join('');
    }
    function setCat(n, el) { acc.cat = n; document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active')); el.classList.add('active'); }
    
    function renderPayers() {
        document.getElementById('payer-container').innerHTML = state.users.map(u => `
            <button onclick="setPayer('${u}', this)" class="payer-btn ${u==='å…¬è²»åŒ…'?'active':''} px-3 py-1 bg-gray-50 text-gray-400 rounded-lg text-xs border border-transparent">${u}</button>
        `).join('');
    }
    function setPayer(u, el) { acc.payer = u; document.querySelectorAll('.payer-btn').forEach(b=>b.classList.remove('active')); el.classList.add('active'); }

    function setCurrency(c) { 
        acc.cur = c; 
        document.getElementById('cur-twd').className = c==='TWD' ? "px-3 py-1 text-xs rounded bg-white shadow-sm text-jp-text font-bold" : "px-3 py-1 text-xs rounded text-gray-400 font-bold";
        document.getElementById('cur-thb').className = c==='THB' ? "px-3 py-1 text-xs rounded bg-white shadow-sm text-jp-text font-bold" : "px-3 py-1 text-xs rounded text-gray-400 font-bold";
    }

    function setSplit(t) {
        acc.split = t;
        document.querySelectorAll('.split-btn').forEach(b => { b.classList.remove('active'); b.classList.add('text-gray-400'); });
        const btn = document.getElementById(`split-${t}`);
        btn.classList.add('active'); btn.classList.remove('text-gray-400');
    }

    function submitTx() {
        const amt = parseFloat(document.getElementById('amt-input').value);
        const note = document.getElementById('note-input').value;
        if (!amt) return alert("è«‹è¼¸å…¥é‡‘é¡");

        if (acc.split === 'advance') {
            document.getElementById('advance-modal').classList.add('open');
            const list = document.getElementById('advance-list');
            list.innerHTML = state.users.filter(u => u !== 'å…¬è²»åŒ…').map(u => `
                <label class="flex items-center gap-2 p-2 bg-gray-50 rounded"><input type="checkbox" value="${u}"> ${u}</label>
            `).join('');
            return; // Wait for modal
        }

        processTx(amt, note, acc.payer, acc.split, acc.cat, acc.cur, []);
    }

    function confirmAdvance() {
        const amt = parseFloat(document.getElementById('amt-input').value);
        const note = document.getElementById('note-input').value;
        const checked = Array.from(document.querySelectorAll('#advance-list input:checked')).map(cb => cb.value);
        if(checked.length === 0) return alert("è«‹é¸æ“‡ä»£å¢Šå°è±¡");
        
        processTx(amt, note, acc.payer, 'advance', acc.cat, acc.cur, checked);
        closeModal('advance-modal');
    }

    function processTx(amt, note, payer, split, cat, cur, targets) {
        // Fund Logic (Simple TWD assumption 1:1 for logic, in real app need rate)
        if(split === 'deposit') {
            state.fundBalance += amt;
        } else if (payer === 'å…¬è²»åŒ…') {
            state.fundBalance -= amt;
        }

        state.transactions.unshift({ date: new Date().toLocaleString(), amt, note, payer, split, cat, cur, targets });
        saveData();
        updateFundDisplay();
        renderHistory();
        document.getElementById('amt-input').value = '';
        document.getElementById('note-input').value = '';
        alert("å·²è¨˜éŒ„");
    }

    function updateFundDisplay() {
        const txt = `à¸¿ ${state.fundBalance.toLocaleString()}`;
        document.getElementById('acc-fund-display').innerText = txt;
        document.getElementById('dash-fund').innerText = "å…¬è²»: " + txt;
    }

    function renderHistory() {
        document.getElementById('tx-history').innerHTML = state.transactions.slice(0, 10).map(t => `
            <div class="bg-white p-3 rounded-xl shadow-sm flex justify-between items-center border border-gray-50">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-xs text-gray-500">${t.payer[0]}</div>
                    <div>
                        <p class="text-sm font-bold text-jp-text">${t.note || t.cat}</p>
                        <p class="text-[10px] text-gray-400">${t.split === 'deposit' ? 'å…¥é‡‘' : t.split === 'advance' ? `ä»£å¢Š(${t.targets.length})` : 'æ”¯å‡º'}</p>
                    </div>
                </div>
                <span class="font-bold ${t.split === 'deposit' ? 'text-green-500' : 'text-jp-text'}">${t.split==='deposit' ? '+' : '-'} ${t.amt}</span>
            </div>
        `).join('');
    }
    
    function clearTx() { if(confirm("ç¢ºå®šæ¸…ç©º?")) { state.transactions=[]; state.fundBalance=0; saveData(); location.reload(); }}
    function editUsers() { 
        const n = prompt("è¼¸å…¥æ–°æˆå“¡åå–® (ç”¨é€—è™Ÿåˆ†éš”)", state.users.join(','));
        if(n) { state.users = n.split(','); saveData(); renderPayers(); }
    }

    // --- CHECKLIST ---
    function renderChecklist() {
        let total=0, checked=0;
        document.getElementById('checklist-container').innerHTML = state.checklist.map((g, gi) => `
            <div class="bg-white rounded-xl p-4 shadow-soft mb-3">
                <div class="flex justify-between mb-2">
                    <input type="text" value="${g.title}" onchange="updateCheckTitle(${gi}, this.value)" class="font-bold text-sm bg-transparent outline-none">
                    <span class="text-xs text-gray-400">${g.items.filter(i=>i.checked).length}/${g.items.length}</span>
                </div>
                <div class="w-full bg-gray-100 h-1 rounded-full mb-3"><div class="bg-jp-green h-1 rounded-full" style="width:${(g.items.filter(i=>i.checked).length/g.items.length)*100}%"></div></div>
                <div class="space-y-2">
                    ${g.items.map((i, ii) => {
                        total++; if(i.checked) checked++;
                        return `<div class="flex items-center justify-between">
                            <label class="flex items-center gap-2 text-sm text-gray-600">
                                <input type="checkbox" ${i.checked?'checked':''} class="accent-jp-green" onchange="toggleCheck(${gi}, ${ii})">
                                <span class="${i.checked?'line-through text-gray-300':''}">${i.name}</span>
                            </label>
                            <button onclick="delCheckItem(${gi}, ${ii})" class="text-gray-200 text-xs"><i class="fas fa-times"></i></button>
                        </div>`;
                    }).join('')}
                    <button onclick="addCheckItemTo(${gi})" class="text-xs text-jp-blue mt-2">+ æ–°å¢ç´°é …</button>
                </div>
            </div>
        `).join('');
        document.getElementById('home-check-progress').innerText = `å®Œæˆåº¦ ${total===0?0:Math.round((checked/total)*100)}%`;
    }
    function toggleCheck(gi, ii) { state.checklist[gi].items[ii].checked = !state.checklist[gi].items[ii].checked; saveData(); renderChecklist(); }
    function addChecklistCategory() { state.checklist.push({title:'æ–°åˆ†é¡', items:[]}); saveData(); renderChecklist(); }
    function addChecklistItem() { const n = prompt("é …ç›®åç¨±"); if(n) { state.checklist[0].items.push({name:n, checked:false}); saveData(); renderChecklist(); }} 
    function addCheckItemTo(gi) { const n = prompt("é …ç›®åç¨±"); if(n) { state.checklist[gi].items.push({name:n, checked:false}); saveData(); renderChecklist(); }}
    function updateCheckTitle(gi, v) { state.checklist[gi].title = v; saveData(); }
    function delCheckItem(gi, ii) { state.checklist[gi].items.splice(ii,1); saveData(); renderChecklist(); }

    // --- SYSTEM ---
    function switchTab(id) {
        document.querySelectorAll('.section').forEach(e => e.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => { b.classList.remove('active'); b.style.color=''; });
        const btn = document.querySelector(`.nav-btn[data-target="${id}"]`);
        if(btn) btn.classList.add('active');
    }
    
    function saveData() { localStorage.setItem('bkk_2025_v3', JSON.stringify(state)); }
    function loadData() { 
        const d = localStorage.getItem('bkk_2025_v3');
        if(d) {
            try { 
                const p = JSON.parse(d);
                // Simple merge to keep logic safe
                state.fundBalance = p.fundBalance || 0;
                state.transactions = p.transactions || [];
                state.checklist = p.checklist || state.checklist;
                state.users = p.users || state.users;
            } catch(e) { console.log('Reset data'); }
        }
    }
    
    // Sync Logic
    function exportData() { navigator.clipboard.writeText(JSON.stringify(state)); alert("ä»£ç¢¼å·²è¤‡è£½ï¼è«‹å‚³çµ¦æœ‹å‹"); }
    function openImportModal() { document.getElementById('import-modal').classList.add('open'); }
    function closeModal(id) { document.getElementById(id).classList.remove('open'); }
    function confirmImport() {
        const v = document.getElementById('import-area').value;
        if(v) { 
            try { 
                state = JSON.parse(v); saveData(); location.reload(); 
            } catch { alert("æ ¼å¼éŒ¯èª¤"); }
        }
    }
    function hardReset() { if(confirm("ç¢ºå®šåˆªé™¤æ‰€æœ‰è³‡æ–™?")) { localStorage.removeItem('bkk_2025_v3'); location.reload(); }}

</script>
</body>
</html>
