<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2025 æ›¼è°·è–èª•è·¨å¹´ - æ³°å»¢äº† (V27)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Zen+Kaku+Gothic+New:wght@400;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'jp-bg': '#F9F8F4',
                        'jp-text': '#4A4A4A',
                        'jp-accent': '#C6A568',
                        'jp-blue': '#6B8EAD',
                        'jp-green': '#8DA399',
                        'jp-red': '#D67D7D',
                        'mag-paper': '#FFFBF0',
                        'wallet-blue': '#3B82F6',
                    },
                    fontFamily: {
                        sans: ['"Zen Kaku Gothic New"', '"Noto Sans TC"', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 20px rgba(0, 0, 0, 0.03)',
                        'gold': '0 4px 15px rgba(198, 165, 104, 0.15)',
                        'card': '0 8px 24px rgba(0, 0, 0, 0.06)',
                    }
                }
            }
        }
    </script>
   
    <style>
        body { background-color: #F0F0F0; font-family: 'Zen Kaku Gothic New', sans-serif; -webkit-tap-highlight-color: transparent; user-select: none; }
        .app-container { background-color: #F9F8F4; max-width: 430px; margin: 0 auto; min-height: 100vh; padding-bottom: 100px; overflow-x: hidden; position: relative; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Timeline */
        .timeline-item { position: relative; padding-left: 28px; padding-bottom: 24px; border-left: 2px solid #E5E7EB; margin-left: 10px; }
        .timeline-item:last-child { border-left: 2px solid transparent; }
        .timeline-dot { position: absolute; left: -7px; top: 12px; width: 12px; height: 12px; border-radius: 50%; background: #C6A568; border: 2px solid #F9F8F4; z-index: 10; }
        .timeline-time { font-size: 11px; font-weight: bold; color: #6B8EAD; margin-bottom: 4px; display: block; margin-left: 4px; }

        /* Card Interactions */
        .spot-card { transition: transform 0.1s, box-shadow 0.1s; cursor: pointer; }
        .spot-card:active { transform: scale(0.98); }

        /* Bottom Sheet (Slide Up Modal) */
        .bottom-sheet-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9000; opacity: 0; pointer-events: none; transition: opacity 0.3s; display: flex; align-items: flex-end; justify-content: center; }
        .bottom-sheet-overlay.active { opacity: 1; pointer-events: auto; }
        
        .bottom-sheet-content { background: white; width: 100%; max-width: 430px; border-radius: 24px 24px 0 0; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); max-height: 85vh; overflow-y: auto; padding-bottom: 40px; position: relative; }
        .bottom-sheet-overlay.active .bottom-sheet-content { transform: translateY(0); }

        /* Point & Speak Fullscreen */
        .speak-modal { position: fixed; inset: 0; background: #1A202C; z-index: 10000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; animation: popIn 0.2s; }
        .speak-modal.active { display: flex; }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* Weather Scroll */
        .weather-scroll { -webkit-overflow-scrolling: touch; scroll-snap-type: x mandatory; }
        .weather-item { scroll-snap-align: start; }

        /* General UI */
        .cat-btn.active { border: 1px solid #C6A568; background-color: #FFFCF5; color: #C6A568; }
        .payer-btn.active { background-color: #FFF9E6; border: 1px solid #C6A568; color: #C6A568; font-weight: bold; }
        .split-btn.active { background-color: #4A4A4A; color: white; }
        .nav-btn.active { color: #C6A568; }
        .nav-btn.active i { transform: scale(1.1); transition: 0.2s; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9500; display: none; align-items: center; justify-content: center; }
        .modal-overlay.open { display: flex; }
        
        /* Direct Action Buttons on Card */
        .card-action-btn { 
            font-size: 11px; padding: 6px 12px; border-radius: 8px; font-weight: bold; 
            display: flex; align-items: center; gap: 4px; transition: background 0.2s;
        }
        .card-action-btn:active { transform: scale(0.95); }
    </style>
</head>
<body>

<div class="app-container">
    
    <div class="fixed right-5 bottom-28 z-[100] flex flex-col gap-3">
        <button onclick="syncToCloud('download')" class="w-10 h-10 rounded-full bg-white shadow-lg border border-gray-100 flex items-center justify-center text-gray-500 active:scale-90 transition hover:text-jp-blue"><i class="fas fa-cloud-download-alt"></i></button>
        <button onclick="syncToCloud('upload')" class="w-10 h-10 rounded-full bg-jp-text shadow-lg border border-jp-text flex items-center justify-center text-white active:scale-90 transition hover:bg-gray-700"><i class="fas fa-cloud-upload-alt"></i></button>
    </div>

    <header class="sticky top-0 z-50 bg-[#F9F8F4]/95 backdrop-blur-sm px-5 py-4 flex justify-between items-end border-b border-gray-100">
        <div>
            <p class="text-[10px] text-gray-400 tracking-widest mb-1">DEC 23 - DEC 28</p>
            <h1 class="text-xl font-bold text-jp-text tracking-wide leading-tight">2025 æ›¼è°·è–èª•è·¨å¹´<br><span class="text-jp-accent text-lg">- æ³°å»¢äº† -</span></h1>
        </div>
        <div class="text-center">
             <span class="block text-[10px] text-gray-400">æ›¼è°·</span>
             <span class="text-sm font-medium" id="header-status">Loading...</span>
        </div>
    </header>

    <div id="tab-home" class="section active px-5 py-4">
        
        <div class="mb-5">
            <h3 class="text-xs font-bold text-gray-400 mb-2 uppercase ml-1">Hourly Forecast</h3>
            <div class="bg-white rounded-xl p-3 shadow-sm border border-gray-50 flex gap-4 overflow-x-auto hide-scrollbar weather-scroll" id="weather-strip">
                <div class="flex-shrink-0 text-center min-w-[50px]"><span class="text-[10px] text-gray-400">Now</span><br><i class="fas fa-sun text-yellow-400 my-1"></i><br><span class="text-xs font-bold">30Â°</span></div>
                <div class="flex-shrink-0 text-center min-w-[50px]"><span class="text-[10px] text-gray-400">14:00</span><br><i class="fas fa-cloud-sun text-yellow-400 my-1"></i><br><span class="text-xs font-bold">31Â°</span></div>
                <div class="flex-shrink-0 text-center min-w-[50px]"><span class="text-[10px] text-gray-400">15:00</span><br><i class="fas fa-cloud text-gray-300 my-1"></i><br><span class="text-xs font-bold">30Â°</span></div>
                <div class="flex-shrink-0 text-center min-w-[50px]"><span class="text-[10px] text-gray-400">16:00</span><br><i class="fas fa-cloud-rain text-blue-400 my-1"></i><br><span class="text-xs font-bold">29Â°</span></div>
                <div class="flex-shrink-0 text-center min-w-[50px]"><span class="text-[10px] text-gray-400">17:00</span><br><i class="fas fa-cloud-showers-heavy text-blue-500 my-1"></i><br><span class="text-xs font-bold">28Â°</span></div>
                <div class="flex-shrink-0 text-center min-w-[50px]"><span class="text-[10px] text-gray-400">18:00</span><br><i class="fas fa-moon text-gray-400 my-1"></i><br><span class="text-xs font-bold">27Â°</span></div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="bg-white rounded-[24px] p-5 shadow-soft flex flex-col justify-center h-32 relative overflow-hidden">
                <p class="text-xs text-gray-400 font-bold mb-1">åŒ¯ç‡ (TWD/THB)</p>
                <p class="text-[40px] font-bold text-jp-text tracking-tighter leading-none mt-1" id="home-rate-display">0.99</p>
            </div>
            <div class="bg-white rounded-[24px] p-5 shadow-soft flex flex-col justify-center h-32 cursor-pointer active:scale-95 transition" onclick="switchTab('tab-account')">
                <p class="text-xs text-gray-400 font-bold mb-1">å…¬è²»éŒ¢åŒ…</p>
                <p class="text-[40px] font-bold text-wallet-blue tracking-tighter leading-none mt-1 truncate" id="home-fund-display">à¸¿0</p>
            </div>
        </div>

        <div class="bg-white rounded-[24px] p-4 shadow-soft mb-6 flex items-center gap-3">
            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center text-purple-500 flex-shrink-0">
                <i class="fas fa-language text-xl"></i>
            </div>
            <div class="flex-1">
                <p class="text-[10px] text-gray-400 font-bold mb-1">æ±‚ç”Ÿæ³°èª (è¼¸å…¥ä¸­æ–‡)</p>
                <input type="text" id="thai-input" placeholder="ä¸è¦é¦™èœ..." class="w-full text-lg font-bold text-gray-700 placeholder-gray-200 outline-none">
            </div>
            <button onclick="translateThai()" class="text-purple-500 font-bold text-sm px-2">
                ç¿»è­¯
            </button>
        </div>

        <h3 class="text-sm font-bold text-gray-400 mb-3 ml-1 uppercase tracking-wider">Quick Access</h3>
        <div class="grid grid-cols-2 gap-3 mb-20">
            <button onclick="switchTab('tab-itinerary')" class="bg-white p-4 rounded-xl shadow-soft text-left flex flex-col justify-between h-24 relative overflow-hidden group active:scale-95 transition">
                <div class="absolute top-0 right-0 w-12 h-12 bg-jp-blue/10 rounded-full -mr-4 -mt-4"></div>
                <i class="fas fa-map-marked-alt text-jp-blue text-xl relative z-10"></i>
                <div>
                    <span class="text-sm font-bold block text-jp-text">è¡Œç¨‹è¦åŠƒ</span>
                    <span class="text-xs text-gray-400 font-sans" id="current-date-display">Dec 23</span>
                </div>
            </button>

            <button onclick="switchTab('tab-account')" class="bg-white p-4 rounded-xl shadow-soft text-left flex flex-col justify-between h-24 border border-jp-accent/20 active:scale-95 transition">
                <div class="flex justify-between">
                    <i class="fas fa-calculator text-jp-red text-xl"></i>
                </div>
                <div>
                    <span class="text-sm font-bold block text-jp-text">è¨˜å¸³</span>
                    <span class="text-xs text-gray-400">å¿«é€Ÿç´€éŒ„</span>
                </div>
            </button>

             <button onclick="switchTab('tab-checklist')" class="bg-white p-4 rounded-xl shadow-soft text-left flex flex-col justify-between h-24 active:scale-95 transition">
                <i class="fas fa-info-circle text-jp-accent text-xl"></i>
                <div>
                    <span class="text-sm font-bold block text-jp-text">è³‡è¨Š & æ¸…å–®</span>
                    <span class="text-xs text-gray-400" id="home-check-progress">å®Œæˆåº¦ 0%</span>
                </div>
            </button>
        </div>
    </div>

    <div id="tab-itinerary" class="section pb-24">
        <div class="sticky top-[72px] z-40 bg-[#F9F8F4] px-4 py-2 mb-2 shadow-sm flex items-center">
            <div class="flex-1 overflow-x-auto hide-scrollbar flex gap-3 pr-4" id="day-tabs"></div>
            
            <div class="flex gap-2 pl-2 border-l border-gray-200 bg-[#F9F8F4] flex-shrink-0">
                <button onclick="openSortModal()" class="w-8 h-8 rounded-full bg-white border border-gray-200 text-gray-500 flex items-center justify-center shadow-sm active:scale-90 transition"><i class="fas fa-sort text-xs"></i></button>
                <button onclick="openEditSpot()" class="w-8 h-8 rounded-full bg-jp-text text-white flex items-center justify-center shadow-md active:scale-90 transition"><i class="fas fa-plus text-xs"></i></button>
            </div>
        </div>

        <div id="itinerary-content" class="px-5 space-y-4 min-h-[50vh]">
            </div>

        <div class="px-5 mt-8 mb-4">
             <h3 class="text-sm font-bold text-gray-400 mb-2 uppercase">ä½å®¿è³‡è¨Š</h3>
             <div class="bg-white rounded-xl p-3 shadow-sm border-l-4 border-jp-blue mb-2">
                 <p class="text-xs font-bold text-jp-blue">12/23 - 12/25 (å”äººè¡—)</p>
                 <p class="text-sm font-bold text-jp-text">B2 å”äººè¡—è€€è¯åŠ›å°Šå°šé£¯åº—</p>
                 <a href="https://maps.app.goo.gl/ZjNM4vwDCNQdAq637?g_st=ipc" target="_blank" class="text-[10px] text-gray-400 underline"><i class="fas fa-map-marker-alt"></i> æŸ¥çœ‹åœ°åœ–</a>
             </div>
             <div class="bg-white rounded-xl p-3 shadow-sm border-l-4 border-jp-accent">
                 <p class="text-xs font-bold text-jp-accent">12/25 - 12/27 (é€šç¾…)</p>
                 <p class="text-sm font-bold text-jp-text">æ›¼è°·èŒ‰è‰èŠ±59è™Ÿé£¯åº—</p>
                 <a href="https://maps.app.goo.gl/DmVbJdwrbkwQ7p8K6?g_st=ipc" target="_blank" class="text-[10px] text-gray-400 underline"><i class="fas fa-map-marker-alt"></i> æŸ¥çœ‹åœ°åœ–</a>
             </div>
        </div>
    </div>

    <div id="tab-account" class="section px-4 py-4 pb-24">
        <div class="bg-white rounded-2xl shadow-gold p-5 border border-gray-50 relative">
            <div class="absolute top-4 right-4 text-right">
                <p class="text-[10px] text-gray-400">å…¬è²»åŒ…é¤˜é¡ (THB)</p>
                <p class="text-xl font-bold text-jp-accent" id="acc-fund-display">à¸¿ 0</p>
            </div>
            <h2 class="text-lg font-bold text-jp-text mb-4">æ–°å¢è¨˜å¸³</h2>
            <div class="flex justify-between gap-2 overflow-x-auto hide-scrollbar mb-4" id="cat-container"></div>
            <div class="flex items-end gap-3 mb-4 border-b border-gray-100 pb-2">
                 <div class="flex bg-gray-50 rounded-lg p-1">
                    <button onclick="setCurrency('TWD')" id="cur-twd" class="px-3 py-1 text-xs rounded text-gray-400 font-bold">TWD</button>
                    <button onclick="setCurrency('THB')" id="cur-thb" class="px-3 py-1 text-xs rounded bg-white shadow-sm text-jp-text font-bold">THB</button>
                </div>
                <input type="number" id="amt-input" placeholder="0" class="flex-1 text-right text-3xl font-bold text-jp-text bg-transparent outline-none">
            </div>
            <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
                    <p class="text-xs text-gray-400">ä»˜æ¬¾äºº</p>
                    <button onclick="editUsers()" class="text-[10px] text-blue-400 underline">ç·¨è¼¯åå–®</button>
                </div>
                <div class="flex flex-wrap gap-2" id="payer-container"></div>
            </div>
            <div class="mb-4">
                <p class="text-xs text-gray-400 mb-2">åˆ†æ”¤æ¨¡å¼</p>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="setSplit('shared')" id="split-shared" class="split-btn active py-2 rounded-lg text-xs border border-gray-200">å…±åŒåˆ†æ”¤ (æ‰£å…¬è²»/è¨˜å¸³)</button>
                    <button onclick="setSplit('deposit')" id="split-deposit" class="split-btn py-2 rounded-lg text-xs border border-gray-200 text-gray-400">å…¬è²»å…¥é‡‘ (å­˜éŒ¢)</button>
                    <button onclick="setSplit('own')" id="split-own" class="split-btn py-2 rounded-lg text-xs border border-gray-200 text-gray-400">å€‹äººè‡ªä»˜</button>
                    <button onclick="setSplit('advance')" id="split-advance" class="split-btn py-2 rounded-lg text-xs border border-gray-200 text-gray-400">å¹«äººä»£å¢Š</button>
                </div>
            </div>
            <div class="flex gap-2 mb-4">
                <button class="w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center text-gray-400"><i class="fas fa-camera"></i></button>
                <input type="text" id="note-input" placeholder="å‚™è¨» (å¦‚: 7-11)" class="flex-1 bg-gray-50 rounded-lg px-3 text-sm outline-none">
            </div>
            <button onclick="submitTx()" class="w-full bg-jp-text text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition">æ–°å¢ç´€éŒ„</button>
        </div>
        <div class="mt-6">
            <div class="flex justify-between items-center mb-2 px-1">
                 <h3 class="text-sm font-bold text-gray-500">è¿‘æœŸç´€éŒ„</h3>
                <button onclick="clearTx()" class="text-xs text-red-300">æ¸…ç©º</button>
            </div>
            <div id="tx-history" class="space-y-2 pb-10"></div>
        </div>
    </div>
    
    <div id="tab-checklist" class="section px-5 py-4 pb-24">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">è¡Œææ¸…å–®</h2>
            <div class="flex gap-2">
                <button onclick="addChecklistCategory()" class="w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center"><i class="fas fa-folder-plus text-xs"></i></button>
                <button onclick="addChecklistItem()" class="w-8 h-8 rounded-full bg-jp-accent text-white flex items-center justify-center shadow-md"><i class="fas fa-plus text-xs"></i></button>
            </div>
        </div>
         <div id="checklist-container"></div>
         
         <h3 class="font-bold text-lg mt-10 mb-4 text-jp-text flex items-center"><i class="fas fa-info-circle mr-2 text-jp-blue"></i>å¯¦ç”¨è³‡è¨Š (INFO)</h3>
         <div class="space-y-4">
             <div class="bg-white rounded-xl p-4 shadow-sm flex items-center justify-between border border-gray-100">
                 <div class="flex items-center gap-3">
                     <i class="fas fa-cloud-sun text-yellow-400 text-xl"></i>
                     <div>
                         <span class="block text-sm font-bold text-jp-text">æ›¼è°·å¤©æ°£é å ±</span>
                         <span class="text-xs text-gray-400">Google Weather</span>
                     </div>
                 </div>
                 <a href="https://www.google.com/search?q=æ›¼è°·å¤©æ°£" target="_blank" class="px-3 py-1 rounded-full bg-gray-100 text-xs text-gray-600">æŸ¥çœ‹</a>
             </div>
             <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                 <h4 class="text-xs text-gray-400 mb-3 font-bold tracking-wider">ç·Šæ€¥è¯çµ¡ EMERGENCY</h4>
                 <div class="space-y-3">
                    <div class="flex justify-between text-sm border-b border-gray-50 pb-2 items-center">
                        <span class="flex items-center gap-2"><i class="fas fa-user-shield text-gray-400 w-4"></i>è§€å…‰è­¦å¯Ÿ</span>
                        <a href="tel:1155" class="font-bold text-red-500 bg-red-50 px-2 py-1 rounded">1155</a>
                    </div>
                    <div class="flex justify-between text-sm border-b border-gray-50 pb-2 items-center">
                        <span class="flex items-center gap-2"><i class="fas fa-ambulance text-gray-400 w-4"></i>æ•‘è­·è»Š</span>
                        <a href="tel:1669" class="font-bold text-red-500 bg-red-50 px-2 py-1 rounded">1669</a>
                    </div>
                    <div class="flex justify-between text-sm items-center">
                        <span class="flex items-center gap-2"><i class="fas fa-flag text-gray-400 w-4"></i>é§æ³°ä»£è¡¨è™•</span>
                        <a href="tel:+66816664006" class="font-bold text-blue-500 bg-blue-50 px-2 py-1 rounded">+66-81-666-4006</a>
                    </div>
                </div>
             </div>
             <div class="bg-mag-paper rounded-xl p-4 shadow-sm border border-amber-100">
                 <h4 class="text-xs text-amber-600 mb-3 font-bold tracking-wider"><i class="fas fa-exclamation-triangle mr-1"></i>æ—…éŠç¦å¿Œ & æ³¨æ„</h4>
                 <ul class="text-xs text-jp-text space-y-2 list-disc pl-4 font-medium leading-relaxed">
                     <li><strong class="text-purple-600">è²·é…’æ™‚é–“é™åˆ¶</strong>ï¼šè¶…å•†/è¶…å¸‚åƒ… <span class="font-bold">11:00-14:00</span> èˆ‡ <span class="font-bold">17:00-24:00</span> å¯è²©å”®é…’ç²¾é£²å“ã€‚ä½›ç¯€å…¨æ—¥ç¦é…’ã€‚</li>
                     <li><strong class="text-red-500">é›»å­è¸å…¨æ³°åœ‹é•æ³•</strong>ï¼šæ”œå¸¶æˆ–ä½¿ç”¨çš†å¯èƒ½é¢è‡¨é«˜é¡ç½°æ¬¾æˆ–ç›£ç¦ï¼Œåˆ‡å‹¿å˜—è©¦ã€‚</li>
                     <li><strong class="text-green-600">å¤§éº»ç›¸é—œ</strong>ï¼šé›–å·²é™¤ç½ªåŒ–ï¼Œä½†åœ¨å…¬å…±å ´æ‰€å¸é£Ÿä»å±¬é•æ³•æ“¾æ°‘ï¼Œä¸”ä¸å¯æ”œå¸¶å‡ºå¢ƒå›å°ã€‚</li>
                     <li><strong class="text-jp-blue">å¯ºå»Ÿç©¿è‘—</strong>ï¼šåƒè§€é„­ç‹å»Ÿã€è‡¥ä½›å¯ºç­‰ï¼Œä¸å¯ç©¿ç„¡è¢–ã€çŸ­è¤²/çŸ­è£™ (éœ€éè†)ã€‚</li>
                     <li><strong class="text-gray-500">å°è²»æ–‡åŒ–</strong>ï¼šæŒ‰æ‘©/é£¯åº—å»ºè­°çµ¦ 20-50 æ³°éŠ–ç´™éˆ”ï¼Œé¿å…çµ¦ç¡¬å¹£ (è¦–ç‚ºæ–½æ¨)ã€‚</li>
                 </ul>
             </div>
         </div>
    </div>

    <div id="tab-settings" class="section px-5 py-4 pb-24">
        <h2 class="text-xl font-bold mb-6">è¨­å®š</h2>
        <div class="bg-white rounded-2xl shadow-soft p-5 mb-6 border border-jp-green/30 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-16 h-16 bg-jp-green/10 rounded-full -mr-6 -mt-6"></div>
            <h3 class="font-bold text-jp-text mb-2"><i class="fab fa-google-drive text-jp-green mr-2"></i>é›²ç«¯è³‡æ–™åº« (Google Sheets)</h3>
            <p class="text-xs text-gray-500 mb-4 leading-relaxed">åŒæ­¥è‡³ Google è©¦ç®—è¡¨ã€‚<br><span class="text-[10px] text-gray-400">éœ€é€£ç¶²ã€‚é»æ“Šä¸‹è¼‰æœƒè¦†è“‹æœ¬æ©Ÿè³‡æ–™ã€‚</span></p>
            <div class="flex gap-3">
                 <button onclick="syncToCloud('upload')" id="btn-upload" class="flex-1 bg-jp-text text-white py-3 rounded-lg text-sm shadow hover:opacity-90 active:scale-95 transition flex items-center justify-center gap-2"><i class="fas fa-cloud-upload-alt"></i> ä¸Šå‚³å‚™ä»½</button>
                <button onclick="syncToCloud('download')" id="btn-download" class="flex-1 bg-white border border-jp-text text-jp-text py-3 rounded-lg text-sm shadow hover:bg-gray-50 active:scale-95 transition flex items-center justify-center gap-2"><i class="fas fa-cloud-download-alt"></i> ä¸‹è¼‰è¦†è“‹</button>
            </div>
            <p id="sync-status" class="text-[10px] text-center mt-2 text-gray-400 h-4"></p>
        </div>
        <div class="bg-white rounded-2xl shadow-soft p-5 mb-6 border border-jp-blue/20">
            <h3 class="font-bold text-jp-blue mb-2"><i class="fas fa-qrcode mr-2"></i>å¿«é€Ÿè½‰ç§» (ç„¡ç¶²è·¯ç”¨)</h3>
            <div class="flex gap-3">
                 <button onclick="exportData()" class="flex-1 bg-jp-blue text-white py-3 rounded-lg text-sm shadow hover:opacity-90"><i class="fas fa-copy mr-1"></i> è¤‡è£½ä»£ç¢¼</button>
                <button onclick="openImportModal()" class="flex-1 bg-gray-600 text-white py-3 rounded-lg text-sm shadow hover:opacity-90"><i class="fas fa-paste mr-1"></i> è²¼ä¸ŠåŒ¯å…¥</button>
            </div>
        </div>
        <div class="mt-8 text-center">
             <button onclick="hardReset()" class="text-xs text-red-400 underline p-2">é‡ç½®æ‰€æœ‰ App è³‡æ–™ (æ…ç”¨)</button>
        </div>
    </div>

    <nav class="fixed bottom-6 left-5 right-5 h-16 bg-white/95 backdrop-blur rounded-2xl flex justify-around items-center shadow-gold z-50 border border-gray-100">
        <button onclick="switchTab('tab-home')" class="nav-btn active flex flex-col items-center gap-1 text-gray-400" data-target="tab-home">
            <i class="fas fa-home text-lg"></i><span class="text-[10px]">é¦–é </span>
        </button>
        <button onclick="switchTab('tab-itinerary')" class="nav-btn flex flex-col items-center gap-1 text-gray-400" data-target="tab-itinerary">
            <i class="fas fa-map-marked-alt text-lg"></i><span class="text-[10px]">è¡Œç¨‹</span>
        </button>
        <div class="relative -top-6">
            <button onclick="switchTab('tab-account')" class="w-14 h-14 bg-jp-text rounded-full shadow-lg flex items-center justify-center text-white text-xl transform hover:scale-105 transition active:scale-95 border-4 border-[#F9F8F4]">
                <i class="fas fa-plus"></i>
            </button>
        </div>
        <button onclick="switchTab('tab-checklist')" class="nav-btn flex flex-col items-center gap-1 text-gray-400" data-target="tab-checklist">
            <i class="fas fa-info-circle text-lg"></i><span class="text-[10px]">è³‡è¨Š</span>
        </button>
        <button onclick="switchTab('tab-settings')" class="nav-btn flex flex-col items-center gap-1 text-gray-400" data-target="tab-settings">
            <i class="fas fa-cog text-lg"></i><span class="text-[10px]">è¨­å®š</span>
        </button>
    </nav>

    <div id="import-modal" class="modal-overlay"><div class="bg-white w-4/5 rounded-2xl p-5 shadow-2xl"><h3 class="font-bold text-lg mb-2">è²¼ä¸Šä»£ç¢¼</h3><textarea id="import-area" class="w-full h-32 bg-gray-50 border border-gray-200 rounded-lg p-2 text-xs mb-4"></textarea><div class="flex gap-2"><button onclick="closeModal('import-modal')" class="flex-1 py-2 rounded-lg border border-gray-200 text-sm">å–æ¶ˆ</button><button onclick="confirmImport()" class="flex-1 py-2 rounded-lg bg-jp-text text-white text-sm">ç¢ºå®š</button></div></div></div>
    <div id="advance-modal" class="modal-overlay"><div class="bg-white w-4/5 rounded-2xl p-5 shadow-2xl"><h3 class="font-bold text-lg mb-2">å¹«èª°ä»£å¢Š?</h3><div id="advance-list" class="space-y-2 mb-4"></div><div class="flex gap-2"><button onclick="closeModal('advance-modal')" class="flex-1 py-2 rounded-lg border border-gray-200 text-sm">å–æ¶ˆ</button><button onclick="confirmAdvance()" class="flex-1 py-2 rounded-lg bg-jp-text text-white text-sm">ç¢ºå®š</button></div></div></div>
    
    <div id="sort-modal" class="modal-overlay">
        <div class="bg-white w-[90%] rounded-2xl p-5 shadow-2xl max-h-[80vh] flex flex-col">
            <h3 class="font-bold text-lg mb-4 text-jp-text">èª¿æ•´é †åº</h3>
            <p class="text-xs text-gray-400 mb-2">é•·æŒ‰ä¸¦æ‹–æ›³å³å¯æ’åº</p>
            <div id="sort-list-container" class="overflow-y-auto flex-1 mb-4"></div>
            <div class="flex gap-2">
                <button onclick="closeModal('sort-modal')" class="flex-1 py-2 rounded-lg border border-gray-200 text-sm">å–æ¶ˆ</button>
                <button onclick="confirmSort()" class="flex-1 py-2 rounded-lg bg-jp-text text-white text-sm">å„²å­˜é †åº</button>
            </div>
        </div>
    </div>

    <div id="itinerary-modal" class="modal-overlay">
        <div class="bg-white w-[90%] rounded-2xl p-5 shadow-2xl max-h-[90vh] overflow-y-auto">
            <h3 class="font-bold text-lg mb-4 text-jp-text" id="spot-modal-title">ç·¨è¼¯æ™¯é»</h3>
            <input type="hidden" id="spot-index">
            <div class="space-y-3">
                <div><label class="text-xs text-gray-400 block mb-1">æ™‚é–“</label><input type="text" id="spot-time" class="w-full bg-gray-50 border border-gray-200 rounded p-2 text-sm"></div>
                <div><label class="text-xs text-gray-400 block mb-1">åç¨±</label><input type="text" id="spot-name" class="w-full bg-gray-50 border border-gray-200 rounded p-2 text-sm font-bold"></div>
                <div><label class="text-xs text-gray-400 block mb-1">æ³°æ–‡åç¨± (çµ¦å¸æ©Ÿ)</label><input type="text" id="spot-thai" class="w-full bg-gray-50 border border-gray-200 rounded p-2 text-sm text-jp-blue font-serif"></div>
                <div><label class="text-xs text-gray-400 block mb-1">ç°¡çŸ­æè¿°</label><input type="text" id="spot-desc" class="w-full bg-gray-50 border border-gray-200 rounded p-2 text-sm"></div>
                <div><label class="text-xs text-jp-accent block mb-1">ğŸ“– æ™¯é»æ•…äº‹ (æ·±åº¦ä»‹ç´¹)</label><textarea id="spot-deep-desc" class="w-full bg-mag-paper border border-amber-100 rounded p-2 text-xs h-24 placeholder-gray-300 leading-relaxed" placeholder="è¼¸å…¥æ­·å²èƒŒæ™¯ã€å†·çŸ¥è­˜..."></textarea></div>
                <div class="grid grid-cols-2 gap-2">
                    <div><label class="text-xs text-gray-400 block mb-1">Google Map ç¶²å€</label><input type="text" id="spot-link" class="w-full bg-gray-50 border border-gray-200 rounded p-2 text-xs" placeholder="https://..."></div>
                    <div><label class="text-xs text-gray-400 block mb-1">æ”»ç•¥é—œéµå­—</label><input type="text" id="spot-keyword" class="w-full bg-gray-50 border border-gray-200 rounded p-2 text-xs" placeholder="æœå°‹ç”¨"></div>
                </div>
                 <div><label class="text-xs text-gray-400 block mb-1">Icon (FontAwesome)</label><input type="text" id="spot-icon" class="w-full bg-gray-50 border border-gray-200 rounded p-2 text-xs" value="fa-map-marker-alt"></div>
            </div>
            <div class="flex gap-2 mt-6">
                <button onclick="deleteSpot()" id="btn-delete-spot" class="px-4 py-2 rounded-lg bg-red-50 text-red-400 text-sm"><i class="fas fa-trash"></i></button>
                <button onclick="closeModal('itinerary-modal')" class="flex-1 py-2 rounded-lg border border-gray-200 text-sm">å–æ¶ˆ</button>
                <button onclick="saveSpot()" class="flex-1 py-2 rounded-lg bg-jp-text text-white text-sm">å„²å­˜</button>
            </div>
        </div>
    </div>

    <div id="detail-sheet" class="bottom-sheet-overlay">
        <div class="bottom-sheet-content" onclick="event.stopPropagation()">
            <div class="w-full flex justify-center pt-3 pb-1" onclick="closeDetailSheet()">
                <div class="w-12 h-1.5 bg-gray-200 rounded-full"></div>
            </div>
            
            <div id="sheet-inner" class="px-6 py-4">
                </div>
        </div>
        <div class="absolute inset-0 z-[-1]" onclick="closeDetailSheet()"></div>
    </div>

    <div id="speak-modal" class="speak-modal" onclick="this.classList.remove('active')">
        <p class="text-gray-400 text-sm mb-6">çµ¦å¸æ©Ÿ / åº—å“¡çœ‹</p>
        <h1 id="speak-text" class="text-white text-5xl font-bold leading-snug break-words">...</h1>
        <p class="text-gray-600 text-xs mt-10">é»æ“Šä»»æ„è™•é—œé–‰</p>
    </div>

</div>

<script>
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxYeyHua8VRjHu3dHbP3glwWcFf5zClFG_drBD9gR_j9MZpcGf6uajQUzmOw_Au_o0o/exec';

    // --- V27: FINAL UPDATED ITINERARY (Forced Update) ---
    const DEFAULT_ITINERARY = [
        { "day": 1, "date": "12/23 (äºŒ)", "desc": "æŠµé”æ›¼è°·", "spots": [ 
            { "time": "18:00", "name": "é«˜é›„å‡ºç™¼", "thai_name": "à¸ªà¸™à¸²à¸¡à¸šà¸´à¸™", "desc": "FD235 âœˆï¸ (21:30 æŠµé”å»Šæ›¼)", "icon": "fa-plane", "color": "text-blue-500", "deep_desc": "å»Šæ›¼æ©Ÿå ´ (DMK) æ˜¯æ›¼è°·çš„èˆŠæ©Ÿå ´ï¼Œè¦æ¨¡è¼ƒå°ä½†é€šé—œé€šå¸¸æ¯”ç´ è¬é‚£æ™® (BKK) å¿«ã€‚å‡ºé—œå¾Œè«‹ç•™æ„ã€ŒTaxiã€æŒ‡æ¨™ï¼Œæˆ–ä½¿ç”¨ Grab App å«è»Š (å»ºè­°é¸æ“‡ 1 æ¨“å¤–çš„æ¥é€é»)ã€‚" }, 
            { "time": "22:30", "name": "æ©Ÿå ´åŒ…è»Šæ¥æ©Ÿ", "desc": "å‰å¾€ B2 é£¯åº—", "icon": "fa-car", "color": "text-green-600", "highlight": true, "deep_desc": "æ³°åœ‹é«˜é€Ÿå…¬è·¯ (Tollway) é€šå¸¸éœ€è¦ä¹˜å®¢é¡å¤–æ”¯ä»˜éè·¯è²» (ç´„ 50-70 æ³°éŠ–)ï¼Œå¸æ©Ÿéæ”¶è²»ç«™æ™‚æœƒè·Ÿä½ è¦éŒ¢ï¼Œé€™æ˜¯æ­£å¸¸çš„å–”ï¼æº–å‚™å¥½å°éˆ”ã€‚" }, 
            { "time": "Late", "name": "å”äººè¡—å®µå¤œ", "thai_name": "à¹€à¸¢à¸²à¸§à¸£à¸²à¸Š", "desc": "Check-in å¾Œè¦“é£Ÿ", "icon": "fa-utensils", "color": "text-orange-500", "keyword": "æ›¼è°·å”äººè¡—ç¾é£Ÿ", "deep_desc": "æ›¼è°·å”äººè¡— (è€€è¯åŠ›è·¯) æ˜¯å…¨çƒæœ€å¤è€çš„å”äººè¡—ä¹‹ä¸€ã€‚é€™è£¡æ™šä¸Šçš„éœ“è™¹ç‡ˆæ‹›ç‰Œæœ‰ç¨® 80 å¹´ä»£é¦™æ¸¯é›»å½±çš„æ°›åœã€‚å¿…åƒæ¨è–¦ï¼šT&K æµ·é®®ï¼ˆç¶ è‰²åˆ¶æœï¼‰ã€ç²¿æ±ï¼ˆKway Chapï¼‰ã€‚" }, 
            { "time": "Sleep", "name": "B2 å”äººè¡—é£¯åº—", "thai_name": "à¹‚à¸£à¸‡à¹à¸£à¸¡à¸šà¸µà¸—à¸¹", "desc": "å…¥ä½ä¼‘æ¯", "link": "https://maps.app.goo.gl/ZjNM4vwDCNQdAq637?g_st=ipc", "keyword": "", "icon": "fa-bed", "color": "text-gray-500", "deep_desc": "B2 æ˜¯æ³°åœ‹çŸ¥åçš„å¹³åƒ¹é€£é–é£¯åº—ï¼Œä¸»æ‰“å·¥æ¥­é¢¨è¨­è¨ˆã€‚å”äººè¡—åˆ†åº—ä½ç½®æ¥µä½³ï¼Œèµ°è·¯å°±èƒ½åˆ° MRT Wat Mangkon ç«™ï¼Œä¸”å‘¨é‚Šå……æ»¿è€æ›¼è°·çš„ç”Ÿæ´»æ°£æ¯ã€‚" } 
        ] },
        { "day": 2, "date": "12/24 (ä¸‰)", "desc": "å¹³å®‰å¤œç‰¹ä¼", "spots": [ 
            { "time": "09:00", "name": "è‡¥ä½›å¯º", "thai_name": "à¸§à¸±à¸”à¹‚à¸à¸˜à¸´à¹Œ", "desc": "å¿…æ‹å¤è¹Ÿ", "link": "https://www.google.com/maps/place/Bangkok5", "keyword": "è‡¥ä½›å¯º", "icon": "fa-gopuram", "color": "text-gray-500", "deep_desc": "æ“æœ‰å…¨æ³°åœ‹æœ€å¤§çš„è‡¥ä½›åƒ (é•·46å…¬å°º)ã€‚é€™è£¡ä¹Ÿæ˜¯æ³°å¼æŒ‰æ‘©çš„ç™¼æºåœ°ï¼Œé€›ç´¯äº†å¯ä»¥ç›´æ¥åœ¨å¯ºå…§çš„æŒ‰æ‘©å­¸æ ¡é«”é©—æœ€æ­£å®—çš„å¤æ³•æŒ‰æ‘©ã€‚" }, 
            { "time": "11:00", "name": "é„­ç‹å»Ÿ", "thai_name": "à¸§à¸±à¸”à¸­à¸£à¸¸à¸“", "desc": "æ‹ç…§åƒè§€", "link": "https://maps.app.goo.gl/4t2JkPEY1yKKBtoq5?g_st=ipc", "keyword": "é„­ç‹å»Ÿ", "icon": "fa-store", "color": "text-gray-500", "deep_desc": "åˆç¨±é»æ˜å¯º (Wat Arun)ã€‚ä¸åŒæ–¼æ³°åœ‹å¸¸è¦‹çš„é‡‘ç¢§è¼ç…Œï¼Œé€™è£¡ä»¥ç™½è‰²ç‚ºåº•ï¼Œé‘²åµŒè‘—ç„¡æ•¸ä¸­åœ‹é‹ä¾†çš„å½©è‰²ç¢ç“·ç‰‡ã€‚æ—¥è½æ™‚åˆ†çš„å‰ªå½±è¢«è­½ç‚ºæ›¼è°·æœ€ç¾æ™¯è‰²ä¹‹ä¸€ã€‚" }, 
            { "time": "13:00", "name": "ç‹æœ—å¸‚å ´", "thai_name": "à¸•à¸¥à¸²à¸”à¸§à¸±à¸‡à¸«à¸¥à¸±à¸‡", "desc": "åœ¨åœ°å°åƒ", "link": "https://maps.app.goo.gl/Q43nUqg7KE9dRj8Z9?g_st=ipc", "keyword": "ç‹æœ—å¸‚å ´", "icon": "fa-map-marker-alt", "color": "text-gray-500", "deep_desc": "Wang Lang Market æ˜¯ç•¶åœ°å¤§å­¸ç”Ÿå’Œè­·å£«æœ€æ„›çš„å¸‚å ´ï¼Œè§€å…‰å®¢è¼ƒå°‘ï¼Œåƒ¹æ ¼éå¸¸è¦ªæ°‘ï¼å¿…è²·ï¼šç‚¸éºµåŒ… (Wang Lang Bakery)ã€æ³°å¼ç”œé»ã€çƒ¤è‚‰ä¸²ã€‚" },
            { "time": "16:00", "name": "Iconsiam", "thai_name": "à¹„à¸­à¸„à¸­à¸™à¸ªà¸¢à¸²à¸¡", "desc": "ç”œé» & æ‹ç…§", "icon": "fa-camera", "color": "text-blue-500", "link": "https://www.google.com/maps/place/Bangkok6", "deep_desc": "æ›¼è°·åœ°æ¨™ç´šç™¾è²¨ã€‚æ¨è–¦åˆ° G æ¨“ SookSiam æ‹å®¤å…§æ°´ä¸Šå¸‚å ´ï¼Œæˆ–è€…å»é ‚æ¨“è§€æ™¯å°çœ‹æ²³æ™¯ã€‚å¿…åƒç”œé»ï¼šAfter You èœœç³–åå¸ã€Karun æ³°å¼å¥¶èŒ¶ã€‚" },
            { "time": "19:00", "name": "è€ƒå±±è·¯æ™šé¤", "thai_name": "à¸–à¸™à¸™à¸‚à¹‰à¸²à¸§à¸ªà¸²à¸£", "desc": "å¹³å®‰å¤œç‹‚æ­¡", "icon": "fa-beer", "color": "text-red-500", "link": "https://www.google.com/maps/place/Bangkok7", "deep_desc": "Khao San Road æ˜¯èƒŒåŒ…å®¢çš„å¤©å ‚ã€‚å¹³å®‰å¤œé€™è£¡æœƒéå¸¸ç†±é¬§ï¼Œå……æ»¿æ­ç¾éŠå®¢ã€‚éš¨ä¾¿æ‰¾ä¸€å®¶éœ²å¤©é…’å§ (å¦‚ The One) åƒé£¯å–é…’ï¼Œæ„Ÿå—æ›¼è°·çš„ç¯€æ—¥æ°£æ°›ã€‚è¨˜å¾—è©¦è©¦è·¯é‚Šçš„ Pad Thaiï¼" },
            { "time": "21:30", "name": "å›é£¯åº—", "desc": "ä¼‘æ¯", "icon": "fa-home", "color": "text-gray-400" }
        ] },
        { "day": 3, "date": "12/25 (å››)", "desc": "è–èª•æ–‡é’ & éŠèˆ¹", "spots": [ 
            { "time": "09:30", "name": "æ–‡é’æ•£ç­–", "thai_name": "à¹€à¸ˆà¸£à¸´à¸à¸à¸£à¸¸à¸‡ & à¸•à¸¥à¸²à¸”à¸™à¹‰à¸­à¸¢", "desc": "åµ©è¶Šè·¯/çŸ³é¾è»/Talat Noi", "link": "https://www.google.com/maps/place/Bangkok8", "icon": "fa-palette", "color": "text-gray-500", "deep_desc": "é€™æ˜¯ä¸€æ¢çµ•ä½³çš„æ•£æ­¥è·¯ç·šï¼šå¾åµ©è¶Šè·¯ (Song Wat) çš„è€å»ºç¯‰å’–å•¡å»³é–‹å§‹ï¼Œèµ°åˆ°çŸ³é¾è»è·¯ (Charoen Krung) åƒç™¾å¹´è€åº—ï¼Œæœ€å¾Œé‘½é€² Talat Noi çš„å··å¼„æ‹è¡—é ­å¡—é´‰èˆ‡å»¢æ£„å¤è‘£è»Šã€‚" }, 
            { "time": "12:30", "name": "åˆé¤è‡ªç†", "desc": "æ²¿é€”æ¢åº—", "icon": "fa-utensils", "color": "text-gray-500", "deep_desc": "é€™ä¸€å¸¶æœ‰å¾ˆå¤šéš±è—ç‰ˆç¾é£Ÿï¼Œå¦‚ï¼šPed Tun Chao Tha (ç‡‰é´¨)ã€Jok Prince (ç‹å­æˆ²é™¢è±¬è‚‰ç²¥)ã€‚çœ‹åˆ°æƒ³åƒçš„å°±èµ°é€²å»å§ï¼" }, 
            { "time": "16:00", "name": "å‰å¾€ç¢¼é ­", "thai_name": "à¹€à¸­à¹€à¸Šà¸µà¸¢à¸—à¸µà¸„ (Asiatique)", "desc": "Asiatique 7è™Ÿå€‰åº«", "link": "https://www.google.com/maps/place/Bangkok9", "icon": "fa-ship", "color": "text-blue-600", "highlight": true, "deep_desc": "è«‹å‹™å¿…æº–æ™‚ï¼æ˜­æŠ«è€¶å…¬ä¸»è™Ÿæ—¥è½éŠèˆ¹ (Sunset Cruise) ç™»èˆ¹é»åœ¨ Asiatique ç¢¼é ­ (7è™Ÿå€‰åº«)ã€‚16:45 é–‹å§‹ç™»èˆ¹ï¼Œ17:00 æº–æ™‚å‡ºç™¼ã€‚å»ºè­°ææ—©åˆ° Asiatique é€›é€›ã€‚" }, 
            { "time": "17:00", "name": "æ—¥è½éŠèˆ¹", "thai_name": "à¹€à¸ˆà¹‰à¸²à¸à¸£à¸°à¸¢à¸²à¸›à¸£à¸´à¹Šà¸™à¹€à¸‹à¸ª", "desc": "Buffet æ™šé¤ (17:00-18:30)", "icon": "fa-wine-glass", "color": "text-orange-500", "deep_desc": "åœ¨èˆ¹ä¸Šæ¬£è³æ›¼è°·å¤•é™½èˆ‡å¤œæ™¯è½‰æ›çš„é­”å¹»æ™‚åˆ»ã€‚é€”ç¶“é„­ç‹å»Ÿã€å¤§çš‡å®®ç­‰åœ¨æ²³å²¸é‚Šçš„åœ°æ¨™ã€‚é£Ÿç‰©æ˜¯è‡ªåŠ©é¤å½¢å¼ï¼Œäº¦æœ‰ç¾å ´ Live Band æ¼”å¥ã€‚" },
            { "time": "19:00", "name": "æ¬å®¶æ›é£¯åº—", "desc": "å‰å¾€é€šç¾… (Jasmine 59)", "icon": "fa-suitcase", "color": "text-purple-500", "link": "https://maps.app.goo.gl/DmVbJdwrbkwQ7p8K6?g_st=ipc", "deep_desc": "éŠèˆ¹çµæŸå¾Œï¼Œå› B2 æ‹¿è¡Œæï¼Œç§»å‹•åˆ°é€šç¾…å€ (Thong Lor)ã€‚é€™å€æ™šä¸Šå¾ˆç†±é¬§ï¼ŒCheck-in å¾Œè‹¥æœ‰é«”åŠ›å¯ä»¥å»é™„è¿‘çš„é…’å§å°é…Œã€‚" }
        ] },
        { "day": 4, "date": "12/26 (äº”)", "desc": "æ°´ä¸Šå¸‚å ´ä¸€æ—¥éŠ", "spots": [ 
            { "time": "08:00", "name": "åŒ…è»Šå‡ºç™¼", "desc": "é£¯åº—å¤§å»³é›†åˆ (æº–æ™‚!)", "icon": "fa-car", "color": "text-red-500", "highlight": true, "deep_desc": "ä»Šå¤©çš„è¡Œç¨‹è·é›¢æ›¼è°·å¸‚å€è¼ƒé  (ç´„ 1.5 - 2 å°æ™‚è»Šç¨‹)ï¼Œè«‹å¤§å®¶å‹™å¿…æº–æ™‚ï¼Œä»¥å…å¡è»Šå»¶èª¤ç«è»Šé€²ç«™çš„æ™‚é–“ã€‚" }, 
            { "time": "10:00", "name": "ç¾åŠŸéµé“å¸‚å ´", "thai_name": "à¸•à¸¥à¸²à¸”à¸£à¹ˆà¸¡à¸«à¸¸à¸š", "desc": "çœ‹ç«è»Šé€²ç«™", "link": "https://maps.app.goo.gl/4f6eR12QvvsLoArb7?g_st=ipc", "keyword": "ç¾åŠŸéµé“å¸‚å ´", "icon": "fa-train", "color": "text-gray-500", "deep_desc": "é€™è£¡è¢«ç¨±ç‚ºã€Œä¸–ç•Œä¸Šæœ€å±éšªçš„å¸‚å ´ã€ã€‚æ¯å¤©æœ‰ 8 ç­ç«è»Šç¶“éï¼Œæ”¤è²©æœƒåœ¨ç«è»Šé³´ç¬›ç¬é–“ï¼Œç†Ÿç·´åœ°æ”¶èµ·é®é™½æ£šèˆ‡ç±ƒå­ï¼Œç«è»Šä¸€éåˆç¬é–“æ¢å¾©åŸç‹€ï¼Œæ˜¯æ³°åœ‹ç¨æœ‰çš„å¥‡æ™¯ã€‚" }, 
            { "time": "12:00", "name": "ä¸¹å«©èæ°´ä¸Šå¸‚å ´", "thai_name": "à¸”à¸³à¹€à¸™à¸´à¸™à¸ªà¸°à¸”à¸§à¸", "desc": "æ‰‹æ–èˆ¹é«”é©—", "link": "https://maps.app.goo.gl/n4JDTNY2q7Bqkrxw8?g_st=ipc", "keyword": "ä¸¹å«©èæœµ", "icon": "fa-water", "color": "text-gray-500", "deep_desc": "è¿™æ˜¯ 007 é›»å½±ã€Šé‡‘æ§äººã€‹çš„æ‹æ”å ´æ™¯ã€‚é›–ç„¶å•†æ¥­åŒ–ç¨‹åº¦é«˜ï¼Œä½†å»æ˜¯é«”é©—ã€Œæ‰‹æ–èˆ¹ã€å¡èˆ¹çš„æœ€ä½³åœ°é»ã€‚è¨˜å¾—ï¼šèˆ¹ä¸Šçš„æ±è¥¿é€šå¸¸æ¯”å²¸ä¸Šè²´ï¼Œæ®ºåƒ¹è¦å¾ 3 æŠ˜é–‹å§‹æ®ºï¼" }, 
            { "time": "14:00", "name": "æ¨¹ä¸­å»Ÿ", "thai_name": "à¸§à¸±à¸”à¸šà¸²à¸‡à¸à¸¸à¹‰à¸‡", "desc": "éˆé©—å¤å»Ÿ", "link": "https://maps.app.goo.gl/z8xrK7NTUiyW4P6n8?g_st=ipc", "keyword": "æ¨¹ä¸­å»Ÿ", "icon": "fa-vihara", "color": "text-gray-500", "deep_desc": "é€™æ˜¯ä¸€åº§è¢«è©ææ¨¹æ ¹å®Œå…¨åŒ…è¦†çš„ä½›æ®¿ï¼Œå·²æœ‰ 400 å¤šå¹´æ­·å²ã€‚ç›¸å‚³é„­ç‹åœ¨æ”»æ‰“ç·¬ç”¸è»ä¹‹å‰æ›¾ä¾†æ­¤ç¥ˆæ±‚å‹åˆ©ï¼Œçµæœå¤§å‹ï¼Œå› æ­¤è¢«è¦–ç‚ºæ¥µå…¶éˆé©—çš„æ±‚å‹ä¹‹å»Ÿã€‚" }, 
            { "time": "16:00", "name": "è¿”å›æ›¼è°·", "desc": "Siam / Big C æˆ– é£¯åº—", "icon": "fa-home", "color": "text-gray-500", "deep_desc": "å›ç¨‹é€šå¸¸æœƒé‡åˆ°æ›¼è°·è‘—åçš„ä¸‹ç­å°–å³°è»Šæ½®ï¼Œé€™æ®µæ™‚é–“å¯ä»¥åœ¨è»Šä¸Šè£œçœ ï¼Œæˆ–è¨è«–æ™šé¤åƒä»€éº¼ã€‚" } 
        ] },
        { "day": 5, "date": "12/27 (å…­)", "desc": "è¿”å° / è‡ªç”±", "spots": [ 
            { "time": "10:00", "name": "æ°åœ–æ°å¸‚é›†", "thai_name": "à¸•à¸¥à¸²à¸”à¸™à¸±à¸”à¸ˆà¸•à¸¸à¸ˆà¸±à¸à¸£", "desc": "æœ€å¾Œæ¡è²·", "link": "https://maps.app.goo.gl/T9QymcxerpaBbFGc7?g_st=ipc", "keyword": "æ°åœ–æ°å¸‚é›†", "icon": "fa-smile", "color": "text-gray-500", "deep_desc": "Chatuchak æ˜¯ä¸–ç•Œæœ€å¤§çš„é€±æœ«å¸‚é›†ï¼Œæ“æœ‰ä¸€è¬äº”åƒå€‹æ”¤ä½ã€‚åˆ†å€è¤‡é›œï¼Œå»ºè­°çœ‹åˆ°å–œæ­¡çš„å°±è²·ï¼Œå› ç‚ºå›é ­å¾ˆé›£å†æ‰¾åˆ°åŒä¸€å®¶åº—ï¼é€™è£¡ä¹Ÿæ˜¯è²·é¦™æ°›ã€æ‰‹å·¥è—å“å’Œç´€å¿µå“çš„æœ€ä½³åœ°é»ã€‚" }, 
            { "time": "12:00", "name": "åˆé¤è‡ªç†", "desc": "å¸‚é›†å…§æˆ–å‘¨é‚Š", "icon": "fa-utensils", "color": "text-gray-500", "deep_desc": "æ°åœ–æ°å…§æœ‰éå¸¸å¤šå°åƒæ”¤ï¼Œå¦‚æ¤°å­å†°æ·‡æ·‹ã€è¥¿ç­ç‰™ç‡‰é£¯ (Viva 8)ã€‚" },
            { "time": "15:00", "name": "Big C æ¡è³¼", "thai_name": "à¸šà¸´à¹Šà¸à¸‹à¸µ", "desc": "ä¼´æ‰‹ç¦®æƒè²¨", "icon": "fa-shopping-cart", "color": "text-green-500", "deep_desc": "æ¨è–¦è²·ï¼šæ‰‹æ¨™æ³°å¼èŒ¶åŒ…ã€å¤§å“¥è±†ã€Pocky èŠ’æœå£å‘³ã€Bento é­·é­šç‰‡ã€‚" },
            { "time": "19:00", "name": "æ™šé¤: Krua Khun Puk", "thai_name": "à¸„à¸£à¸±à¸§à¸„à¸¸à¸“à¸›à¸¸à¹Šà¸", "desc": "æ³°å¼ç†±ç‚’", "link": "https://www.google.com/maps/place/Bangkok4", "icon": "fa-fire", "color": "text-orange-500", "deep_desc": "ä½æ–¼ Nana ç«™é™„è¿‘çš„å¹³åƒ¹äººæ°£ç†±ç‚’åº—ã€‚ç‡Ÿæ¥­åˆ°å¾ˆæ™šï¼Œå¿…é»ï¼šç‚’å«ç¾è‰ã€å†¬è”­åŠŸã€çƒ¤è±¬é ¸è‚‰ã€‚" },
            { "time": "Flight", "name": "å‰å¾€æ©Ÿå ´", "thai_name": "à¸ªà¸™à¸²à¸¡à¸šà¸´à¸™", "desc": "é å‚™è¿”å°", "icon": "fa-plane-departure", "color": "text-blue-500", "deep_desc": "è‹¥æœ‰åœ¨ç™¾è²¨å…¬å¸ç”³è«‹é€€ç¨… (VAT Refund)ï¼Œè¨˜å¾—å…ˆåœ¨æ©Ÿå ´å¤§å»³çš„é€€ç¨…è¾¦å…¬å®¤è“‹ç« ï¼Œéäº†æµ·é—œå¾Œå†å»é ˜éŒ¢å–”ï¼" } 
        ] }
    ];

    let state = {
        users: ["å† ä»”","å°èŠ³","ç å®‡","å©•èŒ¹","èŠä¼¶","å…¬è²»åŒ…"],
        fundBalance: 0,
        currency: 'THB',
        transactions: [],
        checklist: [{"title":"è­‰ä»¶","items":[{"name":"è­·ç…§","checked":true},{"name":"eSIM","checked":false},{"name":"ä¿éšªå–®","checked":false}]}],
        itinerary: DEFAULT_ITINERARY, 
        currentDay: 0
    };
    let sortable = null;

    document.addEventListener('DOMContentLoaded', () => {
        try {
            loadData();
            updateDate();
            fetchWeather(); // Simulated for now
            fetchExchangeRate();
            renderDayTabs();
            renderItinerary();
            renderAccCats();
            renderPayers();
            updateFundDisplay();
            renderHistory();
            renderChecklist();
            autoSync();
        } catch (e) { console.error(e); }
    });

    // --- LOGIC ---
    function updateDate() { document.getElementById('current-date-display').innerText = new Date().toLocaleDateString('en-US', {month:'short', day:'numeric'}); }
    
    // MOCK WEATHER (Horizontal)
    function fetchWeather() {
        const strip = document.getElementById('weather-strip');
        // Static mock data mimicking iPhone forecast
        const hours = [
            {t:'Now', i:'fa-sun', temp:'30Â°'},
            {t:'14:00', i:'fa-sun', temp:'31Â°'},
            {t:'15:00', i:'fa-cloud-sun', temp:'31Â°'},
            {t:'16:00', i:'fa-cloud', temp:'30Â°'},
            {t:'17:00', i:'fa-cloud-rain', temp:'29Â°'},
            {t:'18:00', i:'fa-cloud-showers-heavy', temp:'28Â°'},
            {t:'19:00', i:'fa-moon', temp:'27Â°'},
            {t:'20:00', i:'fa-moon', temp:'27Â°'},
        ];
        strip.innerHTML = hours.map(h => `
            <div class="flex-shrink-0 text-center min-w-[60px] flex flex-col items-center justify-center">
                <span class="text-[10px] text-gray-400 font-bold">${h.t}</span>
                <i class="fas ${h.i} text-xl my-2 ${h.i.includes('sun')?'text-yellow-400':h.i.includes('rain')?'text-blue-400':'text-gray-300'}"></i>
                <span class="text-sm font-bold text-jp-text">${h.temp}</span>
            </div>
        `).join('');
        document.getElementById('header-status').innerText = "30Â°C æ™´";
    }

    async function fetchExchangeRate() {
        try {
            const res = await fetch('https://api.exchangerate-api.com/v4/latest/THB');
            const data = await res.json();
            const rate = data.rates.TWD; 
            document.getElementById('home-rate-display').innerText = rate.toFixed(2);
        } catch { document.getElementById('home-rate-display').innerText = "0.99"; }
    }

    function translateThai() {
        const txt = document.getElementById('thai-input').value;
        if(txt) window.open(`https://translate.google.com/?sl=zh-TW&tl=th&text=${encodeURIComponent(txt)}&op=translate`, '_blank');
    }

    // Itinerary Rendering (Card Style)
    function renderDayTabs() {
        document.getElementById('day-tabs').innerHTML = state.itinerary.map((d, i) => `
            <button onclick="setDay(${i})" class="flex-shrink-0 px-5 py-2 rounded-2xl border transition duration-200 ${state.currentDay===i ? 'bg-jp-text text-white border-jp-text shadow-md transform scale-105' : 'bg-white text-gray-400 border-gray-100'}">
                <span class="block text-xs font-bold">Day ${d.day}</span>
                <span class="text-[10px] whitespace-nowrap opacity-80">${d.date.split(' ')[0]}</span>
            </button>
        `).join('');
    }
    function setDay(i) { state.currentDay = i; renderDayTabs(); renderItinerary(); }
    
    function renderItinerary() {
        const d = state.itinerary[state.currentDay];
        const c = document.getElementById('itinerary-content');
        
        if(!d.spots || d.spots.length === 0) { c.innerHTML = `<div class="text-center py-10 text-gray-400 text-sm">é»æ“Š + æ–°å¢è¡Œç¨‹</div>`; return; }
        
        c.innerHTML = d.spots.map((s, idx) => `
            <div class="timeline-item group" data-id="${idx}">
                <div class="timeline-dot" style="${s.highlight ? 'background:#ef4444; border-color:#fee2e2;' : ''}"></div>
                <span class="timeline-time ${s.highlight ? 'text-red-500' : ''}">${s.time}</span>
                <div onclick="openDetailSheet(${idx})" class="spot-card bg-white rounded-2xl p-4 shadow-card border border-white relative overflow-hidden">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-2xl bg-gray-50 flex items-center justify-center flex-shrink-0 text-xl text-gray-400 shadow-inner">
                            <i class="fas ${s.icon} ${s.color||''}"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-base font-bold text-jp-text truncate">${s.name}</h3>
                            <p class="text-xs text-gray-400 truncate">${s.desc}</p>
                        </div>
                        <i class="fas fa-chevron-right text-gray-200 text-xs"></i>
                    </div>
                    
                    <div class="mt-3 pt-2 border-t border-gray-50 flex gap-2">
                        ${s.link ? `
                        <button onclick="event.stopPropagation(); window.open('${s.link}', '_blank')" class="card-action-btn bg-red-50 text-red-500">
                            <i class="fas fa-map-marker-alt"></i> åœ°åœ–
                        </button>` : ''}
                        
                        <button onclick="event.stopPropagation(); window.open('https://www.google.com/search?q=${encodeURIComponent('æ›¼è°· ' + (s.keyword || s.name) + ' æ”»ç•¥')}', '_blank')" class="card-action-btn bg-blue-50 text-blue-500">
                            <i class="fab fa-google"></i> æ”»ç•¥
                        </button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // --- BOTTOM SHEET LOGIC ---
    function openDetailSheet(index) {
        const spot = state.itinerary[state.currentDay].spots[index];
        const sheet = document.getElementById('detail-sheet');
        const content = document.getElementById('sheet-inner');
        
        content.innerHTML = `
            <div class="flex items-start justify-between mb-6">
                <div>
                    <span class="px-3 py-1 bg-gray-100 rounded-lg text-[10px] text-gray-500 font-bold mb-2 inline-block">${spot.time}</span>
                    <h2 class="text-2xl font-bold text-jp-text leading-tight">${spot.name}</h2>
                    <p class="text-sm text-jp-blue font-serif mt-1">${spot.thai_name || ''}</p>
                </div>
                <div class="w-14 h-14 rounded-2xl bg-gray-50 flex items-center justify-center text-3xl shadow-inner">
                    <i class="fas ${spot.icon} ${spot.color}"></i>
                </div>
            </div>
            
            <button onclick="openSpeak('${spot.thai_name || spot.name}')" class="w-full bg-jp-text text-white rounded-2xl py-4 mb-6 shadow-lg active:scale-95 transition flex items-center justify-center gap-3">
                <i class="fas fa-comment-dots text-xl"></i>
                <span class="font-bold text-base">çµ¦å¸æ©Ÿ / åº—å“¡çœ‹</span>
            </button>
            
            <div class="prose prose-sm text-gray-600 leading-relaxed text-sm mb-6 bg-mag-paper p-5 rounded-2xl border border-yellow-50 shadow-sm">
                <h4 class="text-xs font-bold text-amber-500 mb-2 uppercase tracking-widest">About this place</h4>
                ${spot.deep_desc ? spot.deep_desc.replace(/\n/g, '<br>') : 'æš«ç„¡æ·±åº¦ä»‹ç´¹...'}
            </div>
            
            <div class="grid grid-cols-2 gap-3 mb-4">
                <a href="${spot.link || '#'}" target="_blank" class="flex items-center justify-center gap-2 bg-gray-50 py-3 rounded-xl text-xs font-bold text-gray-600 hover:bg-gray-100 transition">
                    <i class="fas fa-map-marker-alt text-red-400"></i> Google Map
                </a>
                <a href="https://www.google.com/search?q=${encodeURIComponent('æ›¼è°· ' + spot.name + ' æ”»ç•¥')}" target="_blank" class="flex items-center justify-center gap-2 bg-gray-50 py-3 rounded-xl text-xs font-bold text-gray-600 hover:bg-gray-100 transition">
                    <i class="fab fa-google text-blue-400"></i> æœå°‹æ”»ç•¥
                </a>
            </div>
            
            <button onclick="openEditSpot(${index}); closeDetailSheet();" class="w-full py-3 text-xs text-gray-400 font-bold hover:text-jp-text transition">ç·¨è¼¯æ­¤è¡Œç¨‹</button>
        `;
        
        sheet.classList.add('active');
    }
    
    function closeDetailSheet() {
        document.getElementById('detail-sheet').classList.remove('active');
    }
    
    function openSpeak(text) {
        if(!text) return alert("ç„¡æ³°æ–‡åç¨±");
        document.getElementById('speak-text').innerText = text;
        document.getElementById('speak-modal').classList.add('active');
    }

    // --- SORTING ---
    function openSortModal() {
        const spots = state.itinerary[state.currentDay].spots;
        if(!spots || spots.length === 0) return alert("æ²’æœ‰è¡Œç¨‹å¯æ’åº");
        
        const container = document.getElementById('sort-list-container');
        container.innerHTML = spots.map((s, i) => `
            <div class="bg-gray-50 p-3 mb-2 rounded-xl flex items-center justify-between" data-id="${i}">
                <div class="flex items-center gap-3 overflow-hidden">
                    <i class="fas ${s.icon} text-gray-400 w-4"></i>
                    <span class="font-bold text-sm text-gray-600 truncate">${s.name}</span>
                </div>
                <i class="fas fa-bars text-gray-300 cursor-move p-2"></i>
            </div>
        `).join('');
        const modal = document.getElementById('sort-modal');
        modal.classList.add('open');
        
        if(sortable) sortable.destroy();
        sortable = new Sortable(container, { animation: 150, handle: '.fa-bars' });
    }

    function confirmSort() {
        const newOrder = sortable.toArray();
        const currentSpots = state.itinerary[state.currentDay].spots;
        state.itinerary[state.currentDay].spots = newOrder.map(index => currentSpots[parseInt(index)]);
        saveData();
        renderItinerary();
        closeModal('sort-modal');
    }

    // --- EDITING ---
    let currentEditIndex = -1;
    function openEditSpot(index = -1) {
        currentEditIndex = index;
        document.getElementById('itinerary-modal').classList.add('open');
        const fields = ['time', 'name', 'thai', 'deep-desc', 'icon'];
        const isNew = index === -1;
        document.getElementById('spot-modal-title').innerText = isNew ? "æ–°å¢è¡Œç¨‹" : "ä¿®æ”¹è¡Œç¨‹";
        document.getElementById('btn-delete-spot').style.display = isNew ? 'none' : 'block';
        if (isNew) {
            fields.forEach(f => { const el = document.getElementById('spot-'+f); if(el) el.value = (f==='icon'?'fa-map-marker-alt':''); });
        } else {
            const s = state.itinerary[state.currentDay].spots[index];
            fields.forEach(f => {
                const el = document.getElementById('spot-'+f);
                if (f === 'deep-desc') { if(el) el.value = s.deep_desc || ''; }
                else if (f === 'thai') { if(el) el.value = s.thai_name || ''; }
                else if(el) el.value = s[f] || (f==='icon'?'fa-map-marker-alt':'');
            });
        }
    }

    function saveSpot() {
        const s = {
            time: document.getElementById('spot-time').value,
            name: document.getElementById('spot-name').value,
            thai_name: document.getElementById('spot-thai').value,
            deep_desc: document.getElementById('spot-deep-desc').value,
            icon: document.getElementById('spot-icon').value,
            desc: document.getElementById('spot-name').value, 
            color: 'text-gray-500'
        };
        if (!s.name) return alert("è«‹è¼¸å…¥åç¨±");
        if (!state.itinerary[state.currentDay].spots) state.itinerary[state.currentDay].spots = [];
        
        if (currentEditIndex === -1) { state.itinerary[state.currentDay].spots.push(s); }
        else { state.itinerary[state.currentDay].spots[currentEditIndex] = s; }
        
        saveData(); renderItinerary(); closeModal('itinerary-modal');
    }
    function deleteSpot() { if(confirm("åˆªé™¤?")) { state.itinerary[state.currentDay].spots.splice(currentEditIndex, 1); saveData(); renderItinerary(); closeModal('itinerary-modal'); } }

    // --- UTILS ---
    function switchTab(id) { document.querySelectorAll('.section').forEach(e=>e.classList.remove('active')); document.getElementById(id).classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b=>{b.classList.remove('active');}); document.querySelector(`.nav-btn[data-target="${id}"]`).classList.add('active'); }
    function saveData() { localStorage.setItem('bkk_2025_v27_super_force', JSON.stringify(state)); } // Updated Key V27 Super Force
    function loadData() { 
        const d = localStorage.getItem('bkk_2025_v27_super_force');
        if(d) {
            const loaded = JSON.parse(d);
            // Overwrite itinerary from DEFAULT_ITINERARY to ensure updates are seen
            state = { ...loaded, itinerary: DEFAULT_ITINERARY };
        }
    }
    function hardReset() { if(confirm("ç¢ºå®šé‡ç½®æ‰€æœ‰è³‡æ–™?")) { localStorage.removeItem('bkk_2025_v27_super_force'); location.reload(); } }

    // Cloud & Account Logic
    async function autoSync() { const h=document.getElementById('header-status'); if(h) h.innerText='Syncing...'; try { const res = await fetch(GOOGLE_SCRIPT_URL + '?t=' + Date.now()); const d = await res.json(); if(d && Object.keys(d).length > 0) { state = {...state, ...d}; saveData(); renderAll(); } h.innerText='æ›¼è°·å¸‚'; } catch(e){ h.innerText='Offline'; } }
    async function syncToCloud(action) { 
        try {
            if(action==='upload') { await fetch(GOOGLE_SCRIPT_URL, {method:'POST', mode:'no-cors', headers:{'Content-Type':'application/json'}, body:JSON.stringify(state)}); alert("ä¸Šå‚³è«‹æ±‚å·²ç™¼é€"); }
            else { const res = await fetch(GOOGLE_SCRIPT_URL + '?t=' + Date.now()); const d = await res.json(); if(d && confirm("è¦†è“‹æœ¬æ©Ÿ?")) { state={...state, ...d}; saveData(); location.reload(); } }
        } catch(e) { alert("åŒæ­¥éŒ¯èª¤"); }
    }

    // Account Rendering
    let acc = { cat:'é¤é£²', payer:'å…¬è²»åŒ…', cur:'THB' };
    function renderAccCats() { const cats=[{n:'é¤é£²',i:'fa-utensils'},{n:'äº¤é€š',i:'fa-car'},{n:'è³¼ç‰©',i:'fa-shopping-bag'},{n:'ä½å®¿',i:'fa-bed'},{n:'å…¶ä»–',i:'fa-ellipsis-h'}]; document.getElementById('cat-container').innerHTML = cats.map((c,i)=>`<button onclick="acc.cat='${c.n}';renderAccCats();" class="flex-shrink-0 w-16 h-16 rounded-2xl flex flex-col items-center justify-center border transition ${acc.cat===c.n?'bg-jp-text text-white border-jp-text shadow-lg':'bg-white text-gray-400 border-gray-100'}"><i class="fas ${c.i} mb-1"></i><span class="text-xs font-bold">${c.n}</span></button>`).join(''); }
    function renderPayers() { document.getElementById('payer-container').innerHTML = state.users.map(u=>`<button onclick="acc.payer='${u}';renderPayers();" class="px-4 py-2 rounded-xl text-xs font-bold border transition ${acc.payer===u?'bg-jp-accent text-white border-jp-accent':'bg-gray-50 text-gray-400 border-transparent'}">${u}</button>`).join(''); }
    function setCurrency(c) { acc.cur=c; document.getElementById('cur-twd').className=c==='TWD'?'px-3 h-full rounded-lg bg-white shadow-sm text-jp-text font-bold':'px-3 h-full rounded-lg text-gray-400 font-bold'; document.getElementById('cur-thb').className=c==='THB'?'px-3 h-full rounded-lg bg-white shadow-sm text-jp-text font-bold':'px-3 h-full rounded-lg text-gray-400 font-bold'; }
    function updateFundDisplay() { 
        const txt = `à¸¿ ${state.fundBalance.toLocaleString()}`;
        document.getElementById('acc-fund-display').innerText = txt; 
        if(document.getElementById('home-fund-display')) document.getElementById('home-fund-display').innerText = txt; 
    }
    function submitTx() { const amt=parseFloat(document.getElementById('amt-input').value); if(!amt) return alert("è¼¸å…¥é‡‘é¡"); if(acc.payer==='å…¬è²»åŒ…') state.fundBalance-=amt; state.transactions.unshift({id:Date.now(), date:new Date().toLocaleString(), amt, note:document.getElementById('note-input').value, payer:acc.payer, cat:acc.cat, cur:acc.cur}); saveData(); updateFundDisplay(); renderHistory(); document.getElementById('amt-input').value=''; alert("å·²è¨˜éŒ„"); }
    function renderHistory() { document.getElementById('tx-history').innerHTML = state.transactions.slice(0,10).map(t=>`<div class="bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center border border-white"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center text-xs text-gray-400 font-bold">${t.payer[0]}</div><div><p class="text-sm font-bold text-jp-text">${t.note||t.cat}</p><p class="text-[10px] text-gray-400">${t.date.split(' ')[0]}</p></div></div><span class="font-bold text-jp-text">- ${t.amt}</span></div>`).join(''); }
    function editUsers() { const n=prompt("æˆå“¡åå–® (,åˆ†éš”)", state.users.join(',')); if(n) { state.users=n.split(','); saveData(); renderPayers(); } }

    function renderChecklist() { document.getElementById('checklist-container').innerHTML = state.checklist.map((c,i)=>`<div class="bg-white rounded-2xl p-5 shadow-card mb-4 border border-white"><h3 class="font-bold text-jp-text mb-3 flex justify-between">${c.title} <button onclick="state.checklist.splice(${i},1);saveData();renderChecklist()" class="text-gray-200 text-xs"><i class="fas fa-trash"></i></button></h3><div class="space-y-2">${c.items.map((m,j)=>`<label class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition"><input type="checkbox" ${m.checked?'checked':''} onchange="state.checklist[${i}].items[${j}].checked=this.checked;saveData();renderChecklist()" class="w-5 h-5 rounded-md accent-jp-green"><span class="text-sm ${m.checked?'line-through text-gray-300':'text-gray-600'}">${m.name}</span></label>`).join('')}</div><button onclick="const n=prompt('æ–°å¢é …ç›®');if(n){state.checklist[${i}].items.push({name:n,checked:false});saveData();renderChecklist()}" class="w-full mt-3 py-2 text-xs font-bold text-gray-400 bg-gray-50 rounded-xl hover:bg-gray-100">+ Add Item</button></div>`).join('');
    const total = state.checklist.reduce((acc, c) => acc + c.items.length, 0);
    const done = state.checklist.reduce((acc, c) => acc + c.items.filter(i=>i.checked).length, 0);
    document.getElementById('home-check-progress').innerText = `${total===0?0:Math.round((done/total)*100)}% Ready`;
    }
    function addChecklistCategory() { state.checklist.push({title:'New List', items:[]}); saveData(); renderChecklist(); }
    function addChecklistItem() { if(state.checklist.length>0) { const n=prompt("é …ç›®"); if(n){state.checklist[0].items.push({name:n,checked:false});saveData();renderChecklist();} } }
    
    function exportData() { navigator.clipboard.writeText(JSON.stringify(state)); alert("ä»£ç¢¼å·²è¤‡è£½"); }
    function openImportModal() { document.getElementById('import-modal').classList.add('open'); }
    function closeModal(id) { document.getElementById(id).classList.remove('open'); }
    function confirmImport() { try { state = JSON.parse(document.getElementById('import-area').value); saveData(); location.reload(); } catch { alert("æ ¼å¼éŒ¯èª¤"); } }
    
    function renderAll() { renderItinerary(); renderAccCats(); renderPayers(); updateFundDisplay(); renderHistory(); renderChecklist(); }

</script>
</body>
</html>
