<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025 æ›¼è°·è–èª•è·¨å¹´ - æ³°å»¢äº†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Zen+Kaku+Gothic+New:wght@400;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'jp-bg': '#F9F8F4',
                        'jp-text': '#4A4A4A',
                        'jp-accent': '#C6A568',
                        'jp-blue': '#6B8EAD',
                        'jp-green': '#8DA399',
                        'jp-red': '#D67D7D',
                        'mag-paper': '#FFFBF0', // é›œèªŒç´™å¼µè‰²
                    },
                    fontFamily: {
                        sans: ['"Zen Kaku Gothic New"', 'sans-serif'],
                        serif: ['"Noto Serif TC"', 'serif'], // é›œèªŒé¢¨å­—é«”
                    },
                    boxShadow: {
                        'soft': '0 4px 20px rgba(0, 0, 0, 0.03)',
                        'gold': '0 4px 15px rgba(198, 165, 104, 0.15)',
                    }
                }
            }
        }
    </script>
   
    <style>
        body { background-color: #F0F0F0; font-family: 'Zen Kaku Gothic New', sans-serif; -webkit-tap-highlight-color: transparent; user-select: none; }
        .app-container { background-color: #F9F8F4; max-width: 430px; margin: 0 auto; min-height: 100vh; padding-bottom: 100px; overflow-x: hidden; position: relative; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Timeline */
        .timeline-item { position: relative; padding-left: 32px; padding-bottom: 24px; border-left: 2px solid #E5E7EB; margin-left: 12px; transition: transform 0.2s; }
        .timeline-item:last-child { border-left: 2px solid transparent; }
        .timeline-dot { position: absolute; left: -7px; top: 0; width: 12px; height: 12px; border-radius: 50%; background: #C6A568; border: 2px solid #F9F8F4; z-index: 10; }
        .timeline-time { font-size: 11px; font-weight: bold; color: #6B8EAD; margin-bottom: 4px; display: block; }
        
        .drag-handle { position: absolute; left: -40px; top: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; color: #D1D5DB; cursor: grab; touch-action: none; }
        .drag-handle:active { color: #C6A568; cursor: grabbing; }
        .sortable-ghost { opacity: 0.3; background: #f3f4f6; border-radius: 12px; }

        /* Buttons & Nav */
        .cat-btn.active { border: 1px solid #C6A568; background-color: #FFFCF5; color: #C6A568; }
        .payer-btn.active { background-color: #FFF9E6; border: 1px solid #C6A568; color: #C6A568; font-weight: bold; }
        .split-btn.active { background-color: #4A4A4A; color: white; }
        .nav-btn.active { color: #C6A568; }
        .nav-btn.active i { transform: scale(1.1); transition: 0.2s; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; display: none; align-items: center; justify-content: center; }
        .modal-overlay.open { display: flex; }
        .edit-spot-btn { opacity: 0.3; transition: 0.2s; }
        .timeline-item:hover .edit-spot-btn { opacity: 1; }
        
        /* Magazine Accordion */
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
    </style>
</head>
<body>

<div class="app-container">
    
    <header class="sticky top-0 z-50 bg-[#F9F8F4]/95 backdrop-blur-sm px-5 py-4 flex justify-between items-end border-b border-gray-100">
        <div>
            <p class="text-[10px] text-gray-400 tracking-widest mb-1">DEC 23 - DEC 28</p>
            <h1 class="text-xl font-bold text-jp-text tracking-wide leading-tight">2025 æ›¼è°·è–èª•è·¨å¹´<br><span class="text-jp-accent text-lg">- æ³°å»¢äº† -</span></h1>
        </div>
        <div class="text-center">
             <span class="block text-[10px] text-gray-400">æ›¼è°·</span>
             <span class="text-sm font-medium transition-all duration-300" id="header-display-area">
                 <span class="text-gray-400 text-xs"><i class="fas fa-circle-notch fa-spin"></i> è¼‰å…¥ä¸­...</span>
             </span>
        </div>
    </header>

    <div id="tab-home" class="section active px-5 py-4">
        <div class="bg-white rounded-[32px] p-6 shadow-soft mb-8 relative overflow-hidden">
            <div class="absolute -top-6 -right-6 w-20 h-20 bg-[#F9F8F4] rounded-full z-0"></div>
            <h2 class="text-lg font-bold text-jp-text mb-5 relative z-10">Dashboard</h2>
            <div class="flex gap-4 mb-5 relative z-10">
                <div class="flex-1 bg-gray-50/50 rounded-2xl p-3 flex flex-col justify-between h-24">
                    <span class="text-[10px] text-gray-400">åŒ¯ç‡ (TWD/THB)</span>
                    <span class="text-2xl font-bold text-jp-text mt-1" id="dash-rate">loading...</span>
                    <span class="text-[10px] text-green-600 mt-auto">å³æ™‚åŒ¯ç‡æ›´æ–°</span>
                </div>
                <div class="flex-1 bg-gray-50/50 rounded-2xl p-3 flex flex-col justify-between h-24">
                    <span class="text-[10px] text-gray-400">å…¬è²»éŒ¢åŒ…</span>
                    <span class="text-xl font-bold text-jp-text mt-1 truncate" id="home-fund-display">à¸¿ 0</span>
                    <span class="text-[10px] text-gray-400 mt-auto">å‰©é¤˜é ç®—</span>
                </div>
            </div>
            <div class="bg-gray-100 rounded-xl px-4 py-3 flex items-center justify-between relative z-10">
                <div class="flex-1 mr-2">
                    <p class="text-[10px] text-gray-400 mb-1">æ±‚ç”Ÿæ³°èª</p>
                    <input type="text" id="thai-input" placeholder="Mai Sai Pak Chi (ä¸è¦é¦™èœ)" class="w-full bg-transparent text-sm text-jp-text font-medium outline-none placeholder-gray-400">
                </div>
                <button onclick="translateThai()" class="text-gray-400 hover:text-jp-accent active:scale-95 transition"><i class="fas fa-volume-up text-lg"></i></button>
            </div>
        </div>

        <h3 class="text-sm font-bold text-gray-400 mb-3 ml-1 uppercase tracking-wider">QUICK ACCESS</h3>
        <div class="grid grid-cols-2 gap-3 mb-20">
             <button onclick="switchTab('tab-checklist')" class="bg-white p-4 rounded-xl shadow-soft text-left flex flex-col justify-between h-28 active:scale-95 transition">
                <i class="fas fa-info-circle text-jp-accent text-xl"></i>
                <div>
                    <span class="text-sm font-bold block text-jp-text mt-2">è³‡è¨Š & æ¸…å–®</span>
                    <span class="text-xs text-gray-400" id="home-check-progress">å®Œæˆåº¦ 0%</span>
                </div>
            </button>
            <button onclick="switchTab('tab-account')" class="bg-white p-4 rounded-xl shadow-soft text-left flex flex-col justify-between h-28 border border-jp-accent/20 active:scale-95 transition relative">
                 <div class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                <i class="fas fa-calculator text-jp-red text-xl"></i>
                <div>
                    <span class="text-sm font-bold block text-jp-text mt-2">æ™ºæ…§è¨˜å¸³</span>
                    <span class="text-xs text-gray-400" id="home-account-status">å¾…çµç®—...</span>
                </div>
            </button>
            <button onclick="switchTab('tab-itinerary')" class="bg-white p-4 rounded-xl shadow-soft text-left flex flex-col justify-between h-24 relative overflow-hidden group active:scale-95 transition col-span-2">
                <div class="absolute top-0 right-0 w-12 h-12 bg-jp-blue/10 rounded-full -mr-4 -mt-4"></div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-map-marked-alt text-jp-blue text-xl relative z-10"></i>
                    <div>
                        <span class="text-sm font-bold block text-jp-text">è¡Œç¨‹è¦åŠƒ</span>
                        <span class="text-xs text-gray-400 font-sans" id="current-date-display">Dec 23</span>
                    </div>
                </div>
            </button>
        </div>
    </div>

    <div id="tab-itinerary" class="section pb-24">
        <div class="sticky top-[72px] z-40 bg-[#F9F8F4] px-5 py-2 mb-2 shadow-sm flex justify-between items-center">
            <div class="flex overflow-x-auto hide-scrollbar gap-3 pb-2 flex-1" id="day-tabs"></div>
            <button onclick="openEditSpot()" class="ml-2 w-8 h-8 rounded-full bg-jp-text text-white flex items-center justify-center shadow-md flex-shrink-0"><i class="fas fa-plus text-xs"></i></button>
        </div>
        <p class="text-[10px] text-gray-400 text-center mb-2"><i class="fas fa-bars mr-1"></i>æŒ‰ä½å·¦å´æŠŠæ‰‹å¯æ‹–æ›³æ’åº</p>
        <div id="itinerary-content" class="px-5 space-y-4 min-h-[50vh]"></div>
        <div class="px-5 mt-8 mb-4">
             <h3 class="text-sm font-bold text-gray-400 mb-2 uppercase">ä½å®¿è³‡è¨Š</h3>
             <div class="bg-white rounded-xl p-3 shadow-sm border-l-4 border-jp-blue mb-2">
                 <p class="text-xs font-bold text-jp-blue">12/23 - 12/25 (å”äººè¡—)</p>
                 <p class="text-sm font-bold text-jp-text">B2 å”äººè¡—è€€è¯åŠ›å°Šå°šé£¯åº—</p>
                 <a href="https://maps.app.goo.gl/ZjNM4vwDCNQdAq637?g_st=ipc" target="_blank" class="text-[10px] text-gray-400 underline"><i class="fas fa-map-marker-alt"></i> æŸ¥çœ‹åœ°åœ–</a>
             </div>
             <div class="bg-white rounded-xl p-3 shadow-sm border-l-4 border-jp-accent">
                 <p class="text-xs font-bold text-jp-accent">12/25 - 12/27 (é€šç¾…)</p>
                 <p class="text-sm font-bold text-jp-text">æ›¼è°·èŒ‰è‰èŠ±59è™Ÿé£¯åº—</p>
                 <a href="https://maps.app.goo.gl/DmVbJdwrbkwQ7p8K6?g_st=ipc" target="_blank" class="text-[10px] text-gray-400 underline"><i class="fas fa-map-marker-alt"></i> æŸ¥çœ‹åœ°åœ–</a>
             </div>
        </div>
    </div>

    <div id="tab-account" class="section px-4 py-4 pb-24">
        <div class="bg-white rounded-2xl shadow-gold p-5 border border-gray-50 relative">
            <div class="absolute top-4 right-4 text-right">
                <p class="text-[10px] text-gray-400">å…¬è²»åŒ…é¤˜é¡ (THB)</p>
                <p class="text-xl font-bold text-jp-accent" id="acc-fund-display">à¸¿ 0</p>
            </div>
            <h2 class="text-lg font-bold text-jp-text mb-4">æ–°å¢è¨˜å¸³</h2>
            <div class="flex justify-between gap-2 overflow-x-auto hide-scrollbar mb-4" id="cat-container"></div>
            <div class="flex gap-2 mb-4">
                 <div class="flex bg-gray-50 rounded-lg p-1 h-14 items-center">
                    <button onclick="setCurrency('TWD')" id="cur-twd" class="px-3 py-2 text-xs rounded text-gray-400 font-bold h-full">TWD</button>
                    <button onclick="setCurrency('THB')" id="cur-thb" class="px-3 py-2 text-xs rounded bg-white shadow-sm text-jp-text font-bold h-full">THB</button>
                </div>
                <div class="flex-1 bg-gray-50 rounded-xl px-4 flex flex-col justify-center relative">
                    <span class="text-[10px] text-gray-400 absolute top-2 right-4">é‡‘é¡</span>
                    <input type="number" id="amt-input" placeholder="0" class="w-full text-right text-3xl font-bold text-jp-text bg-transparent outline-none p-0">
                </div>
            </div>
            <div class="mb-4">
                <div class="flex justify-between items-center mb-2">
                    <p class="text-xs text-gray-400">ä»˜æ¬¾äºº</p>
                    <button onclick="editUsers()" class="text-[10px] text-blue-400 underline">ç·¨è¼¯åå–®</button>
                </div>
                <div class="flex flex-wrap gap-2" id="payer-container"></div>
            </div>
            <div class="mb-4">
                <p class="text-xs text-gray-400 mb-2">åˆ†æ”¤æ¨¡å¼</p>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="setSplit('shared')" id="split-shared" class="split-btn active py-2 rounded-lg text-xs border border-gray-200">å…±åŒåˆ†æ”¤ (æ‰£å…¬è²»/è¨˜å¸³)</button>
                    <button onclick="setSplit('deposit')" id="split-deposit" class="split-btn py-2 rounded-lg text-xs border border-gray-200 text-gray-400">å…¬è²»å…¥é‡‘ (å­˜éŒ¢)</button>
                    <button onclick="setSplit('own')" id="split-own" class="split-btn py-2 rounded-lg text-xs border border-gray-200 text-gray-400">å€‹äººè‡ªä»˜</button>
                    <button onclick="setSplit('advance')" id="split-advance" class="split-btn py-2 rounded-lg text-xs border border-gray-200 text-gray-400">å¹«äººä»£å¢Š</button>
                </div>
            </div>
            <div class="flex gap-2 mb-4">
                <button class="w-10 h-10 rounded-full border border-gray-200 flex items-center justify-center text-gray-400"><i class="fas fa-camera"></i></button>
                <input type="text" id="note-input" placeholder="å‚™è¨» (å¦‚: 7-11)" class="flex-1 bg-gray-50 rounded-lg px-3 text-sm outline-none">
            </div>
            <button onclick="submitTx()" class="w-full bg-jp-text text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition">æ–°å¢ç´€éŒ„</button>
        </div>
        <div class="mt-6">
            <div class="flex justify-between items-center mb-2 px-1">
                 <h3 class="text-sm font-bold text-gray-500">è¿‘æœŸç´€éŒ„</h3>
                <button onclick="clearTx()" class="text-xs text-red-300">æ¸…ç©º</button>
            </div>
            <div id="tx-history" class="space-y-2 pb-10"></div>
        </div>
    </div>
    
    <div id="tab-checklist" class="section px-5 py-4 pb-24">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">è¡Œææ¸…å–®</h2>
            <div class="flex gap-2">
                <button onclick="addChecklistCategory()" class="w-8 h-8 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center"><i class="fas fa-folder-plus text-xs"></i></button>
                <button onclick="addChecklistItem()" class="w-8 h-8 rounded-full bg-jp-accent text-white flex items-center justify-center shadow-md"><i class="fas fa-plus text-xs"></i></button>
            </div>
        </div>
         <div id="checklist-container"></div>
         
         <h3 class="font-bold text-lg mt-10 mb-4 text-jp-text flex items-center"><i class="fas fa-info-circle mr-2 text-jp-blue"></i>å¯¦ç”¨è³‡è¨Š (INFO)</h3>
         <div class="space-y-4">
             <div class="bg-white rounded-xl p-4 shadow-sm flex items-center justify-between border border-gray-100">
                 <div class="flex items-center gap-3">
                     <i class="fas fa-cloud-sun text-yellow-400 text-xl"></i>
                     <div>
                         <span class="block text-sm font-bold text-jp-text">æ›¼è°·å¤©æ°£é å ±</span>
                         <span class="text-xs text-gray-400">OpenWeatherMap</span>
                     </div>
                 </div>
                 <a href="https://weather.com/zh-TW/weather/today/l/THBM0024:1:TH" target="_blank" class="px-3 py-1 rounded-full bg-gray-100 text-xs text-gray-600">æŸ¥çœ‹</a>
             </div>
             <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                 <h4 class="text-xs text-gray-400 mb-3 font-bold tracking-wider">ç·Šæ€¥è¯çµ¡ EMERGENCY</h4>
                 <div class="space-y-3">
                    <div class="flex justify-between text-sm border-b border-gray-50 pb-2 items-center">
                        <span class="flex items-center gap-2"><i class="fas fa-user-shield text-gray-400 w-4"></i>è§€å…‰è­¦å¯Ÿ</span>
                        <a href="tel:1155" class="font-bold text-red-500 bg-red-50 px-2 py-1 rounded">1155</a>
                    </div>
                    <div class="flex justify-between text-sm border-b border-gray-50 pb-2 items-center">
                        <span class="flex items-center gap-2"><i class="fas fa-ambulance text-gray-400 w-4"></i>æ•‘è­·è»Š</span>
                        <a href="tel:1669" class="font-bold text-red-500 bg-red-50 px-2 py-1 rounded">1669</a>
                    </div>
                    <div class="flex justify-between text-sm items-center">
                        <span class="flex items-center gap-2"><i class="fas fa-flag text-gray-400 w-4"></i>é§æ³°ä»£è¡¨è™•</span>
                        <a href="tel:+66816664006" class="font-bold text-blue-500 bg-blue-50 px-2 py-1 rounded">+66-81-666-4006</a>
                    </div>
                </div>
             </div>
             <div class="bg-mag-paper rounded-xl p-4 shadow-sm border border-amber-100">
                 <h4 class="text-xs text-amber-600 mb-3 font-bold tracking-wider"><i class="fas fa-exclamation-triangle mr-1"></i>æ—…éŠç¦å¿Œ & æ³¨æ„</h4>
                 <ul class="text-xs text-jp-text space-y-2 list-disc pl-4 font-medium leading-relaxed">
                     <li><strong class="text-purple-600">è²·é…’æ™‚é–“é™åˆ¶</strong>ï¼šè¶…å•†/è¶…å¸‚åƒ… <span class="font-bold">11:00-14:00</span> èˆ‡ <span class="font-bold">17:00-24:00</span> å¯è²©å”®é…’ç²¾é£²å“ã€‚ä½›ç¯€å…¨æ—¥ç¦é…’ã€‚</li>
                     <li><strong class="text-red-500">é›»å­è¸å…¨æ³°åœ‹é•æ³•</strong>ï¼šæ”œå¸¶æˆ–ä½¿ç”¨çš†å¯èƒ½é¢è‡¨é«˜é¡ç½°æ¬¾æˆ–ç›£ç¦ï¼Œåˆ‡å‹¿å˜—è©¦ã€‚</li>
                     <li><strong class="text-green-600">å¤§éº»ç›¸é—œ</strong>ï¼šé›–å·²é™¤ç½ªåŒ–ï¼Œä½†åœ¨å…¬å…±å ´æ‰€å¸é£Ÿä»å±¬é•æ³•æ“¾æ°‘ï¼Œä¸”ä¸å¯æ”œå¸¶å‡ºå¢ƒå›å°ã€‚</li>
                     <li><strong class="text-jp-blue">å¯ºå»Ÿç©¿è‘—</strong>ï¼šåƒè§€é„­ç‹å»Ÿã€è‡¥ä½›å¯ºç­‰ï¼Œä¸å¯ç©¿ç„¡è¢–ã€çŸ­è¤²/çŸ­è£™ (éœ€éè†)ã€‚</li>
                     <li><strong class="text-gray-500">å°è²»æ–‡åŒ–</strong>ï¼šæŒ‰æ‘©/é£¯åº—å»ºè­°çµ¦ 20-50 æ³°éŠ–ç´™éˆ”ï¼Œé¿å…çµ¦ç¡¬å¹£ (è¦–ç‚ºæ–½æ¨)ã€‚</li>
                 </ul>
             </div>
         </div>
    </div>

    <div id="tab-settings" class="section px-5 py-4 pb-24">
        <h2 class="text-xl font-bold mb-6">è¨­å®š</h2>
        <div class="bg-white rounded-2xl shadow-soft p-5 mb-6 border border-jp-green/30 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-16 h-16 bg-jp-green/10 rounded-full -mr-6 -mt-6"></div>
            <h3 class="font-bold text-jp-text mb-2"><i class="fab fa-google-drive text-jp-green mr-2"></i>é›²ç«¯è³‡æ–™åº« (Google Sheets)</h3>
            <p class="text-xs text-gray-500 mb-4 leading-relaxed">åŒæ­¥è‡³ Google è©¦ç®—è¡¨ã€‚<br><span class="text-[10px] text-gray-400">éœ€é€£ç¶²ã€‚é»æ“Šä¸‹è¼‰æœƒè¦†è“‹æœ¬æ©Ÿè³‡æ–™ã€‚</span></p>
            <div class="flex gap-3">
                 <button onclick="syncToCloud('upload')" id="btn-upload" class="flex-1 bg-jp-text text-white py-3 rounded-lg text-sm shadow hover:opacity-90 active:scale-95 transition flex items-center justify-center gap-2"><i class="fas fa-cloud-upload-alt"></i> ä¸Šå‚³å‚™ä»½</button>
                <button onclick="syncToCloud('download')" id="btn-download" class="flex-1 bg-white border border-jp-text text-jp-text py-3 rounded-lg text-sm shadow hover:bg-gray-50 active:scale-95 transition flex items-center justify-center gap-2"><i class="fas fa-cloud-download-alt"></i> ä¸‹è¼‰è¦†è“‹</button>
            </div>
            <p id="sync-status" class="text-[10px] text-center mt-2 text-gray-400 h-4"></p>
        </div>
        <div class="bg-white rounded-2xl shadow-soft p-5 mb-6 border border-jp-blue/20">
            <h3 class="font-bold text-jp-blue mb-2"><i class="fas fa-qrcode mr-2"></i>å¿«é€Ÿè½‰ç§» (ç„¡ç¶²è·¯ç”¨)</h3>
            <div class="flex gap-3">
                 <button onclick="exportData()" class="flex-1 bg-jp-blue text-white py-3 rounded-lg text-sm shadow hover:opacity-90"><i class="fas fa-copy mr-1"></i> è¤‡è£½ä»£ç¢¼</button>
                <button onclick="openImportModal()" class="flex-1 bg-gray-600 text-white py-3 rounded-lg text-sm shadow hover:opacity-90"><i class="fas fa-paste mr-1"></i> è²¼ä¸ŠåŒ¯å…¥</button>
            </div>
        </div>
        <div class="mt-8 text-center">
             <button onclick="hardReset()" class="text-xs text-red-400 underline p-2">é‡ç½®æ‰€æœ‰ App è³‡æ–™ (æ…ç”¨)</button>
        </div>
    </div>
    
    <div class="fixed right-5 bottom-24 z-50 flex flex-col gap-3">
        <button onclick="syncToCloud('download')" class="w-10 h-10 rounded-full bg-white shadow-lg border border-gray-100 flex items-center justify-center text-gray-500 active:scale-90 transition hover:text-jp-blue"><i class="fas fa-cloud-download-alt"></i></button>
        <button onclick="syncToCloud('upload')" class="w-10 h-10 rounded-full bg-jp-text shadow-lg border border-jp-text flex items-center justify-center text-white active:scale-90 transition hover:bg-gray-700"><i class="fas fa-cloud-upload-alt"></i></button>
    </div>

    <nav class="fixed bottom-6 left-5 right-5 h-16 bg-white/95 backdrop-blur rounded-2xl flex justify-around items-center shadow-gold z-50 border border-gray-100">
        <button onclick="switchTab('tab-home')" class="nav-btn active flex flex-col items-center gap-1 text-gray-400" data-target="tab-home"><i class="fas fa-home text-lg"></i><span class="text-[10px]">é¦–é </span></button>
        <button onclick="switchTab('tab-itinerary')" class="nav-btn flex flex-col items-center gap-1 text-gray-400" data-target="tab-itinerary"><i class="fas fa-map-marked-alt text-lg"></i><span class="text-[10px]">è¡Œç¨‹</span></button>
        <div class="relative -top-6">
            <button onclick="switchTab('tab-account')" class="w-14 h-14 bg-jp-text rounded-full shadow-lg flex items-center justify-center text-white text-xl transform hover:scale-105 transition active:scale-95 border-4 border-[#F9F8F4]"><i class="fas fa-plus"></i></button>
        </div>
        <button onclick="switchTab('tab-checklist')" class="nav-btn flex flex-col items-center gap-1 text-gray-400" data-target="tab-checklist"><i class="fas fa-info-circle text-lg"></i><span class="text-[10px]">è³‡è¨Š</span></button>
        <button onclick="switchTab('tab-settings')" class="nav-btn flex flex-col items-center gap-1 text-gray-400" data-target="tab-settings"><i class="fas fa-cog text-lg"></i><span class="text-[10px]">è¨­å®š</span></button>
    </nav>

    <div id="import-modal" class="modal-overlay"><div class="bg-white w-4/5 rounded-2xl p-5 shadow-2xl"><h3 class="font-bold text-lg mb-2">è²¼ä¸Šä»£ç¢¼</h3><textarea id="import-area" class="w-full h-32 bg-gray-50 border border-gray-200 rounded-lg p-2 text-xs mb-4"></textarea><div class="flex gap-2"><button onclick="closeModal('import-modal')" class="flex-1 py-2 rounded-lg border border-gray-200 text-sm">å–æ¶ˆ</button><button onclick="confirmImport()" class="flex-1 py-2 rounded-lg bg-jp-text text-white text-sm">ç¢ºå®š</button></div></div></div>
    <div id="advance-modal" class="modal-overlay"><div class="bg-white w-4/5 rounded-2xl p-5 shadow-2xl"><h3 class="font-bold text-lg mb-2">å¹«èª°ä»£å¢Š?</h3><div id="advance-list" class="space-y-2 mb-4"></div><div class="flex gap-2"><button onclick="closeModal('advance-modal')" class="flex-1 py-2 rounded-lg border border-gray-200 text-sm">å–æ¶ˆ</button><button onclick="confirmAdvance()" class="flex-1 py-2 rounded-lg bg-jp-text text-white text-sm">ç¢ºå®š</button></div></div></div>
    <div id="itinerary-modal" class="modal-overlay">
        <div class="bg-white w-[90%] rounded-2xl p-5 shadow-2xl max-h-[90vh] overflow-y-auto">
            <h3 class="font-bold text-lg mb-4 text-jp-text" id="spot-modal-title">ç·¨è¼¯æ™¯é»</h3>
            <input type="hidden" id="spot-index">
            <div class="space-y-3">
                <div><label class="text-xs text-gray-400 block mb-1">æ™‚é–“</label><input type="text" id="spot-time" class="w-full bg-gray-50 border border-gray-200 rounded p-2 text-sm"></div>
                <div><label class="text-xs text-gray-400 block mb-1">åç¨±</label><input type="text" id="spot-name" class="w-full bg-gray-50 border border-gray-200 rounded p-2 text-sm font-bold"></div>
                <div><label class="text-xs text-gray-400 block mb-1">ç°¡çŸ­æè¿°</label><input type="text" id="spot-desc" class="w-full bg-gray-50 border border-gray-200 rounded p-2 text-sm"></div>
                <div><label class="text-xs text-jp-accent block mb-1">ğŸ“– æ·±åº¦ä»‹ç´¹ (é¸å¡«)</label><textarea id="spot-deep-desc" class="w-full bg-mag-paper border border-amber-100 rounded p-2 text-xs h-20 placeholder-gray-300" placeholder="è¼¸å…¥æ­·å²èƒŒæ™¯ã€å†·çŸ¥è­˜..."></textarea></div>
                <div class="grid grid-cols-2 gap-2">
                    <div><label class="text-xs text-gray-400 block mb-1">Google Map ç¶²å€</label><input type="text" id="spot-link" class="w-full bg-gray-50 border border-gray-200 rounded p-2 text-xs" placeholder="https://..."></div>
                    <div><label class="text-xs text-gray-400 block mb-1">æ”»ç•¥é—œéµå­—</label><input type="text" id="spot-keyword" class="w-full bg-gray-50 border border-gray-200 rounded p-2 text-xs" placeholder="æœå°‹ç”¨"></div>
                </div>
                 <div><label class="text-xs text-gray-400 block mb-1">Icon (FontAwesome)</label><input type="text" id="spot-icon" class="w-full bg-gray-50 border border-gray-200 rounded p-2 text-xs" value="fa-map-marker-alt"></div>
            </div>
            <div class="flex gap-2 mt-6">
                <button onclick="deleteSpot()" id="btn-delete-spot" class="px-4 py-2 rounded-lg bg-red-50 text-red-400 text-sm"><i class="fas fa-trash"></i></button>
                <button onclick="closeModal('itinerary-modal')" class="flex-1 py-2 rounded-lg border border-gray-200 text-sm">å–æ¶ˆ</button>
                <button onclick="saveSpot()" class="flex-1 py-2 rounded-lg bg-jp-text text-white text-sm">å„²å­˜</button>
            </div>
        </div>
    </div>
</div>

<script>
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxYeyHua8VRjHu3dHbP3glwWcFf5zClFG_drBD9gR_j9MZpcGf6uajQUzmOw_Au_o0o/exec';
    
    // --- UPDATED DATA WITH DEEP DESCRIPTIONS FOR ALL SPOTS (V14) ---
    const DEFAULT_ITINERARY = [
        { "day": 1, "date": "12/23 (äºŒ)", "desc": "æŠµé”æ›¼è°·", "spots": [ 
            { "time": "18:00", "name": "é«˜é›„æ©Ÿå ´å‡ºç™¼", "desc": "æ³°åœ‹äºèˆª FD235 âœˆï¸ (21:30 æŠµé”å»Šæ›¼)", "icon": "fa-plane", "color": "text-blue-500", "deep_desc": "å»Šæ›¼æ©Ÿå ´ (DMK) æ˜¯æ›¼è°·çš„èˆŠæ©Ÿå ´ï¼Œè¦æ¨¡è¼ƒå°ä½†é€šé—œé€šå¸¸æ¯”ç´ è¬é‚£æ™® (BKK) å¿«ã€‚å‡ºé—œå¾Œè«‹ç•™æ„ã€ŒTaxiã€æŒ‡æ¨™ï¼Œæˆ–ä½¿ç”¨ Grab App å«è»Š (å»ºè­°é¸æ“‡ 1 æ¨“å¤–çš„æ¥é€é»)ã€‚" }, 
            { "time": "22:30", "name": "æ©Ÿå ´åŒ…è»Šæ¥æ©Ÿ", "desc": "å‰å¾€ B2 é£¯åº— (è»Šç¨‹ç´„30åˆ†)", "icon": "fa-car", "color": "text-green-600", "highlight": true, "deep_desc": "æ³°åœ‹é«˜é€Ÿå…¬è·¯ (Tollway) é€šå¸¸éœ€è¦ä¹˜å®¢é¡å¤–æ”¯ä»˜éè·¯è²» (ç´„ 50-70 æ³°éŠ–)ï¼Œå¸æ©Ÿéæ”¶è²»ç«™æ™‚æœƒè·Ÿä½ è¦éŒ¢ï¼Œé€™æ˜¯æ­£å¸¸çš„å–”ï¼æº–å‚™å¥½å°éˆ”ã€‚" }, 
            { "time": "Late", "name": "å”äººè¡—å®µå¤œ", "desc": "Check-in å¾Œè¦“é£Ÿ", "icon": "fa-utensils", "color": "text-orange-500", "keyword": "æ›¼è°·å”äººè¡—ç¾é£Ÿ", "deep_desc": "æ›¼è°·å”äººè¡— (è€€è¯åŠ›è·¯) æ˜¯å…¨çƒæœ€å¤è€çš„å”äººè¡—ä¹‹ä¸€ã€‚é€™è£¡æ™šä¸Šçš„éœ“è™¹ç‡ˆæ‹›ç‰Œæœ‰ç¨® 80 å¹´ä»£é¦™æ¸¯é›»å½±çš„æ°›åœã€‚å¿…åƒæ¨è–¦ï¼šT&K æµ·é®®ï¼ˆç¶ è‰²åˆ¶æœï¼‰ã€ç²¿æ±ï¼ˆKway Chapï¼‰ã€‚" }, 
            { "time": "Sleep", "name": "B2 å”äººè¡—é£¯åº—", "desc": "å…¥ä½ä¼‘æ¯", "link": "https://maps.app.goo.gl/ZjNM4vwDCNQdAq637?g_st=ipc", "keyword": "", "icon": "fa-bed", "color": "text-gray-500", "deep_desc": "B2 æ˜¯æ³°åœ‹çŸ¥åçš„å¹³åƒ¹é€£é–é£¯åº—ï¼Œä¸»æ‰“å·¥æ¥­é¢¨è¨­è¨ˆã€‚å”äººè¡—åˆ†åº—ä½ç½®æ¥µä½³ï¼Œèµ°è·¯å°±èƒ½åˆ° MRT Wat Mangkon ç«™ï¼Œä¸”å‘¨é‚Šå……æ»¿è€æ›¼è°·çš„ç”Ÿæ´»æ°£æ¯ã€‚" } 
        ] },
        { "day": 2, "date": "12/24 (ä¸‰)", "desc": "èˆŠåŸå¤è¹Ÿå·¡ç¦®", "spots": [ 
            { "time": "09:30", "name": "çŸ³é¾è»è·¯", "desc": "æ–‡é’æ•£ç­– / ç¾é£Ÿ", "link": "", "keyword": "çŸ³é¾è»è·¯ç¾é£Ÿ", "icon": "fa-walking", "color": "text-gray-500", "deep_desc": "Charoen Krung æ˜¯æ›¼è°·ç¬¬ä¸€æ¢é‹ªè¨­çš„é“è·¯ï¼Œå……æ»¿æ­·å²æ„Ÿã€‚é€™è£¡èåˆäº†è€å¼å»£æ±èŒ¶å®¤ã€ç™¾å¹´æ•™å ‚èˆ‡æ–°èˆˆçš„è—å»Šã€‚æ¨è–¦å˜—è©¦ã€Œä»å’Œåœ’ã€æ¶¼èŒ¶ï¼Œæˆ–æ˜¯ç±³å…¶æ—æ¨è–¦çš„è±¬è…³é£¯ã€‚" }, 
            { "time": "11:00", "name": "è‡¥ä½›å¯º", "desc": "å¿…æ‹å¤è¹Ÿ", "link": "", "keyword": "è‡¥ä½›å¯º", "icon": "fa-gopuram", "color": "text-gray-500", "deep_desc": "é€™è£¡æ“æœ‰æ³°åœ‹æœ€å¤§çš„è‡¥ä½›åƒ (é•·46å…¬å°º)ï¼Œè…³åº•åˆ»æœ‰ 108 å€‹ä½›é™€ç¥¥ç‘åœ–æ¡ˆã€‚æ­¤å¤–ï¼Œè‡¥ä½›å¯ºä¹Ÿæ˜¯æ³°å¼æŒ‰æ‘©çš„ç™¼æºåœ°ï¼Œå¦‚æœèµ°ç´¯äº†ï¼Œå¯ä»¥åœ¨å¯ºå…§çš„æŒ‰æ‘©å­¸æ ¡é«”é©—æœ€æ­£å®—çš„æ³°å¼å¤æ³•æŒ‰æ‘©ã€‚" }, 
            { "time": "13:30", "name": "é„­ç‹å»Ÿ", "desc": "æ‹ç…§åƒè§€", "link": "https://maps.app.goo.gl/4t2JkPEY1yKKBtoq5?g_st=ipc", "keyword": "é„­ç‹å»Ÿ", "icon": "fa-store", "color": "text-gray-500", "deep_desc": "åˆç¨±é»æ˜å¯º (Wat Arun)ã€‚ä¸åŒæ–¼æ³°åœ‹å¸¸è¦‹çš„é‡‘ç¢§è¼ç…Œï¼Œé€™è£¡ä»¥ç™½è‰²ç‚ºåº•ï¼Œé‘²åµŒè‘—ç„¡æ•¸ä¸­åœ‹é‹ä¾†çš„å½©è‰²ç¢ç“·ç‰‡ã€‚é€™åº§å¡”è±¡å¾µè‘—ä½›æ•™å®‡å®™è§€ä¸­çš„é ˆå½Œå±±ï¼Œæ—¥è½æ™‚åˆ†çš„å‰ªå½±è¢«è­½ç‚ºæ›¼è°·æœ€ç¾æ™¯è‰²ä¹‹ä¸€ã€‚" }, 
            { "time": "14:30", "name": "ç‹æœ—å¸‚å ´", "desc": "åœ¨åœ°å°åƒ", "link": "https://maps.app.goo.gl/Q43nUqg7KE9dRj8Z9?g_st=ipc", "keyword": "ç‹æœ—å¸‚å ´", "icon": "fa-map-marker-alt", "color": "text-gray-500", "deep_desc": "Wang Lang Market æ˜¯ç•¶åœ°å¤§å­¸ç”Ÿå’Œè­·å£«æœ€æ„›çš„å¸‚å ´ï¼Œè§€å…‰å®¢è¼ƒå°‘ï¼Œåƒ¹æ ¼éå¸¸è¦ªæ°‘ï¼å¿…è²·ï¼šç‚¸éºµåŒ… (Wang Lang Bakery)ã€æ³°å¼ç”œé»ã€çƒ¤è‚‰ä¸²ã€‚é€™è£¡ä¹Ÿæ˜¯æ­èˆ¹éæ²³åˆ°å¤§çš‡å®®çš„è½‰é‹é»ã€‚" }, 
            { "time": "19:00", "name": "æ˜­æŠ«è€¶æ²³æ™šé¤", "desc": "River City éƒµè¼ª", "icon": "fa-ship", "color": "text-blue-600", "keyword": "æ˜­æŠ«è€¶æ²³éŠèˆ¹æ¨è–¦", "deep_desc": "åœ¨èˆ¹ä¸Šç”¨é¤çš„äº®é»ä¸æ˜¯é£Ÿç‰©ï¼Œè€Œæ˜¯å…©å²¸çš„å¤œæ™¯ã€‚ä½ æœƒçœ‹åˆ°å¤œæ™šé»ç‡ˆçš„é„­ç‹å»Ÿå’Œå¤§çš‡å®®ï¼Œèˆ‡ç™½å¤©æˆªç„¶ä¸åŒã€‚å»ºè­°é¸æ“‡éœ²å¤©åº§ä½ï¼Œäº«å—æ²³é¢¨å¹æ‹‚çš„æµªæ¼«æ°›åœã€‚" } 
        ] },
        { "day": 3, "date": "12/25 (å››)", "desc": "é€šç¾…æ™‚å°šæ¼«éŠ", "spots": [ 
            { "time": "09:00", "name": "å‚³çµ±æ—©é¤", "desc": "ç›Šç”Ÿç”«è¨˜ or å®‰æ¨‚åœ’", "link": "https://maps.app.goo.gl/JmfSPvJffbXh7CeS7?g_st=ipc", "keyword": "æ›¼è°· å®‰æ¨‚åœ’", "icon": "fa-coffee", "color": "text-gray-500", "deep_desc": "å®‰æ¨‚åœ’ (On Lok Yun) é–‹æ¥­è¶…é 80 å¹´ï¼Œæ˜¯æ›¼è°·ç¶“å…¸çš„ã€Œæ´‹é£Ÿã€æ—©é¤åº—ã€‚é€™è£¡çš„å’–æ¤°åå¸ (Kaya Toast) èˆ‡æ³°å¼å¥¶èŒ¶æ˜¯çµ•é…ï¼Œå½·å½¿æ™‚å…‰å€’æµè‡³äºŒæˆ°å¾Œçš„æ›¼è°·ã€‚" }, 
            { "time": "10:30", "name": "åµ©è¶Šè·¯", "desc": "æ–‡é’è¡—æ‹", "link": "https://maps.app.goo.gl/eM2DRoHF2P22VCAv8?g_st=ipc", "keyword": "åµ©è¶Šè·¯", "icon": "fa-camera", "color": "text-gray-500", "deep_desc": "Song Wat Road æ˜¯è¿‘æœŸæ›¼è°·æœ€ç´…çš„æ–‡é’è¡—å€ã€‚æ—©æœŸæ˜¯é¦™æ–™èˆ‡å¤§ç±³çš„è²¿æ˜“é›†æ•£åœ°ï¼Œç¾åœ¨è€å€‰åº«æ”¹å»ºæˆäº†è—å»Šèˆ‡è³ªæ„Ÿå’–å•¡å»³ (å¦‚ FV Cafe)ã€‚ç‰†ä¸Šçš„å¤§è±¡å¡—é´‰æ˜¯å¿…æ‹åœ°æ¨™ã€‚" }, 
            { "time": "12:00", "name": "æ›é£¯åº—", "desc": "å‰å¾€ Jasmine 59 Hotel (é€šç¾…)", "link": "https://maps.app.goo.gl/DmVbJdwrbkwQ7p8K6?g_st=ipc", "keyword": "", "icon": "fa-suitcase", "color": "text-gray-500", "deep_desc": "ç§»å‹•æ—¥è«‹å–„ç”¨ Grab SUV æˆ– Van è»Šå‹ï¼Œå› ç‚ºæˆ‘å€‘è¡Œæä¸å°‘ã€‚é€šç¾…å€äº¤é€šè¼ƒå£…å¡ï¼Œè¦æœ‰å¡è»Šçš„å¿ƒç†æº–å‚™ã€‚" }, 
            { "time": "14:00", "name": "é€šç¾…å•†åœˆ", "desc": "å’–å•¡å»³ / é€›è¡—", "icon": "fa-glass-cheers", "color": "text-purple-500", "deep_desc": "Thong Lor (é€šç¾…) è¢«ç¨±ç‚ºæ›¼è°·çš„ã€Œå°æ—¥æœ¬ã€æˆ–å¯Œäººå€ã€‚é€™è£¡èšé›†äº†æœ€é«˜å¯†åº¦çš„ç²¾å“å’–å•¡å»³ã€æ—¥å¼å±…é…’å±‹èˆ‡éš±è—ç‰ˆé…’å§ (Speakeasy Bar)ã€‚" }, 
            { "time": "Eve", "name": "ç™¾è²¨ / è€ƒå±±è·¯", "desc": "Iconsiam / Central World", "icon": "fa-shopping-bag", "color": "text-jp-text", "deep_desc": "Iconsiam æœ€å…·ç‰¹è‰²çš„å°±æ˜¯ä¸€æ¨“çš„ã€Œå®¤å…§æ°´ä¸Šå¸‚å ´ã€(SookSiam)ï¼Œå®Œç¾å¾©åˆ»äº†æ³°åœ‹å‚³çµ±æ°´ä¸Šäººå®¶çš„é¢¨æƒ…ï¼Œä¸”å†·æ°£é–‹æ”¾ï¼Œé€›èµ·ä¾†éå¸¸èˆ’é©ã€‚è‹¥å» Central Worldï¼Œåˆ¥å¿˜äº†æ‹œä¸€ä¸‹é–€å£çš„æ„›ç¥èˆ‡è±¡ç¥ã€‚" } 
        ] },
        { "day": 4, "date": "12/26 (äº”)", "desc": "æ°´ä¸Šå¸‚å ´ä¸€æ—¥éŠ", "spots": [ 
            { "time": "08:00", "name": "åŒ…è»Šå‡ºç™¼", "desc": "é£¯åº—å¤§å»³é›†åˆ (æº–æ™‚!)", "icon": "fa-car", "color": "text-red-500", "highlight": true, "deep_desc": "ä»Šå¤©çš„è¡Œç¨‹è·é›¢æ›¼è°·å¸‚å€è¼ƒé  (ç´„ 1.5 - 2 å°æ™‚è»Šç¨‹)ï¼Œè«‹å¤§å®¶å‹™å¿…æº–æ™‚ï¼Œä»¥å…å¡è»Šå»¶èª¤ç«è»Šé€²ç«™çš„æ™‚é–“ã€‚" }, 
            { "time": "10:00", "name": "ç¾åŠŸéµé“å¸‚å ´", "desc": "çœ‹ç«è»Šé€²ç«™", "link": "https://maps.app.goo.gl/4f6eR12QvvsLoArb7?g_st=ipc", "keyword": "ç¾åŠŸéµé“å¸‚å ´", "icon": "fa-train", "color": "text-gray-500", "deep_desc": "é€™è£¡è¢«ç¨±ç‚ºã€Œä¸–ç•Œä¸Šæœ€å±éšªçš„å¸‚å ´ã€ã€‚æ¯å¤©æœ‰ 8 ç­ç«è»Šç¶“éï¼Œæ”¤è²©æœƒåœ¨ç«è»Šé³´ç¬›ç¬é–“ï¼Œç†Ÿç·´åœ°æ”¶èµ·é®é™½æ£šèˆ‡ç±ƒå­ï¼Œç«è»Šä¸€éåˆç¬é–“æ¢å¾©åŸç‹€ï¼Œæ˜¯æ³°åœ‹ç¨æœ‰çš„å¥‡æ™¯ã€‚" }, 
            { "time": "12:00", "name": "ä¸¹å«©èæ°´ä¸Šå¸‚å ´", "desc": "æ‰‹æ–èˆ¹é«”é©—", "link": "https://maps.app.goo.gl/n4JDTNY2q7Bqkrxw8?g_st=ipc", "keyword": "ä¸¹å«©èæœµ", "icon": "fa-water", "color": "text-gray-500", "deep_desc": "è¿™æ˜¯ 007 é›»å½±ã€Šé‡‘æ§äººã€‹çš„æ‹æ”å ´æ™¯ã€‚é›–ç„¶å•†æ¥­åŒ–ç¨‹åº¦é«˜ï¼Œä½†å»æ˜¯é«”é©—ã€Œæ‰‹æ–èˆ¹ã€å¡èˆ¹çš„æœ€ä½³åœ°é»ã€‚è¨˜å¾—ï¼šèˆ¹ä¸Šçš„æ±è¥¿é€šå¸¸æ¯”å²¸ä¸Šè²´ï¼Œæ®ºåƒ¹è¦å¾ 3 æŠ˜é–‹å§‹æ®ºï¼" }, 
            { "time": "14:00", "name": "æ¨¹ä¸­å»Ÿ", "desc": "éˆé©—å¤å»Ÿ", "link": "https://maps.app.goo.gl/z8xrK7NTUiyW4P6n8?g_st=ipc", "keyword": "æ¨¹ä¸­å»Ÿ", "icon": "fa-vihara", "color": "text-gray-500", "deep_desc": "é€™æ˜¯ä¸€åº§è¢«è©ææ¨¹æ ¹å®Œå…¨åŒ…è¦†çš„ä½›æ®¿ï¼Œå·²æœ‰ 400 å¤šå¹´æ­·å²ã€‚ç›¸å‚³é„­ç‹åœ¨æ”»æ‰“ç·¬ç”¸è»ä¹‹å‰æ›¾ä¾†æ­¤ç¥ˆæ±‚å‹åˆ©ï¼Œçµæœå¤§å‹ï¼Œå› æ­¤è¢«è¦–ç‚ºæ¥µå…¶éˆé©—çš„æ±‚å‹ä¹‹å»Ÿã€‚" }, 
            { "time": "16:00", "name": "è¿”å›æ›¼è°·", "desc": "å›é£¯åº—æˆ–æŒ‰æ‘©", "icon": "fa-home", "color": "text-gray-500", "deep_desc": "å›ç¨‹é€šå¸¸æœƒé‡åˆ°æ›¼è°·è‘—åçš„ä¸‹ç­å°–å³°è»Šæ½®ï¼Œé€™æ®µæ™‚é–“å¯ä»¥åœ¨è»Šä¸Šè£œçœ ï¼Œæˆ–è¨è«–æ™šé¤åƒä»€éº¼ã€‚" } 
        ] },
        { "day": 5, "date": "12/27 (å…­)", "desc": "è¿”å° / è‡ªç”±", "spots": [ 
            { "time": "10:00", "name": "æ°åœ–æ°å¸‚é›†", "desc": "æœ€å¾Œæ¡è²·", "link": "https://maps.app.goo.gl/T9QymcxerpaBbFGc7?g_st=ipc", "keyword": "æ°åœ–æ°å¸‚é›†", "icon": "fa-smile", "color": "text-gray-500", "deep_desc": "Chatuchak æ˜¯ä¸–ç•Œæœ€å¤§çš„é€±æœ«å¸‚é›†ï¼Œæ“æœ‰ä¸€è¬äº”åƒå€‹æ”¤ä½ã€‚åˆ†å€è¤‡é›œï¼Œå»ºè­°çœ‹åˆ°å–œæ­¡çš„å°±è²·ï¼Œå› ç‚ºå›é ­å¾ˆé›£å†æ‰¾åˆ°åŒä¸€å®¶åº—ï¼é€™è£¡ä¹Ÿæ˜¯è²·é¦™æ°›ã€æ‰‹å·¥è—å“å’Œç´€å¿µå“çš„æœ€ä½³åœ°é»ã€‚" }, 
            { "time": "Flight", "name": "å‰å¾€æ©Ÿå ´", "desc": "é å‚™è¿”å°", "icon": "fa-plane-departure", "color": "text-blue-500", "deep_desc": "è‹¥æœ‰åœ¨ç™¾è²¨å…¬å¸ç”³è«‹é€€ç¨… (VAT Refund)ï¼Œè¨˜å¾—å…ˆåœ¨æ©Ÿå ´å¤§å»³çš„é€€ç¨…è¾¦å…¬å®¤è“‹ç« ï¼Œéäº†æµ·é—œå¾Œå†å»é ˜éŒ¢å–”ï¼" } 
        ] }
    ];

    let state = {
        users: ["å† ä»”","å°èŠ³","ç å®‡","å©•èŒ¹","èŠä¼¶","å…¬è²»åŒ…"],
        fundBalance: 0,
        currency: 'THB',
        transactions: [],
        checklist: [{"title":"è­‰ä»¶","items":[{"name":"è­·ç…§","checked":true},{"name":"eSIM","checked":false},{"name":"ä¿éšªå–®","checked":false}]}],
        itinerary: DEFAULT_ITINERARY, 
        currentDay: 0
    };
    
    let sortableInstance = null;

    document.addEventListener('DOMContentLoaded', () => {
        try {
            loadData();
            updateDate();
            fetchWeather();
            fetchExchangeRate();
            renderDayTabs();
            renderItinerary();
            renderAccCats();
            renderPayers();
            updateFundDisplay();
            renderHistory();
            renderChecklist();
            autoSync();
        } catch (e) { console.error(e); }
    });

    // --- LOGIC ---
    function updateDate() { document.getElementById('current-date-display').innerText = new Date().toLocaleDateString('en-US', {month:'short', day:'numeric'}); }
    
    async function fetchWeather() {
        const display = document.getElementById('header-display-area');
        try {
            const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=13.75&longitude=100.50&current_weather=true');
            const data = await res.json();
            display.innerHTML = `${Math.round(data.current_weather.temperature)}Â°C <i class="fas fa-sun text-yellow-400"></i>`;
        } catch { display.innerHTML = "28Â°C"; }
    }

    async function fetchExchangeRate() {
        try {
            const res = await fetch('https://api.exchangerate-api.com/v4/latest/THB');
            const data = await res.json();
            const rate = data.rates.TWD; 
            document.getElementById('dash-rate').innerText = rate.toFixed(2);
        } catch { document.getElementById('dash-rate').innerText = "0.92"; }
    }

    function translateThai() {
        const txt = document.getElementById('thai-input').value;
        if(txt) window.open(`https://translate.google.com/?sl=zh-TW&tl=th&text=${encodeURIComponent(txt)}&op=translate`, '_blank');
    }

    // Itinerary Logic with Deep Description
    function renderDayTabs() {
        document.getElementById('day-tabs').innerHTML = state.itinerary.map((d, i) => `
            <button onclick="setDay(${i})" class="flex-shrink-0 px-4 py-2 rounded-xl border ${state.currentDay===i ? 'bg-jp-text text-white border-jp-text shadow-md' : 'bg-white text-gray-400 border-gray-100'}">
                <span class="block text-xs font-bold">Day ${d.day}</span>
                <span class="text-[10px] whitespace-nowrap">${d.date.split(' ')[0]}</span>
            </button>
        `).join('');
    }
    function setDay(i) { state.currentDay = i; renderDayTabs(); renderItinerary(); }
    
    function renderItinerary() {
        const d = state.itinerary[state.currentDay];
        const c = document.getElementById('itinerary-content');
        
        if(!d.spots || d.spots.length === 0) { c.innerHTML = `<div class="text-center py-10 text-gray-400 text-sm">é»æ“Š + æ–°å¢è¡Œç¨‹</div>`; return; }
        
        c.innerHTML = d.spots.map((s, idx) => {
            // Check for Deep Description
            const deepContent = s.deep_desc ? `
                <details class="group/desc mt-2 border-t border-gray-100 pt-2 transition-all">
                    <summary class="flex items-center gap-2 cursor-pointer text-[10px] font-bold text-jp-accent select-none list-none outline-none">
                        <span class="bg-mag-paper px-2 py-1 rounded border border-amber-100 hover:bg-amber-50 transition"><i class="fas fa-book-open mr-1"></i>æ™¯é»æ•…äº‹</span>
                        <i class="fas fa-chevron-down text-xs group-open/desc:rotate-180 transition-transform duration-300"></i>
                    </summary>
                    <div class="mt-2 text-xs text-jp-text leading-relaxed font-serif bg-mag-paper p-3 rounded-lg border-l-2 border-jp-accent shadow-sm animate-fadeIn">
                        ${s.deep_desc}
                    </div>
                </details>
            ` : '';

            return `
            <div class="timeline-item group" data-id="${idx}">
                <div class="drag-handle"><i class="fas fa-bars"></i></div>
                <div class="timeline-dot" style="${s.highlight ? 'background:#ef4444; border-color:#fee2e2;' : ''}"></div>
                <span class="timeline-time ${s.highlight ? 'text-red-500' : ''}">${s.time}</span>
                <div class="bg-white p-3 rounded-xl shadow-sm border border-gray-50 relative">
                    <button onclick="openEditSpot(${idx})" class="absolute top-2 right-2 text-gray-300 hover:text-jp-accent p-1 edit-spot-btn"><i class="fas fa-pen text-xs"></i></button>
                    <div class="flex justify-between items-start pr-6">
                        <p class="text-sm font-bold text-jp-text"><i class="fas ${s.icon} ${s.color || 'text-gray-500'} mr-1"></i> ${s.name}</p>
                    </div>
                    <p class="text-xs text-gray-500 mt-1 mb-2">${s.desc}</p>
                    <div class="flex gap-2 mt-2">
                        ${s.link ? `<a href="${s.link}" target="_blank" class="text-[10px] bg-blue-50 text-blue-500 px-2 py-1 rounded hover:bg-blue-100"><i class="fas fa-map-marker-alt"></i> åœ°åœ–</a>` : ''}
                        ${s.keyword ? `<a href="https://www.google.com/search?q=${encodeURIComponent(s.keyword)}" target="_blank" class="text-[10px] bg-orange-50 text-orange-500 px-2 py-1 rounded hover:bg-orange-100"><i class="fab fa-google"></i> æœæ”»ç•¥</a>` : ''}
                    </div>
                    ${deepContent}
                </div>
            </div>
            `;
        }).join('');

        if(sortableInstance) sortableInstance.destroy();
        sortableInstance = new Sortable(c, {
            handle: '.drag-handle',
            ghostClass: 'sortable-ghost',
            animation: 150,
            onEnd: function(evt) {
                const oldIndex = evt.oldIndex;
                const newIndex = evt.newIndex;
                if(oldIndex === newIndex) return;
                const spots = state.itinerary[state.currentDay].spots;
                const [movedItem] = spots.splice(oldIndex, 1);
                spots.splice(newIndex, 0, movedItem);
                saveData();
                renderItinerary();
            }
        });
    }

    let currentEditIndex = -1;
    function openEditSpot(index = -1) {
        currentEditIndex = index;
        document.getElementById('itinerary-modal').classList.add('open');
        const fields = ['time', 'name', 'desc', 'link', 'keyword', 'icon', 'deep-desc']; // Added deep-desc
        const isNew = index === -1;
        document.getElementById('spot-modal-title').innerText = isNew ? "æ–°å¢è¡Œç¨‹" : "ä¿®æ”¹è¡Œç¨‹";
        document.getElementById('btn-delete-spot').style.display = isNew ? 'none' : 'block';
        
        if (isNew) {
            fields.forEach(f => { const el = document.getElementById('spot-'+f); if(el) el.value = (f==='icon'?'fa-map-marker-alt':''); });
        } else {
            const s = state.itinerary[state.currentDay].spots[index];
            fields.forEach(f => {
                const el = document.getElementById('spot-'+f);
                // Map deep-desc correctly from property deep_desc
                if (f === 'deep-desc') { if(el) el.value = s.deep_desc || ''; }
                else if(el) el.value = s[f] || (f==='icon'?'fa-map-marker-alt':'');
            });
        }
    }
    function saveSpot() {
        const s = {
            time: document.getElementById('spot-time').value,
            name: document.getElementById('spot-name').value,
            desc: document.getElementById('spot-desc').value,
            link: document.getElementById('spot-link').value,
            keyword: document.getElementById('spot-keyword').value,
            icon: document.getElementById('spot-icon').value,
            deep_desc: document.getElementById('spot-deep-desc').value, // Save Deep Desc
            color: 'text-gray-500'
        };
        if (!s.name) return alert("è«‹è¼¸å…¥åç¨±");
        if (!state.itinerary[state.currentDay].spots) state.itinerary[state.currentDay].spots = [];
        
        if (currentEditIndex === -1) { state.itinerary[state.currentDay].spots.push(s); }
        else { state.itinerary[state.currentDay].spots[currentEditIndex] = s; }
        
        saveData(); renderItinerary(); closeModal('itinerary-modal');
    }
    function deleteSpot() { if(confirm("åˆªé™¤?")) { state.itinerary[state.currentDay].spots.splice(currentEditIndex, 1); saveData(); renderItinerary(); closeModal('itinerary-modal'); } }

    // Accounting
    let acc = { cat: 'é¤é£²', payer: 'å…¬è²»åŒ…', split: 'shared', cur: 'THB' };
    function renderAccCats() {
        const cats = [{n:'é¤é£²',i:'fa-utensils'}, {n:'äº¤é€š',i:'fa-car'}, {n:'è³¼ç‰©',i:'fa-shopping-bag'}, {n:'ä½å®¿',i:'fa-bed'}, {n:'å…¶ä»–',i:'fa-ellipsis-h'}];
        document.getElementById('cat-container').innerHTML = cats.map((c, i) => `<button onclick="setCat('${c.n}', this)" class="cat-btn ${i===0?'active':''} flex-shrink-0 w-16 h-16 rounded-xl flex flex-col items-center justify-center bg-white border border-gray-100"><i class="fas ${c.i} text-lg mb-1"></i><span class="text-xs">${c.n}</span></button>`).join('');
    }
    function setCat(n, el) { acc.cat = n; document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active')); el.classList.add('active'); }
    function renderPayers() { document.getElementById('payer-container').innerHTML = state.users.map(u => `<button onclick="setPayer('${u}', this)" class="payer-btn ${u==='å…¬è²»åŒ…'?'active':''} px-3 py-1 bg-gray-50 text-gray-400 rounded-lg text-xs border border-transparent">${u}</button>`).join(''); }
    function setPayer(u, el) { acc.payer = u; document.querySelectorAll('.payer-btn').forEach(b=>b.classList.remove('active')); el.classList.add('active'); }
    function setCurrency(c) { acc.cur = c; document.getElementById('cur-twd').className = c==='TWD' ? "px-3 py-2 text-xs rounded bg-white shadow-sm text-jp-text font-bold h-full" : "px-3 py-2 text-xs rounded text-gray-400 font-bold h-full"; document.getElementById('cur-thb').className = c==='THB' ? "px-3 py-2 text-xs rounded bg-white shadow-sm text-jp-text font-bold h-full" : "px-3 py-2 text-xs rounded text-gray-400 font-bold h-full"; }
    function setSplit(t) { acc.split = t; document.querySelectorAll('.split-btn').forEach(b => { b.classList.remove('active'); b.classList.add('text-gray-400'); }); document.getElementById(`split-${t}`).classList.add('active'); document.getElementById(`split-${t}`).classList.remove('text-gray-400'); }

    function submitTx() {
        const amt = parseFloat(document.getElementById('amt-input').value);
        if (!amt) return alert("è«‹è¼¸å…¥é‡‘é¡");
        if (acc.split === 'advance') { document.getElementById('advance-modal').classList.add('open'); document.getElementById('advance-list').innerHTML = state.users.filter(u => u !== 'å…¬è²»åŒ…').map(u => `<label class="flex items-center gap-2 p-2 bg-gray-50 rounded"><input type="checkbox" value="${u}"> ${u}</label>`).join(''); return; }
        processTx(amt, document.getElementById('note-input').value, acc.payer, acc.split, acc.cat, acc.cur, []);
    }
    function confirmAdvance() {
        const checked = Array.from(document.querySelectorAll('#advance-list input:checked')).map(cb => cb.value);
        if(checked.length === 0) return alert("è«‹é¸æ“‡å°è±¡");
        processTx(parseFloat(document.getElementById('amt-input').value), document.getElementById('note-input').value, acc.payer, 'advance', acc.cat, acc.cur, checked);
        closeModal('advance-modal');
    }
    function processTx(amt, note, payer, split, cat, cur, targets) {
        if(split === 'deposit') state.fundBalance += amt; else if (payer === 'å…¬è²»åŒ…') state.fundBalance -= amt;
        const newTx = { id: Date.now(), date: new Date().toLocaleString(), amt, note, payer, split, cat, cur, targets };
        state.transactions.unshift(newTx);
        saveData(); updateFundDisplay(); renderHistory();
        document.getElementById('amt-input').value = ''; document.getElementById('note-input').value = '';
        alert("å·²è¨˜éŒ„");
    }
    
    function deleteTx(id) {
        const tx = state.transactions.find(t => t.id === id);
        if(!tx) return;
        if(confirm("ç¢ºå®šåˆªé™¤æ­¤ç­†ç´€éŒ„ï¼Ÿ(é‡‘é¡æœƒè‡ªå‹•å›è£œ)")) {
            if(tx.split === 'deposit') state.fundBalance -= tx.amt; else if (tx.payer === 'å…¬è²»åŒ…') state.fundBalance += tx.amt;
            state.transactions = state.transactions.filter(t => t.id !== id);
            saveData(); updateFundDisplay(); renderHistory();
        }
    }

    function updateFundDisplay() { 
        const txt = `à¸¿ ${state.fundBalance.toLocaleString()}`; 
        document.getElementById('acc-fund-display').innerText = txt; 
        document.getElementById('home-fund-display').innerText = txt;
        document.getElementById('home-account-status').innerText = `é¤˜é¡: ${txt}`;
    }
    
    function renderHistory() { 
        document.getElementById('tx-history').innerHTML = state.transactions.slice(0, 10).map(t => `
            <div class="bg-white p-3 rounded-xl shadow-sm flex justify-between items-center border border-gray-50">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-xs text-gray-500">${t.payer[0]}</div>
                    <div>
                        <p class="text-sm font-bold text-jp-text">${t.note || t.cat}</p>
                        <p class="text-[10px] text-gray-400">${t.split==='deposit'?'å…¥é‡‘':t.split==='advance'?`ä»£å¢Š(${t.targets.length})`:'æ”¯å‡º'}</p>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <span class="font-bold ${t.split==='deposit'?'text-green-500':'text-jp-text'}">${t.split==='deposit'?'+':'-'} ${t.amt}</span>
                    <button onclick="deleteTx(${t.id})" class="w-6 h-6 rounded-full bg-red-50 text-red-400 flex items-center justify-center text-xs"><i class="fas fa-trash"></i></button>
                </div>
            </div>`).join(''); 
    }
    
    function clearTx() { if(confirm("ç¢ºå®šæ¸…ç©º?")) { state.transactions=[]; state.fundBalance=0; saveData(); location.reload(); }}
    function editUsers() { const n = prompt("è¼¸å…¥æ–°æˆå“¡ (é€—è™Ÿåˆ†éš”)", state.users.join(',')); if(n) { state.users = n.split(','); saveData(); renderPayers(); } }

    // Checklist
    function renderChecklist() {
        let total=0, checked=0;
        document.getElementById('checklist-container').innerHTML = state.checklist.map((g, gi) => `
            <div class="bg-white rounded-xl p-4 shadow-soft mb-3">
                <div class="flex justify-between mb-2"><input type="text" value="${g.title}" onchange="state.checklist[${gi}].title=this.value;saveData()" class="font-bold text-sm bg-transparent outline-none"><span class="text-xs text-gray-400">${g.items.filter(i=>i.checked).length}/${g.items.length}</span></div>
                <div class="w-full bg-gray-100 h-1 rounded-full mb-3"><div class="bg-jp-green h-1 rounded-full" style="width:${(g.items.filter(i=>i.checked).length/(g.items.length||1))*100}%"></div></div>
                <div class="space-y-2">${g.items.map((i, ii) => { total++; if(i.checked) checked++; return `<div class="flex items-center justify-between"><label class="flex items-center gap-2 text-sm text-gray-600"><input type="checkbox" ${i.checked?'checked':''} class="accent-jp-green" onchange="state.checklist[${gi}].items[${ii}].checked=!state.checklist[${gi}].items[${ii}].checked;saveData();renderChecklist()"><span class="${i.checked?'line-through text-gray-300':''}">${i.name}</span></label><button onclick="state.checklist[${gi}].items.splice(${ii},1);saveData();renderChecklist()" class="text-gray-200 text-xs"><i class="fas fa-times"></i></button></div>`; }).join('')}<button onclick="const n=prompt('é …ç›®');if(n){state.checklist[${gi}].items.push({name:n,checked:false});saveData();renderChecklist()}" class="text-xs text-jp-blue mt-2">+ æ–°å¢</button></div>
            </div>`).join('');
        document.getElementById('home-check-progress').innerText = `å®Œæˆåº¦ ${total===0?0:Math.round((checked/total)*100)}%`;
    }
    function addChecklistCategory() { state.checklist.push({title:'æ–°åˆ†é¡', items:[]}); saveData(); renderChecklist(); }
    function addChecklistItem() { const n = prompt("é …ç›®åç¨±"); if(n) { state.checklist[0].items.push({name:n, checked:false}); saveData(); renderChecklist(); } }

    // System
    function switchTab(id) {
        document.querySelectorAll('.section').forEach(e => e.classList.remove('active')); document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => { b.classList.remove('active'); b.style.color=''; });
        const btn = document.querySelector(`.nav-btn[data-target="${id}"]`); if(btn) btn.classList.add('active');
    }
    // Updated Key for v14 to FORCE DATA RELOAD
    function saveData() { localStorage.setItem('bkk_2025_v14', JSON.stringify(state)); }
    function loadData() { const d = localStorage.getItem('bkk_2025_v14'); if(d) try { state = {...state, ...JSON.parse(d)}; } catch(e) {} }
    
    // Cloud Sync
    async function autoSync() {
        const display = document.getElementById('header-display-area');
        if(display) display.innerHTML = '<span class="text-gray-400 text-xs"><i class="fas fa-circle-notch fa-spin"></i> åŒæ­¥ä¸­...</span>';
        try {
            const res = await fetch(GOOGLE_SCRIPT_URL + '?t=' + new Date().getTime());
            const cloudData = await res.json();
            if (cloudData && typeof cloudData === 'object' && Object.keys(cloudData).length > 0) {
                state = { ...state, ...cloudData };
                saveData();
                renderAll();
                console.log("Auto-synced from cloud");
            }
        } catch (e) { console.log("Auto-sync failed (offline?)", e); } finally { fetchWeather(); }
    }

    async function syncToCloud(action) {
        const btn = document.getElementById(action==='upload'?'btn-upload':'btn-download');
        let oldTxt = '';
        if(btn) { oldTxt = btn.innerHTML; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>'; btn.disabled = true; }
        try {
            if (action === 'upload') {
                await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(state) });
                alert("å·²é€å‡ºè«‹æ±‚ã€‚è«‹ç­‰å¾… 3-5 ç§’å¾Œåœ¨å¦ä¸€å°è£ç½®æŒ‰ã€Œä¸‹è¼‰ã€ã€‚");
            } else {
                const res = await fetch(GOOGLE_SCRIPT_URL + '?t=' + new Date().getTime()); 
                const data = await res.json();
                if (data && confirm("ç¢ºå®šç”¨é›²ç«¯è³‡æ–™è¦†è“‹æœ¬æ©Ÿ?")) { state = {...state, ...data}; saveData(); renderAll(); alert("æ›´æ–°æˆåŠŸï¼"); }
            }
        } catch (e) { alert("åŒæ­¥å¤±æ•—: " + e.message); } finally { if(btn) { btn.innerHTML = oldTxt; btn.disabled = false; } }
    }
    
    function renderAll() {
        renderItinerary(); renderAccCats(); renderPayers(); updateFundDisplay(); renderHistory(); renderChecklist();
    }

    function exportData() { navigator.clipboard.writeText(JSON.stringify(state)); alert("ä»£ç¢¼å·²è¤‡è£½"); }
    function openImportModal() { document.getElementById('import-modal').classList.add('open'); }
    function closeModal(id) { document.getElementById(id).classList.remove('open'); }
    function confirmImport() { try { state = JSON.parse(document.getElementById('import-area').value); saveData(); location.reload(); } catch { alert("æ ¼å¼éŒ¯èª¤"); } }
    function hardReset() { if(confirm("åˆªé™¤æ‰€æœ‰è³‡æ–™?")) { localStorage.removeItem('bkk_2025_v14'); location.reload(); } }
</script>
</body>
</html>
